<!-- 
  ZeroSite v23 - Sensitivity Analysis Section
  PDF ë³´ê³ ì„œì— ì‚½ì…í•  ë¯¼ê°ë„ ë¶„ì„ ì„¹ì…˜
-->

<!-- ============================================== -->
<!-- ë¯¼ê°ë„ ë¶„ì„ ì„¹ì…˜ (Financial Analysis ì´í›„ ì‚½ì…) -->
<!-- ============================================== -->

<div class="section sensitivity-analysis-section" style="page-break-before: always;">
    <h1 class="section-title">ğŸ“Š ë¯¼ê°ë„ ë¶„ì„ (Sensitivity Analysis)</h1>
    
    <div class="content-box">
        <h2 class="subsection-title">ë¶„ì„ ê°œìš”</h2>
        <p class="explanation">
            ë³¸ ë¯¼ê°ë„ ë¶„ì„ì€ <strong>CAPEX Â±10%</strong> ë° <strong>ê°ì •í‰ê°€ìœ¨ Â±5%</strong> ë³€ë™ ì‹œ 
            í”„ë¡œì íŠ¸ ìˆ˜ìµì„±ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.
        </p>
        
        <div class="info-grid">
            <div class="info-item">
                <span class="label">ë¶„ì„ ì‹œë‚˜ë¦¬ì˜¤</span>
                <span class="value">9ê°œ (3Ã—3 ë§¤íŠ¸ë¦­ìŠ¤)</span>
            </div>
            <div class="info-item">
                <span class="label">CAPEX ë³€ë™</span>
                <span class="value">-10% / ê¸°ì¤€ / +10%</span>
            </div>
            <div class="info-item">
                <span class="label">ê°ì •í‰ê°€ìœ¨ ë³€ë™</span>
                <span class="value">-5% / ê¸°ì¤€ / +5%</span>
            </div>
            <div class="info-item">
                <span class="label">ê¸°ì¤€ CAPEX</span>
                <span class="value">{{ capex_eok|round(0)|int }}ì–µì›</span>
            </div>
        </div>
    </div>
    
    {% if sensitivity_analysis_v23 and sensitivity_analysis_v23.scenarios %}
    <div class="content-box">
        <h2 class="subsection-title">ì‹œë‚˜ë¦¬ì˜¤ë³„ ë¶„ì„ ê²°ê³¼</h2>
        
        <table class="data-table" style="width: 100%; margin-top: 20px;">
            <thead>
                <tr>
                    <th>ì‹œë‚˜ë¦¬ì˜¤</th>
                    <th>CAPEX<br>(ì–µì›)</th>
                    <th>í‰ê°€ìœ¨<br>(%)</th>
                    <th>ìˆ˜ìµ<br>(ì–µì›)</th>
                    <th>ROI<br>(%)</th>
                    <th>IRR<br>(%)</th>
                    <th>ì˜ì‚¬ê²°ì •</th>
                </tr>
            </thead>
            <tbody>
                {% for scenario in sensitivity_analysis_v23.scenarios %}
                <tr class="{% if scenario.scenario_name == 'Base (ê¸°ì¤€)' %}baseline-row{% endif %}
                           {% if 'GO' in scenario.decision and 'NO-GO' not in scenario.decision %}go-row{% endif %}
                           {% if scenario.decision == 'NO-GO' %}no-go-row{% endif %}">
                    <td>{{ scenario.scenario_name }}</td>
                    <td style="text-align: right;">{{ scenario.adjusted_capex_eok|round(0)|int }}</td>
                    <td style="text-align: right;">{{ scenario.adjusted_appraisal_rate_pct|round(2) }}</td>
                    <td style="text-align: right; {% if scenario.profit_eok > 0 %}color: #2ecc71;{% elif scenario.profit_eok < 0 %}color: #e74c3c;{% endif %}">
                        {{ scenario.profit_eok|round(2) }}
                    </td>
                    <td style="text-align: right; {% if scenario.roi_pct > 0 %}color: #2ecc71;{% elif scenario.roi_pct < 0 %}color: #e74c3c;{% endif %}">
                        {{ scenario.roi_pct|round(2) }}
                    </td>
                    <td style="text-align: right; {% if scenario.irr_pct > 0 %}color: #2ecc71;{% elif scenario.irr_pct < 0 %}color: #e74c3c;{% endif %}">
                        {{ scenario.irr_pct|round(2) }}
                    </td>
                    <td style="text-align: center;">
                        {% if 'GO' in scenario.decision and 'NO-GO' not in scenario.decision %}
                        <span class="badge-go">âœ… {{ scenario.decision }}</span>
                        {% else %}
                        <span class="badge-no-go">âŒ {{ scenario.decision }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="content-box">
        <h2 class="subsection-title">ìš”ì•½ í†µê³„</h2>
        
        {% set summary = sensitivity_analysis_v23.summary %}
        
        <div class="stat-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
            <div class="stat-card">
                <div class="stat-label">ìˆ˜ìµ ë²”ìœ„</div>
                <div class="stat-value" style="font-size: 18px;">
                    {{ summary.profit_min_eok|round(2) }}ì–µ ~ {{ summary.profit_max_eok|round(2) }}ì–µ
                </div>
                <div class="stat-sub">ë³€ë™í­: {{ summary.profit_range_eok|round(2) }}ì–µì›</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ROI ë²”ìœ„</div>
                <div class="stat-value" style="font-size: 18px;">
                    {{ summary.roi_min_pct|round(2) }}% ~ {{ summary.roi_max_pct|round(2) }}%
                </div>
                <div class="stat-sub">ë³€ë™í­: {{ summary.roi_range_pct|round(2) }}%p</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">IRR ë²”ìœ„</div>
                <div class="stat-value" style="font-size: 18px;">
                    {{ summary.irr_min_pct|round(2) }}% ~ {{ summary.irr_max_pct|round(2) }}%
                </div>
                <div class="stat-sub">ë³€ë™í­: {{ summary.irr_range_pct|round(2) }}%p</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ìµœì  ì‹œë‚˜ë¦¬ì˜¤</div>
                <div class="stat-value" style="font-size: 16px; color: #2ecc71;">
                    {{ summary.best_scenario }}
                </div>
                <div class="stat-sub">ìˆ˜ìµ: {{ summary.best_profit_eok|round(2) }}ì–µì›</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ìµœì•… ì‹œë‚˜ë¦¬ì˜¤</div>
                <div class="stat-value" style="font-size: 16px; color: #e74c3c;">
                    {{ summary.worst_scenario }}
                </div>
                <div class="stat-sub">ìˆ˜ìµ: {{ summary.worst_profit_eok|round(2) }}ì–µì›</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-label">ì˜ì‚¬ê²°ì • ë¶„í¬</div>
                <div class="stat-value" style="font-size: 16px;">
                    GO {{ summary.go_count }}ê°œ / NO-GO {{ summary.no_go_count }}ê°œ
                </div>
                <div class="stat-sub">GO í™•ë¥ : {{ summary.go_probability_pct|round(1) }}%</div>
            </div>
        </div>
    </div>
    
    <div class="content-box">
        <h2 class="subsection-title">Tornado ë‹¤ì´ì–´ê·¸ë¨ (ë¯¼ê°ë„ ìˆœìœ„)</h2>
        
        {% set tornado = sensitivity_analysis_v23.tornado_data %}
        
        <p class="explanation">
            ê° ë³€ìˆ˜ê°€ í”„ë¡œì íŠ¸ ìˆ˜ìµì— ë¯¸ì¹˜ëŠ” ì˜í–¥ë ¥ì„ ì‹œê°í™”í•œ ê²°ê³¼ì…ë‹ˆë‹¤.
            <strong>ë³€ë™í­ì´ í´ìˆ˜ë¡ í•´ë‹¹ ë³€ìˆ˜ê°€ ë” ë¯¼ê°í•œ ìš”ì¸</strong>ì…ë‹ˆë‹¤.
        </p>
        
        <div style="margin-top: 30px;">
            {% for factor_data in tornado.factors %}
            <div class="tornado-item" style="margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="font-weight: bold; font-size: 16px;">
                        {{ loop.index }}ìœ„. {{ factor_data.factor }} ({{ factor_data.variation }})
                    </div>
                    <div style="color: #e74c3c; font-weight: bold;">
                        ë³€ë™í­: {{ factor_data.total_range|round(2) }}ì–µì›
                    </div>
                </div>
                
                <div class="tornado-bar-container" style="height: 50px; background: #f0f0f0; position: relative; border-radius: 5px;">
                    {% set negative_width = (factor_data.impact_negative|abs / factor_data.total_range * 50)|round(1) %}
                    {% set positive_width = (factor_data.impact_positive|abs / factor_data.total_range * 50)|round(1) %}
                    
                    <!-- Negative impact (left) -->
                    <div style="position: absolute; right: 50%; width: {{ negative_width }}%; height: 100%; background: #e74c3c; display: flex; align-items: center; justify-content: flex-start; padding-left: 10px; border-radius: 5px 0 0 5px;">
                        <span style="color: white; font-size: 12px; font-weight: bold;">{{ factor_data.impact_negative|round(2) }}ì–µ</span>
                    </div>
                    
                    <!-- Positive impact (right) -->
                    <div style="position: absolute; left: 50%; width: {{ positive_width }}%; height: 100%; background: #2ecc71; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; border-radius: 0 5px 5px 0;">
                        <span style="color: white; font-size: 12px; font-weight: bold;">{{ factor_data.impact_positive|round(2) }}ì–µ</span>
                    </div>
                    
                    <!-- Center line -->
                    <div style="position: absolute; left: 50%; width: 2px; height: 100%; background: #333;"></div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="alert alert-info" style="margin-top: 30px; padding: 20px; background: #e8f4f8; border-left: 5px solid #3498db; border-radius: 5px;">
            <h3 style="margin: 0 0 10px 0; color: #3498db;">ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h3>
            <p style="margin: 5px 0; font-size: 15px;">
                <strong>ê°€ì¥ ë¯¼ê°í•œ ìš”ì¸:</strong> {{ tornado.most_sensitive }}
            </p>
            <p style="margin: 5px 0; font-size: 14px;">
                ë³¸ í”„ë¡œì íŠ¸ì˜ ìˆ˜ìµì„±ì€ <strong>{{ tornado.most_sensitive }}</strong>ì— ê°€ì¥ í° ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.
                ë”°ë¼ì„œ <strong>{{ tornado.most_sensitive }} ê´€ë¦¬ê°€ ì‚¬ì—…ì„± í™•ë³´ì˜ í•µì‹¬</strong>ì…ë‹ˆë‹¤.
            </p>
        </div>
    </div>
    
    {% else %}
    <div class="content-box">
        <p class="note">ë¯¼ê°ë„ ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}
</div>

<style>
/* Sensitivity Analysis Styles */
.sensitivity-analysis-section {
    font-family: 'Noto Sans KR', sans-serif;
}

.baseline-row {
    background-color: #fff3cd !important;
    font-weight: bold;
}

.go-row {
    background-color: #d4edda !important;
}

.no-go-row {
    background-color: #f8d7da !important;
}

.badge-go {
    display: inline-block;
    padding: 5px 10px;
    background: #28a745;
    color: white;
    border-radius: 5px;
    font-size: 12px;
    font-weight: bold;
}

.badge-no-go {
    display: inline-block;
    padding: 5px 10px;
    background: #dc3545;
    color: white;
    border-radius: 5px;
    font-size: 12px;
    font-weight: bold;
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}

.stat-card {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 1px solid #dee2e6;
}

.stat-label {
    font-size: 14px;
    color: #6c757d;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.stat-sub {
    font-size: 13px;
    color: #6c757d;
}

.tornado-item {
    margin-bottom: 30px;
}

.tornado-bar-container {
    height: 50px;
    background: #f0f0f0;
    position: relative;
    border-radius: 5px;
}
</style>
