# Phase 8: 최종 통합 출력 확대 시스템 구현

**작성일**: 2026-01-10  
**상태**: 🚧 진행 중  
**목표**: M2-M6 분석 결과를 활용한 6종 보고서 + 종합 최종보고서(A) 완전 복원

---

## 📋 목표 (Objectives)

### 핵심 목표
M2-M6 분석 결과를 **기획 의도 그대로, 모든 논리·설명·설득·근거가 포함된 완성본**으로 출력

### 출력 대상
1. **모듈별 보고서 (5종)**
   - M2: 토지감정평가 보고서
   - M3: 공급 유형 판단 보고서
   - M4: 건축 규모 검토 보고서
   - M5: 사업성 분석 보고서
   - M6: 종합 판단 보고서

2. **6종 보고서**
   - **A**: 종합 최종보고서 (Master Comprehensive)
   - **B**: 토지주 제출용 보고서
   - **C**: LH 기술검증 보고서
   - **D**: 사업성·투자 검토 보고서
   - **E**: 사전 검토 리포트
   - **F**: 설명용 프레젠테이션

3. **최종보고서(전체)**
   - 지금까지 산출된 모든 내용 + 기획 의도 전체 포함

---

## 🚨 절대 원칙 (CRITICAL RULES)

### ❌ 절대 금지
- M2-M6 계산 로직 수정
- 수치·점수·IRR·세대수 등의 변경
- pipeline_result 값 변경
- 새로운 분석 내용 생성 (가상의 데이터 등)
- 보고서 목적을 오염시키는 표현 추가

### ✅ 허용 (내용 확장 범위)
- 기획서에 명시된 **논리 설명문, 사례 비교, 정책/법규 해석, 맥락 설명, 리스크 설명, 판단 근거** 추가
- 부록/Appendix 섹션 확장
- 표/테이블/매트릭스 확장
- 문장 톤 조절 (보고서 목적별)
- 모듈간 논리 연결 강화

---

## 🧱 모듈별 출력 가이드라인

### M2: 토지감정평가 보고서
**확장 항목**:
- ✅ 기획 의도 설명문 추가
- ✅ 거래사례 3-5건 상세 표 출력
- ✅ 사례별 비교 논리 서술
- ✅ 가격 범위 + 형성 논리 서술
- ✅ 리스크 및 한계점 설명

**템플릿**: `app/templates_v13/m2_professional_appraisal_v6_5.html`

**추가 섹션**:
```
1. 감정평가 개요
2. 거래사례 분석 (상세)
   - 사례 1: [주소], [단가], [거래일], [비교 논리]
   - 사례 2: ...
   - 사례 3: ...
3. 공시지가 비교 분석
4. 가격 형성 논리
5. 리스크 요인 분석
6. 한계점 및 유의사항
```

---

### M3: 공급 유형 판단 보고서
**확장 항목**:
- ✅ 후보 유형 전체 나열 + 평가 매트릭스
- ✅ 정책 적합성 매트릭스 텍스트 설명
- ✅ 최종 유형 선택 이유 서술
- ✅ 탈락된 유형에 대한 논리적 배제 설명

**템플릿**: `app/templates_v13/m3_supply_type_format.html`

**추가 섹션**:
```
1. 공급 유형 개요
2. 후보 유형 분석
   - 청년형 (점수, 장단점, 적합성)
   - 신혼부부형 (점수, 장단점, 적합성)
   - 고령자형 (점수, 장단점, 적합성)
   - 다자녀형 (점수, 장단점, 적합성)
   - 일반형 (점수, 장단점, 적합성)
3. 평가 매트릭스
4. 정책 적합성 분석
5. 최종 유형 선택 논리
6. 탈락 유형 배제 근거
```

---

### M4: 건축 규모 검토 보고서
**확장 항목**:
- ✅ 법적 최대치 vs 현실적 실행 규모 비교 설명
- ✅ 주차/동선/구조 효율 관련 설명
- ✅ A/B/C 시나리오 비교 설명 (장단점 테이블)
- ✅ 최적 규모 선택 이유 설명

**템플릿**: `app/templates_v13/m4_building_scale_format.html`

**추가 섹션**:
```
1. 건축 규모 검토 개요
2. 법적 최대 규모 분석
   - 용적률 최대치
   - 건폐율 최대치
   - 세대수 최대치
3. 현실적 실행 규모 분석
4. 시나리오 비교
   - 시나리오 A: 법적 최대 (장단점)
   - 시나리오 B: 인센티브 적용 (장단점)
   - 시나리오 C: 보수적 접근 (장단점)
5. 주차 계획 검토
6. 동선 효율 분석
7. 최적 규모 선택 논리
```

---

### M5: 사업성 분석 보고서
**확장 항목**:
- ✅ 사업비 구조 설명
- ✅ IRR/NPV 해석 논리 설명
- ✅ 비용·수익 sensitivity 구간 설명
- ✅ 리스크 해석 (비용 과다/정책 변동 등) 텍스트

**템플릿**: `app/templates_v13/m5_feasibility_format.html`

**추가 섹션**:
```
1. 사업성 분석 개요
2. 비용 구조 분석
   - 토지비 (금액, 비율, 근거)
   - 건축비 (금액, 비율, 근거)
   - 간접비 (금액, 비율, 근거)
3. 수익 구조 분석
   - 임대 수익 (금액, 근거)
   - 기타 수익 (금액, 근거)
4. 재무지표 해석
   - IRR 해석 및 의미
   - NPV 해석 및 의미
   - ROI 해석 및 의미
   - 회수기간 분석
5. Sensitivity 분석
   - 비용 ±10% 시나리오
   - 수익 ±10% 시나리오
6. 리스크 요인 분석
7. 투자 결정 권고사항
```

---

### M6: 종합 판단 보고서
**확장 항목**:
- ✅ 앞 모듈 결과 통합 설명
- ✅ 긍정 요인 vs 리스크 요인 명확히 나열
- ✅ 조건부 검토/추진 가능성 설명
- ✅ 다음 단계 실사·보완 계획 안내

**템플릿**: 새로 생성 필요 (`m6_comprehensive_decision_report.html`)

**추가 섹션**:
```
1. 종합 판단 개요
2. 모듈별 결과 통합
   - M2 토지감정평가 요약
   - M3 공급 유형 판단 요약
   - M4 건축 규모 검토 요약
   - M5 사업성 분석 요약
3. 긍정 요인 분석
4. 리스크 요인 분석
5. LH 승인 가능성 평가
6. 조건부 추진 시나리오
7. 다음 단계 실사 계획
8. 최종 권고사항
```

---

## 🎯 6종 보고서 작성 지침

### A. 종합 최종보고서 (Master Comprehensive)
**목적**: 전체 서사를 갖춘 의사결정 보드

**특징**:
- 모든 모듈 (M2-M6 + M7) 설명·연결·판단
- 리스크·약점·조건부 추진 요소 명시
- 정책/법규/운영 맥락까지 포함

**템플릿**: `app/templates_v13/master_comprehensive_report.html` (현재 존재, 확장 필요)

**목차**:
```
1. 표지 / 식별 정보
2. Executive Summary (핵심 요약)
3. 대상지 개요 + 정책/입지 설명
4. M2 토지감정평가 (설명형)
5. M3 공급 유형 판단 (설명형)
6. M4 건축 규모 검토 (시나리오 비교)
7. M5 사업성 분석 (재무 구조 설명)
8. M6 종합 판단 (논리적 귀결)
9. M7 커뮤니티 계획 (운영·생활 설명)
10. 부록/참고자료/법규요약/데이터표
```

**예상 분량**: 60-70페이지

---

### B. 토지주 제출용 보고서
**목적**: 토지주 설득을 위한 안정성 중심 보고서

**특징**:
- 불필요한 리스크 과도 설명 제거
- 공공매입임대의 **안정성/산정 구조/근거** 중심 설명
- IRR·재무수치 최소화, 설명 중심

**템플릿**: 새로 생성 필요 (`report_type_b_landowner.html`)

**목차**:
```
1. 표지
2. 대상지 개요
3. LH 공공매입임대 사업 소개
4. 토지 가치 평가 (M2 요약)
5. 건축 계획 개요 (M4 요약)
6. 안정성 및 신뢰성
7. 예상 일정 및 절차
8. Q&A
```

**예상 분량**: 15-20페이지

---

### C. LH 기술검증 보고서
**목적**: LH 심사 기준에 부합하는 기술 검증 문서

**특징**:
- SEALED 구조 유지
- '기술적 검증' 목적 중심
- M7 요약 반영 (운영 가능성만)

**템플릿**: 새로 생성 필요 (`report_type_c_lh_technical.html`)

**목차**:
```
1. 표지
2. 사업 개요
3. 입지 분석 (M1 요약)
4. 토지 평가 (M2 요약)
5. 공급 유형 분석 (M3)
6. 건축 계획 (M4)
7. 사업성 검토 (M5 요약)
8. 커뮤니티 계획 (M7 요약)
9. LH 심사 기준 충족 여부 (M6)
10. 첨부 자료
```

**예상 분량**: 40-50페이지

---

### D. 사업성·투자 검토 보고서
**목적**: 투자자 관점의 재무 중심 보고서

**특징**:
- IRR/NPV 기반 설명 중심
- 리스크 평가/시나리오 분석 테이블 포함
- 투자자 관점 명확 설명

**템플릿**: 새로 생성 필요 (`report_type_d_investor.html`)

**목차**:
```
1. 표지
2. Executive Summary (투자 관점)
3. 사업 개요
4. 재무지표 분석 (M5 중심)
   - IRR, NPV, ROI, 회수기간
5. 비용 구조 상세
6. 수익 구조 상세
7. Sensitivity 분석
8. 리스크 평가
9. 투자 의견
10. 첨부 자료
```

**예상 분량**: 25-30페이지

---

### E. 사전 검토 리포트
**목적**: 빠른 의사결정을 위한 요약 보고서

**특징**:
- 5-8페이지 제한
- 모듈별 1페이지 요약
- 판단 포인트 강조

**템플릿**: 새로 생성 필요 (`report_type_e_preliminary.html`)

**목차**:
```
1. 표지
2. Executive Summary (1페이지)
3. M2 토지평가 요약 (1페이지)
4. M3 공급 유형 요약 (1페이지)
5. M4 건축 규모 요약 (1페이지)
6. M5 사업성 요약 (1페이지)
7. M6 종합 판단 (1페이지)
8. 다음 단계 (1페이지)
```

**예상 분량**: 5-8페이지

---

### F. 설명용 프레젠테이션
**목적**: 시각적 설명을 위한 슬라이드 형식

**특징**:
- 카드·차트 중심
- 텍스트 최소화
- 논리 흐름 시각화

**템플릿**: 새로 생성 필요 (`report_type_f_presentation.html`)

**목차**:
```
1. 표지
2. 대상지 위치 (지도)
3. 핵심 지표 (카드 형식)
4. 토지 가치 (차트)
5. 공급 유형 (비교표)
6. 건축 계획 (다이어그램)
7. 사업성 (재무 차트)
8. 종합 판단 (결정 카드)
9. 다음 단계
```

**예상 분량**: 10-15 슬라이드

---

## 📐 API 엔드포인트 설계

### 모듈별 보고서 API
```
GET /api/v4/reports/modules/m2/html?context_id={context_id}
GET /api/v4/reports/modules/m3/html?context_id={context_id}
GET /api/v4/reports/modules/m4/html?context_id={context_id}
GET /api/v4/reports/modules/m5/html?context_id={context_id}
GET /api/v4/reports/modules/m6/html?context_id={context_id}
```

### 6종 보고서 API
```
GET /api/v4/reports/six-types/A/html?context_id={context_id}  # 종합 최종보고서
GET /api/v4/reports/six-types/B/html?context_id={context_id}  # 토지주 제출용
GET /api/v4/reports/six-types/C/html?context_id={context_id}  # LH 기술검증
GET /api/v4/reports/six-types/D/html?context_id={context_id}  # 사업성·투자
GET /api/v4/reports/six-types/E/html?context_id={context_id}  # 사전 검토
GET /api/v4/reports/six-types/F/html?context_id={context_id}  # 설명용 프레젠테이션
```

### PDF 다운로드 API
```
GET /api/v4/reports/six-types/A/pdf?context_id={context_id}
GET /api/v4/reports/six-types/B/pdf?context_id={context_id}
... (동일 패턴)
```

---

## 🧪 검증 조건 (Validation Checklist)

- [ ] 동일 RUN_ID 기준, 모든 보고서 수치 동일
- [ ] 기획 의도 전부 포함
- [ ] 근거 텍스트/표가 충분
- [ ] 외부 검토 시 의견 0건
- [ ] PDF/HTML 변환 안정

---

## 📂 구현 파일 구조

```
app/
├── models/
│   └── phase8_report_types.py (NEW)
├── routers/
│   ├── phase8_module_reports_router.py (NEW)
│   └── phase8_six_types_router.py (NEW)
├── services/
│   ├── phase8_module_report_generator.py (NEW)
│   └── phase8_six_types_report_generator.py (NEW)
└── templates_v13/
    ├── master_comprehensive_report.html (ENHANCED)
    ├── m6_comprehensive_decision_report.html (NEW)
    ├── report_type_b_landowner.html (NEW)
    ├── report_type_c_lh_technical.html (NEW)
    ├── report_type_d_investor.html (NEW)
    ├── report_type_e_preliminary.html (NEW)
    └── report_type_f_presentation.html (NEW)
```

---

## 🎯 구현 단계 (Implementation Steps)

### Step 1: 데이터 모델 정의
- [ ] Phase8 보고서 타입 Enum 정의
- [ ] 모듈별 보고서 데이터 모델
- [ ] 6종 보고서 데이터 모델

### Step 2: 모듈별 보고서 생성 로직
- [ ] M2 토지감정평가 보고서 생성기
- [ ] M3 공급 유형 판단 보고서 생성기
- [ ] M4 건축 규모 검토 보고서 생성기
- [ ] M5 사업성 분석 보고서 생성기
- [ ] M6 종합 판단 보고서 생성기

### Step 3: 6종 보고서 생성 로직
- [ ] A: 종합 최종보고서 생성기
- [ ] B: 토지주 제출용 생성기
- [ ] C: LH 기술검증 생성기
- [ ] D: 사업성·투자 생성기
- [ ] E: 사전 검토 생성기
- [ ] F: 설명용 프레젠테이션 생성기

### Step 4: 템플릿 개발
- [ ] M6 템플릿 개발
- [ ] 종합 최종보고서 템플릿 확장
- [ ] B-F 보고서 템플릿 개발

### Step 5: API 라우터 구현
- [ ] 모듈별 보고서 라우터
- [ ] 6종 보고서 라우터
- [ ] PDF 다운로드 통합

### Step 6: 테스트 및 검증
- [ ] 단위 테스트
- [ ] 통합 테스트
- [ ] 수치 일관성 검증
- [ ] PDF 생성 테스트

### Step 7: 문서화 및 배포
- [ ] API 문서 작성
- [ ] 사용 가이드 작성
- [ ] Postman 컬렉션 업데이트
- [ ] Git 커밋 및 PR

---

## 📊 예상 작업량

| 작업 항목 | 예상 시간 | 우선순위 |
|---------|---------|---------|
| 데이터 모델 정의 | 1-2시간 | ⭐⭐⭐⭐⭐ |
| M2-M6 보고서 생성기 | 4-6시간 | ⭐⭐⭐⭐⭐ |
| 종합 최종보고서(A) 확장 | 3-4시간 | ⭐⭐⭐⭐⭐ |
| B-F 보고서 생성기 | 6-8시간 | ⭐⭐⭐⭐☆ |
| 템플릿 개발 (7개) | 8-10시간 | ⭐⭐⭐⭐⭐ |
| API 라우터 구현 | 2-3시간 | ⭐⭐⭐⭐⭐ |
| 테스트 및 검증 | 3-4시간 | ⭐⭐⭐⭐☆ |
| 문서화 | 2-3시간 | ⭐⭐⭐☆☆ |

**총 예상 시간**: 29-40시간

---

## 🚀 다음 단계

1. ✅ Phase 8 기획 문서 작성 (현재)
2. ⏳ 데이터 모델 정의
3. ⏳ M2-M6 모듈별 보고서 생성 로직 구현
4. ⏳ 종합 최종보고서(A) 템플릿 확장
5. ⏳ B-F 보고서 시스템 구현
6. ⏳ API 엔드포인트 추가 및 테스트
7. ⏳ 통합 테스트 및 검증
8. ⏳ 문서화 및 Git 커밋

---

**작성일**: 2026-01-10  
**작성자**: Claude (ZeroSite AI Assistant)  
**상태**: 🚧 Phase 8 기획 완료, 구현 준비 중
