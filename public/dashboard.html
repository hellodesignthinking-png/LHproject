<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite v24.1 - í†µí•© ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Pretendard', 'Noto Sans KR', sans-serif; }
        .tab-button.active {
            background: linear-gradient(135deg, #005BAC 0%, #0073D1 100%);
            color: white;
            border-bottom: 4px solid #FF7A00;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .gradient-bg { background: linear-gradient(135deg, #005BAC 0%, #0073D1 100%); }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #005BAC;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result-card {
            transition: all 0.3s ease;
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="/public/index.html" class="text-white hover:text-orange-300 transition">
                        <i class="fas fa-arrow-left"></i> ë©”ì¸ìœ¼ë¡œ
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold">
                            ğŸ¢ ZeroSite v24.1 í†µí•© ëŒ€ì‹œë³´ë“œ
                        </h1>
                        <p class="text-white/80 text-sm">
                            13ê°€ì§€ AI ì—”ì§„ ê¸°ë°˜ ì‹¤ì‹œê°„ ë¶„ì„ ì‹œìŠ¤í…œ
                        </p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="bg-white/20 backdrop-blur-lg px-4 py-2 rounded-full text-sm font-semibold">
                        âœ… All Systems Online
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto">
                <button class="tab-button active px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('diagnose')">
                    <i class="fas fa-search mr-2"></i>í† ì§€ ì§„ë‹¨
                </button>
                <button class="tab-button px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('capacity')">
                    <i class="fas fa-building mr-2"></i>ê·œëª¨ ê²€í† 
                </button>
                <button class="tab-button px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('appraisal')">
                    <i class="fas fa-file-invoice-dollar mr-2"></i>ê°ì •í‰ê°€
                </button>
                <button class="tab-button px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('scenario')">
                    <i class="fas fa-code-branch mr-2"></i>ì‹œë‚˜ë¦¬ì˜¤ A/B/C
                </button>
                <button class="tab-button px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('multi-parcel')">
                    <i class="fas fa-layer-group mr-2"></i>Multi-Parcel
                </button>
                <button class="tab-button px-6 py-4 font-semibold transition whitespace-nowrap" onclick="switchTab('reports')">
                    <i class="fas fa-file-alt mr-2"></i>ë³´ê³ ì„œ ìƒì„±
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Tab 1: í† ì§€ ì§„ë‹¨ -->
        <div id="tab-diagnose" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Input Form -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold mb-6 flex items-center text-blue-600">
                            <i class="fas fa-search mr-3"></i>
                            í† ì§€ ì§„ë‹¨ ì…ë ¥
                        </h2>
                        
                        <form id="diagnoseForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ“ ì£¼ì†Œ <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="diagnose_address" required
                                    placeholder="ì˜ˆ: ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ê³µë•ë™ 123-4"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ“ í† ì§€ë©´ì  (ã¡) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="diagnose_land_area" required min="100"
                                    placeholder="ì˜ˆ: 1500"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ’° ê°ì •ê°€ (ì›/ã¡) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="diagnose_appraisal_price" required min="1000000"
                                    placeholder="ì˜ˆ: 5000000"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ˜ï¸ ìš©ë„ì§€ì—­ <span class="text-red-500">*</span>
                                </label>
                                <select id="diagnose_zone_type" required
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                                    <option value="ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                                    <option value="ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                                    <option value="ì¤€ì£¼ê±°ì§€ì—­">ì¤€ì£¼ê±°ì§€ì—­</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ“Š ë²•ì • ìš©ì ë¥  (%)
                                </label>
                                <input type="number" id="diagnose_legal_far" min="0" placeholder="ì˜ˆ: 200"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ—ï¸ ë²•ì • ê±´íìœ¨ (%)
                                </label>
                                <input type="number" id="diagnose_legal_bcr" min="0" placeholder="ì˜ˆ: 60"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-lg transition shadow-lg">
                                <i class="fas fa-search mr-2"></i>í† ì§€ ì§„ë‹¨ ì‹¤í–‰
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Results -->
                <div class="lg:col-span-1">
                    <div id="diagnose-result" class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-chart-bar mr-2 text-blue-600"></i>ì§„ë‹¨ ê²°ê³¼
                        </h3>
                        <div class="text-center text-gray-400 py-12">
                            <i class="fas fa-clipboard-list text-6xl mb-4"></i>
                            <p>ì§„ë‹¨ì„ ì‹¤í–‰í•˜ë©´<br>ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: ê·œëª¨ ê²€í†  -->
        <div id="tab-capacity" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h2 class="text-2xl font-bold mb-6 flex items-center text-orange-600">
                            <i class="fas fa-building mr-3"></i>
                            ê±´ì¶• ê·œëª¨ ê²€í†  ì…ë ¥
                        </h2>
                        
                        <form id="capacityForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ“ ëŒ€ì§€ë©´ì  (ã¡) <span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="capacity_land_area" required min="100"
                                    placeholder="ì˜ˆ: 1500"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ—ï¸ ê±´íìœ¨ ì œí•œ (%)
                                </label>
                                <input type="number" id="capacity_bcr_limit" min="0" placeholder="ì˜ˆ: 60"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ“Š ìš©ì ë¥  ì œí•œ (%)
                                </label>
                                <input type="number" id="capacity_far_limit" min="0" placeholder="ì˜ˆ: 240"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    ğŸ¢ ìµœëŒ€ ì¸µìˆ˜
                                </label>
                                <input type="number" id="capacity_max_floors" min="1" placeholder="ì˜ˆ: 15"
                                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500">
                            </div>
                            
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-lg transition shadow-lg">
                                <i class="fas fa-calculator mr-2"></i>ê·œëª¨ ê²€í†  ì‹¤í–‰
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="lg:col-span-1">
                    <div id="capacity-result" class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-chart-bar mr-2 text-orange-600"></i>ê²€í†  ê²°ê³¼
                        </h3>
                        <div class="text-center text-gray-400 py-12">
                            <i class="fas fa-building text-6xl mb-4"></i>
                            <p>ê²€í† ë¥¼ ì‹¤í–‰í•˜ë©´<br>ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3: ê°ì •í‰ê°€ -->
        <div id="tab-appraisal" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Input Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6 flex items-center text-green-600">
                        <i class="fas fa-file-invoice-dollar mr-3"></i>
                        í† ì§€ ê°ì •í‰ê°€
                    </h2>
                    <div class="bg-green-50 border-l-4 border-green-600 p-4 mb-6">
                        <p class="text-sm text-gray-700">
                            <i class="fas fa-info-circle mr-2"></i>
                            3ê°€ì§€ ê°ì •í‰ê°€ ë°©ë²•(ì›ê°€ë²•, ê±°ë˜ì‚¬ë¡€ë¹„êµë²•, ìˆ˜ìµí™˜ì›ë²•)ì„ ì¢…í•©í•˜ì—¬ ìµœì¢… ê°ì •ê°€ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    
                    <form id="appraisalForm" class="space-y-4">
                        <!-- SECTION 1: Basic Information (í•„ìˆ˜) - ì™„ì „ ìë™í™” -->
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-lg border-2 border-green-300 shadow-md">
                            <h3 class="font-bold text-green-800 mb-3 flex items-center text-lg">
                                <i class="fas fa-magic mr-2 text-green-600"></i>AI ìë™ ê°ì •í‰ê°€ (ì£¼ì†Œë§Œ ì…ë ¥!)
                            </h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-map-marker-alt mr-1"></i>ì£¼ì†Œ (í•„ìˆ˜)
                                    </label>
                                    <input type="text" id="appraisal_address" required
                                        class="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:border-green-600 focus:ring-2 focus:ring-green-200 transition shadow-sm"
                                        placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-4">
                                    <p class="text-xs text-green-600 mt-2 flex items-center">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        ì£¼ì†Œë§Œ ì…ë ¥í•˜ë©´ ê°œë³„ê³µì‹œì§€ê°€, ìš©ë„ì§€ì—­, ì…ì§€/ì¸í”„ë¼, ê°œë°œ/ê·œì œ, í”„ë¦¬ë¯¸ì—„ì´ ëª¨ë‘ ìë™ ë¶„ì„ë©ë‹ˆë‹¤!
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-ruler-combined mr-1"></i>ëŒ€ì§€ë©´ì  (ã¡) - ì„ íƒì‚¬í•­
                                    </label>
                                    <input type="number" id="appraisal_land_area"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-600 focus:ring-2 focus:ring-green-200 transition"
                                        placeholder="ë¯¸ì…ë ¥ì‹œ 660ã¡ë¡œ ê¸°ë³¸ ì„¤ì •" step="0.01">
                                    <p class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ í‘œì¤€ ëŒ€ì§€ë©´ì (660ã¡)ìœ¼ë¡œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ìë™ ë¶„ì„ ì§„í–‰ ìƒí™© í‘œì‹œ (ë¡œë”© ì‹œì—ë§Œ í‘œì‹œ) -->
                        <div id="auto-analysis-progress" class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200 hidden">
                            <h3 class="font-bold text-blue-800 mb-3 flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>AI ìë™ ë¶„ì„ ì§„í–‰ ì¤‘...
                            </h3>
                            <div class="space-y-2 text-sm">
                                <div id="progress-land-price" class="flex items-center text-gray-600">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>ê°œë³„ê³µì‹œì§€ê°€ ì¡°íšŒ ì¤‘...
                                </div>
                                <div id="progress-zoning" class="flex items-center text-gray-600">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>ìš©ë„ì§€ì—­ í™•ì¸ ì¤‘...
                                </div>
                                <div id="progress-location" class="flex items-center text-gray-600">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>ì…ì§€/ì¸í”„ë¼ ë¶„ì„ ì¤‘...
                                </div>
                                <div id="progress-development" class="flex items-center text-gray-600">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>ê°œë°œ/ê·œì œ ë¶„ì„ ì¤‘...
                                </div>
                                <div id="progress-premium" class="flex items-center text-gray-600">
                                    <i class="fas fa-circle-notch fa-spin mr-2"></i>í”„ë¦¬ë¯¸ì—„ ìë™ ê³„ì‚° ì¤‘...
                                </div>
                            </div>
                        </div>
                        
                        <!-- Physical Premium Factors (Manual Input) -->
                        <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                            <h3 class="font-bold text-green-800 mb-3 flex items-center">
                                <i class="fas fa-mountain mr-2"></i>í† ì§€ ë¬¼ë¦¬ì  íŠ¹ì„± (ì„ íƒì‚¬í•­)
                            </h3>
                            <p class="text-xs text-gray-600 mb-3">
                                <i class="fas fa-info-circle mr-1"></i>
                                í† ì§€ì˜ í˜•ìƒ, ê²½ì‚¬, í–¥, ì ‘ë„ ì¡°ê±´ì„ ì„ íƒí•˜ë©´ í”„ë¦¬ë¯¸ì—„ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
                            </p>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">í† ì§€í˜•ìƒ</label>
                                    <select id="premium_land_shape" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-green-600">
                                        <option value="0">ì„ íƒì•ˆí•¨ (0%)</option>
                                        <option value="15">ì •ë°©í˜• (+15%)</option>
                                        <option value="10">ì¥ë°©í˜• (+10%)</option>
                                        <option value="0">ì¼ë°˜í˜• (0%)</option>
                                        <option value="-10">ì„¸ì¥í˜• (-10%)</option>
                                        <option value="-20">ë¶€ì •í˜• (-20%)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">í† ì§€ê²½ì‚¬ë„</label>
                                    <select id="premium_land_slope" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-green-600">
                                        <option value="0">ì„ íƒì•ˆí•¨ (0%)</option>
                                        <option value="15">í‰ì§€ (+15%)</option>
                                        <option value="5">ì™„ê²½ì‚¬ (+5%)</option>
                                        <option value="0">ì¼ë°˜ê²½ì‚¬ (0%)</option>
                                        <option value="-10">ê¸‰ê²½ì‚¬ (-10%)</option>
                                        <option value="-15">í—˜ì¤€ (-15%)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">í–¥(å‘)</label>
                                    <select id="premium_direction" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-green-600">
                                        <option value="0">ì„ íƒì•ˆí•¨ (0%)</option>
                                        <option value="12">ë‚¨í–¥ (+12%)</option>
                                        <option value="8">ë‚¨ë™í–¥ (+8%)</option>
                                        <option value="5">ë™í–¥ (+5%)</option>
                                        <option value="0">ì„œí–¥ (0%)</option>
                                        <option value="-5">ë¶í–¥ (-5%)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">ì ‘ë„ ì¡°ê±´</label>
                                    <select id="premium_road_facing" class="w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-green-600">
                                        <option value="0">ì„ íƒì•ˆí•¨ (0%)</option>
                                        <option value="25">4ë©´ë„ë¡œ (+25%)</option>
                                        <option value="18">3ë©´ë„ë¡œ (+18%)</option>
                                        <option value="10">ê°ì§€ (+10%)</option>
                                        <option value="0">ì¼ë°˜ì ‘ë„ (0%)</option>
                                        <option value="-20">ë§¹ì§€ (-20%)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Premium Summary Display (Auto-calculated) -->
                        <div id="premium-summary" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 rounded-lg shadow-lg hidden">
                            <h3 class="font-bold mb-2 flex items-center">
                                <i class="fas fa-robot mr-2"></i>AI ìë™ ë¶„ì„ ê²°ê³¼
                            </h3>
                            <div id="premium-details" class="text-sm space-y-1"></div>
                            <div class="mt-3 pt-3 border-t border-white/30">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">ë°ì´í„° ê¸°ë°˜ ì´ í”„ë¦¬ë¯¸ì—„:</span>
                                    <span id="total-premium" class="text-xl font-bold"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comparable Sales Section (Expandable) -->
                        <div class="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                            <button type="button" onclick="toggleComparables()" class="w-full flex items-center justify-between text-left font-semibold text-blue-800 hover:text-blue-900">
                                <span><i class="fas fa-exchange-alt mr-2"></i>ê±°ë˜ì‚¬ë¡€ ë°ì´í„° ì…ë ¥ (ì„ íƒì‚¬í•­)</span>
                                <i id="comparables-toggle-icon" class="fas fa-chevron-down transition-transform"></i>
                            </button>
                            
                            <div id="comparables-section" class="hidden mt-4 space-y-3">
                                <p class="text-xs text-gray-600 mb-3">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    ê±°ë˜ì‚¬ë¡€ ì…ë ¥ ì‹œ ë”ìš± ì •í™•í•œ í‰ê°€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìµœëŒ€ 3ê°œê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                                </p>
                                
                                <!-- Comparable 1 -->
                                <div class="bg-white p-3 rounded-lg border border-gray-200">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-2">ê±°ë˜ì‚¬ë¡€ 1</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" id="comp1_price" placeholder="ê±°ë˜ë‹¨ê°€ (ì›/ã¡)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="1000">
                                        <input type="number" id="comp1_time_adj" placeholder="ì‹œì ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp1_location_adj" placeholder="ìœ„ì¹˜ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp1_individual_adj" placeholder="ê°œë³„ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp1_weight" placeholder="ê°€ì¤‘ì¹˜ (0.33)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="0.33">
                                    </div>
                                </div>
                                
                                <!-- Comparable 2 -->
                                <div class="bg-white p-3 rounded-lg border border-gray-200">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-2">ê±°ë˜ì‚¬ë¡€ 2</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" id="comp2_price" placeholder="ê±°ë˜ë‹¨ê°€ (ì›/ã¡)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="1000">
                                        <input type="number" id="comp2_time_adj" placeholder="ì‹œì ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp2_location_adj" placeholder="ìœ„ì¹˜ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp2_individual_adj" placeholder="ê°œë³„ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp2_weight" placeholder="ê°€ì¤‘ì¹˜ (0.33)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="0.33">
                                    </div>
                                </div>
                                
                                <!-- Comparable 3 -->
                                <div class="bg-white p-3 rounded-lg border border-gray-200">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-2">ê±°ë˜ì‚¬ë¡€ 3</h4>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" id="comp3_price" placeholder="ê±°ë˜ë‹¨ê°€ (ì›/ã¡)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="1000">
                                        <input type="number" id="comp3_time_adj" placeholder="ì‹œì ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp3_location_adj" placeholder="ìœ„ì¹˜ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp3_individual_adj" placeholder="ê°œë³„ë³´ì • (1.0)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="1.0">
                                        <input type="number" id="comp3_weight" placeholder="ê°€ì¤‘ì¹˜ (0.34)" 
                                            class="px-3 py-2 text-sm border border-gray-300 rounded focus:border-blue-500" step="0.01" value="0.34">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white font-bold py-4 px-6 rounded-lg hover:from-green-700 hover:to-green-800 transition shadow-lg">
                                <i class="fas fa-file-pdf mr-2"></i>PDF ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button type="button" id="previewHtmlBtn"
                                class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-4 px-6 rounded-lg hover:from-blue-700 hover:to-blue-800 transition shadow-lg">
                                <i class="fas fa-eye mr-2"></i>HTML ë¯¸ë¦¬ë³´ê¸°
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Results Display -->
                <div class="lg:col-span-1">
                    <div id="appraisal-result" class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-chart-bar mr-2 text-green-600"></i>ê°ì •í‰ê°€ ê²°ê³¼
                        </h3>
                        <div class="text-center text-gray-400 py-12">
                            <i class="fas fa-coins text-6xl mb-4"></i>
                            <p>ê°ì •í‰ê°€ë¥¼ ì‹¤í–‰í•˜ë©´<br>ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: ì‹œë‚˜ë¦¬ì˜¤ -->
        <div id="tab-scenario" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center text-purple-600">
                    <i class="fas fa-code-branch mr-3"></i>
                    ì‹œë‚˜ë¦¬ì˜¤ A/B/C ë¹„êµ
                </h2>
                <div class="text-center py-12">
                    <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-8 inline-block">
                        <i class="fas fa-sitemap text-6xl text-purple-600 mb-4"></i>
                        <h3 class="text-2xl font-bold text-purple-700 mb-2">3ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„</h3>
                        <p class="text-gray-600 mb-6">
                            ì†Œí˜• ì¤‘ì‹¬ / ì¤‘ëŒ€í˜• ì¤‘ì‹¬ / ê³ ë ¹ìí˜•<br>
                            3ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜ìµì„± ë¹„êµ ë¶„ì„
                        </p>
                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <div class="bg-white p-4 rounded-lg shadow">
                                <h4 class="font-bold text-blue-600 mb-2">ì‹œë‚˜ë¦¬ì˜¤ A</h4>
                                <p class="text-sm text-gray-600">ì†Œí˜• ì¤‘ì‹¬</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <h4 class="font-bold text-green-600 mb-2">ì‹œë‚˜ë¦¬ì˜¤ B</h4>
                                <p class="text-sm text-gray-600">ì¤‘ëŒ€í˜• ì¤‘ì‹¬</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow">
                                <h4 class="font-bold text-orange-600 mb-2">ì‹œë‚˜ë¦¬ì˜¤ C</h4>
                                <p class="text-sm text-gray-600">ê³ ë ¹ìí˜•</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 5: Multi-Parcel -->
        <div id="tab-multi-parcel" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center text-red-600">
                    <i class="fas fa-layer-group mr-3"></i>
                    Multi-Parcel í•©í•„ ë¶„ì„
                </h2>
                <div class="text-center py-12">
                    <div class="bg-red-50 border-2 border-red-200 rounded-xl p-8 inline-block">
                        <i class="fas fa-th text-6xl text-red-600 mb-4"></i>
                        <h3 class="text-2xl font-bold text-red-700 mb-2">í•©í•„ ìµœì í™”</h3>
                        <p class="text-gray-600 mb-6">
                            ì¸ì ‘ í•„ì§€ ìë™ íƒìƒ‰ ë° ì¡°í•© ìµœì í™”<br>
                            ìœ ì „ ì•Œê³ ë¦¬ì¦˜ ê¸°ë°˜ ìµœì  í•©í•„ì•ˆ ë„ì¶œ
                        </p>
                        <button onclick="alert('Multi-Parcel ë¶„ì„ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')"
                            class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition">
                            ë¶„ì„ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 6: ë³´ê³ ì„œ ìƒì„± -->
        <div id="tab-reports" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center text-yellow-600">
                    <i class="fas fa-file-alt mr-3"></i>
                    ë³´ê³ ì„œ 5ì¢… ìƒì„±
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Report 1 -->
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 transition">
                        <div class="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mb-4">
                            <i class="fas fa-file-alt text-3xl text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">í† ì§€ì£¼ ìš”ì•½ ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-4">3-5í˜ì´ì§€ ê°„ë‹¨ ìš”ì•½ë³¸</p>
                        <button onclick="generateReport(1)"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- Report 2 -->
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 transition">
                        <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mb-4">
                            <i class="fas fa-file-contract text-3xl text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">LH ì œì¶œìš© ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-4">10-15í˜ì´ì§€ ê³µì‹ ì–‘ì‹</p>
                        <button onclick="generateReport(2)"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- Report 3 -->
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 transition">
                        <div class="bg-purple-100 rounded-full w-16 h-16 flex items-center justify-center mb-4">
                            <i class="fas fa-file-invoice text-3xl text-purple-600"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">ì „ë¬¸ê°€ìš© ìƒì„¸ ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-4">25-40í˜ì´ì§€ ì‹¬í™” ë¶„ì„</p>
                        <button onclick="generateReport(3)"
                            class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- Report 4 -->
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 transition">
                        <div class="bg-orange-100 rounded-full w-16 h-16 flex items-center justify-center mb-4">
                            <i class="fas fa-gavel text-3xl text-orange-600"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">ì •ì±…ì˜í–¥ ë¶„ì„ ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-4">15-20í˜ì´ì§€ ì •ì±… ë¶„ì„</p>
                        <button onclick="generateReport(4)"
                            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded-lg transition">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                    
                    <!-- Report 5 -->
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:border-yellow-500 transition">
                        <div class="bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mb-4">
                            <i class="fas fa-chart-line text-3xl text-red-600"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">ì‚¬ì—…ììš© íƒ€ë‹¹ì„± ë³´ê³ ì„œ</h3>
                        <p class="text-sm text-gray-600 mb-4">15-20í˜ì´ì§€ ì‚¬ì—…ì„± ë¶„ì„</p>
                        <button onclick="generateReport(5)"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition">
                            ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                </div>
                
                <div id="report-result" class="mt-8"></div>
            </div>
        </div>

    </div>

    <!-- JavaScript -->
    <script>
        // Tab Switching
        function switchTab(tabName) {
            // URL íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸
            const url = new URL(window.location);
            url.searchParams.set('tab', tabName);
            window.history.pushState({}, '', url);
            
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
        
        // URL íŒŒë¼ë¯¸í„°ë¡œ ì´ˆê¸° íƒ­ ì„¤ì •
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            if (tab) {
                const tabButton = document.querySelector(`[onclick*="${tab}"]`);
                if (tabButton) {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    tabButton.classList.add('active');
                    document.getElementById(`tab-${tab}`).classList.add('active');
                }
            }
        });
        
        // í† ì§€ ì§„ë‹¨ ì‹¤í–‰
        document.getElementById('diagnoseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('diagnose-result');
            resultDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">í† ì§€ ì§„ë‹¨ ì¤‘...</p>
                </div>
            `;
            
            const data = {
                address: document.getElementById('diagnose_address').value,
                land_area: parseFloat(document.getElementById('diagnose_land_area').value),
                appraisal_price: parseFloat(document.getElementById('diagnose_appraisal_price').value),
                zone_type: document.getElementById('diagnose_zone_type').value,
                legal_far: parseFloat(document.getElementById('diagnose_legal_far').value) || 200,
                legal_bcr: parseFloat(document.getElementById('diagnose_legal_bcr').value) || 60
            };
            
            try {
                const response = await fetch('/api/v24.1/diagnose-land', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                resultDiv.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-gray-800">
                        <i class="fas fa-check-circle mr-2 text-green-600"></i>ì§„ë‹¨ ì™„ë£Œ
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ë¶„ì„ ID</p>
                            <p class="font-bold text-blue-600">${result.analysis_id || 'N/A'}</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ì£¼ì†Œ</p>
                            <p class="font-semibold">${data.address}</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ëŒ€ì§€ë©´ì </p>
                            <p class="font-bold text-purple-600">${data.land_area.toLocaleString()} ã¡</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ìš©ë„ì§€ì—­</p>
                            <p class="font-semibold">${data.zone_type}</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ìƒíƒœ</p>
                            <p class="font-bold text-green-600">${result.status || 'completed'}</p>
                        </div>
                    </div>
                `;
                
                // ì„±ê³µ ì•Œë¦¼
                showNotification('í† ì§€ ì§„ë‹¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <div class="bg-red-50 p-6 rounded-lg text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-600 mb-3"></i>
                        <p class="text-red-600 font-semibold">ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                        <p class="text-sm text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
                showNotification('í† ì§€ ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        });
        
        // ê·œëª¨ ê²€í†  ì‹¤í–‰
        document.getElementById('capacityForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('capacity-result');
            resultDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">ê·œëª¨ ê²€í†  ì¤‘...</p>
                </div>
            `;
            
            const data = {
                land_area: parseFloat(document.getElementById('capacity_land_area').value),
                bcr_limit: parseFloat(document.getElementById('capacity_bcr_limit').value) || 60,
                far_limit: parseFloat(document.getElementById('capacity_far_limit').value) || 240,
                max_floors: parseInt(document.getElementById('capacity_max_floors').value) || 15
            };
            
            try {
                const response = await fetch('/api/v24.1/capacity', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                resultDiv.innerHTML = `
                    <h3 class="text-xl font-bold mb-4 text-gray-800">
                        <i class="fas fa-check-circle mr-2 text-green-600"></i>ê²€í†  ì™„ë£Œ
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ëŒ€ì§€ë©´ì </p>
                            <p class="font-bold text-blue-600">${data.land_area.toLocaleString()} ã¡</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ìš©ì ë¥  ì œí•œ</p>
                            <p class="font-bold text-green-600">${data.far_limit}%</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ê±´íìœ¨ ì œí•œ</p>
                            <p class="font-bold text-purple-600">${data.bcr_limit}%</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">ìµœëŒ€ ì¸µìˆ˜</p>
                            <p class="font-bold text-orange-600">${data.max_floors}ì¸µ</p>
                        </div>
                    </div>
                `;
                
                showNotification('ê·œëª¨ ê²€í† ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <div class="bg-red-50 p-6 rounded-lg text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-600 mb-3"></i>
                        <p class="text-red-600 font-semibold">ê²€í†  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                        <p class="text-sm text-gray-600 mt-2">${error.message}</p>
                    </div>
                `;
                showNotification('ê·œëª¨ ê²€í†  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        });
        
        // Toggle comparables section
        function toggleComparables() {
            const section = document.getElementById('comparables-section');
            const icon = document.getElementById('comparables-toggle-icon');
            
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                icon.classList.add('rotate-180');
            } else {
                section.classList.add('hidden');
                icon.classList.remove('rotate-180');
            }
        }
        
        // ê°ì •í‰ê°€ ì‹¤í–‰
        document.getElementById('appraisalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('appraisal-result');
            const progressDiv = document.getElementById('auto-analysis-progress');
            
            // Show loading with auto-analysis progress
            resultDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">AI ìë™ ê°ì •í‰ê°€ ì§„í–‰ ì¤‘...</p>
                    <p class="text-xs text-gray-500 mt-2">ê°œë³„ê³µì‹œì§€ê°€ ì¡°íšŒ, ìš©ë„ì§€ì—­ í™•ì¸, ì…ì§€/ì¸í”„ë¼ ë¶„ì„, ê°œë°œ/ê·œì œ ë¶„ì„, í”„ë¦¬ë¯¸ì—„ ê³„ì‚°ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
                </div>
            `;
            progressDiv.classList.remove('hidden');
            
            // Use AUTO APPRAISAL API (address-only automation)
            const address = document.getElementById('appraisal_address').value;
            const landAreaInput = document.getElementById('appraisal_land_area').value;
            
            // Step 1: Auto-fetch official land price
            let officialLandPrice = null;
            let zoneType = null;
            
            try {
                // Show progress
                document.getElementById('progress-land-price').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ê°œë³„ê³µì‹œì§€ê°€ ì¡°íšŒ ì¤‘...';
                
                const landPriceResponse = await fetch('/api/v24.1/land-price/official', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: address })
                });
                
                if (landPriceResponse.ok) {
                    const landPriceData = await landPriceResponse.json();
                    if (landPriceData.status === 'success' && landPriceData.official_price) {
                        officialLandPrice = landPriceData.official_price;
                        document.getElementById('progress-land-price').innerHTML = '<i class="fas fa-check-circle mr-2 text-green-600"></i>ê°œë³„ê³µì‹œì§€ê°€ ì¡°íšŒ ì™„ë£Œ: ' + officialLandPrice.toLocaleString() + ' ì›/ã¡';
                    }
                }
            } catch (e) {
                console.log('Land price auto-fetch failed, will use fallback');
            }
            
            // Step 2: Auto-fetch zoning info
            try {
                document.getElementById('progress-zoning').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ìš©ë„ì§€ì—­ í™•ì¸ ì¤‘...';
                
                const zoningResponse = await fetch('/api/v24.1/zoning-info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: address })
                });
                
                if (zoningResponse.ok) {
                    const zoningData = await zoningResponse.json();
                    if (zoningData.status === 'success' && zoningData.zone_type) {
                        zoneType = zoningData.zone_type;
                        document.getElementById('progress-zoning').innerHTML = '<i class="fas fa-check-circle mr-2 text-green-600"></i>ìš©ë„ì§€ì—­ í™•ì¸ ì™„ë£Œ: ' + zoneType;
                    }
                }
            } catch (e) {
                console.log('Zoning auto-fetch failed, will use fallback');
            }
            
            // Step 3: Collect premium factors (physical characteristics)
            const premiumFactors = {
                land_shape: parseFloat(document.getElementById('premium_land_shape')?.value || 0),
                land_slope: parseFloat(document.getElementById('premium_land_slope')?.value || 0),
                direction: parseFloat(document.getElementById('premium_direction')?.value || 0),
                road_facing: parseFloat(document.getElementById('premium_road_facing')?.value || 0)
            };
            
            // Step 4: Prepare final data with FALLBACK values
            const data = {
                address: address,
                land_area_sqm: landAreaInput ? parseFloat(landAreaInput) : 660,  // Default 660ã¡
                zone_type: zoneType || "ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­",  // Fallback zone (ì œ3ì¢…ì´ ë” ì¼ë°˜ì )
                individual_land_price_per_sqm: officialLandPrice || 8500000,  // Fallback price
                premium_factors: premiumFactors  // User-selected physical characteristics
            };
            
            document.getElementById('progress-premium').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ê°ì •í‰ê°€ ì—”ì§„ ì‹¤í–‰ ì¤‘...';
            
            try {
                const response = await fetch('/api/v24.1/appraisal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                // Hide progress indicator
                progressDiv.classList.add('hidden');
                
                if (result.status === 'success') {
                    const appraisal = result.appraisal;
                    
                    resultDiv.innerHTML = `
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-check-circle mr-2 text-green-600"></i>ê°ì •í‰ê°€ ì™„ë£Œ
                        </h3>
                        
                        <!-- Auto-fetched Data Summary -->
                        <div class="bg-blue-50 p-4 rounded-lg mb-4 border-2 border-blue-200">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center">
                                <i class="fas fa-robot mr-2"></i>ì‚¬ìš©ëœ ë°ì´í„°
                            </h4>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-won-sign mr-2 text-blue-600"></i>
                                    <span class="text-gray-600">ê°œë³„ê³µì‹œì§€ê°€:</span>
                                    <span class="font-semibold ml-1">${data.individual_land_price_per_sqm.toLocaleString()} ì›/ã¡</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-map mr-2 text-blue-600"></i>
                                    <span class="text-gray-600">ìš©ë„ì§€ì—­:</span>
                                    <span class="font-semibold ml-1">${data.zone_type}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-ruler-combined mr-2 text-green-600"></i>
                                    <span class="text-gray-600">ëŒ€ì§€ë©´ì :</span>
                                    <span class="font-semibold ml-1">${data.land_area_sqm.toLocaleString()} ã¡</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2 text-green-600"></i>
                                    <span class="text-gray-600">ì£¼ì†Œ:</span>
                                    <span class="font-semibold ml-1 text-xs">${data.address}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Final Value -->
                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl mb-6 shadow-lg">
                            <p class="text-sm font-semibold mb-2">ìµœì¢… ê°ì •í‰ê°€ì•¡</p>
                            <p class="text-4xl font-bold">${appraisal.final_value.toFixed(2)} ì–µì›</p>
                            <p class="text-sm mt-2 opacity-90">ã¡ë‹¹ ${appraisal.value_per_sqm.toLocaleString()} ì›</p>
                            <div class="mt-3 bg-white/20 backdrop-blur-lg rounded-lg px-3 py-2 inline-block">
                                <span class="text-xs font-semibold">ì‹ ë¢°ë„: ${appraisal.confidence}</span>
                            </div>
                        </div>
                        
                        <!-- 3 Approaches -->
                        <div class="space-y-3 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-700">ì›ê°€ë²•</span>
                                    <span class="text-blue-600 font-bold">${appraisal.approaches.cost.toFixed(2)} ì–µì›</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ê°€ì¤‘ì¹˜: ${(appraisal.weights.cost * 100).toFixed(0)}%</div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-700">ê±°ë˜ì‚¬ë¡€ë¹„êµë²•</span>
                                    <span class="text-green-600 font-bold">${appraisal.approaches.sales_comparison.toFixed(2)} ì–µì›</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ê°€ì¤‘ì¹˜: ${(appraisal.weights.sales * 100).toFixed(0)}%</div>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-700">ìˆ˜ìµí™˜ì›ë²•</span>
                                    <span class="text-purple-600 font-bold">${appraisal.approaches.income.toFixed(2)} ì–µì›</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ê°€ì¤‘ì¹˜: ${(appraisal.weights.income * 100).toFixed(0)}%</div>
                            </div>
                        </div>
                        
                        <!-- Premium Information -->
                        ${appraisal.premium_percentage ? `
                        <div class="bg-gradient-to-r from-orange-50 to-yellow-50 p-4 rounded-lg mb-4 border-2 border-orange-200">
                            <h4 class="font-semibold text-orange-800 mb-3 flex items-center">
                                <i class="fas fa-star mr-2"></i>í”„ë¦¬ë¯¸ì—„ ë¶„ì„
                            </h4>
                            <div class="mb-3">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-700">ì ìš©ëœ í”„ë¦¬ë¯¸ì—„:</span>
                                    <span class="text-lg font-bold text-orange-600">+${appraisal.premium_percentage.toFixed(1)}%</span>
                                </div>
                            </div>
                            ${appraisal.premium_details && appraisal.premium_details.length > 0 ? `
                            <div class="mt-3 pt-3 border-t border-orange-200">
                                <p class="text-xs font-semibold text-gray-700 mb-2">ì£¼ìš” í”„ë¦¬ë¯¸ì—„ ìš”ì¸ (ìƒìœ„ 5ê°œ):</p>
                                <div class="space-y-1">
                                    ${appraisal.premium_details.map((factor, idx) => `
                                        <div class="flex justify-between items-center text-xs">
                                            <span class="text-gray-600">${idx + 1}. ${factor.factor || factor.name || 'í•­ëª©'}</span>
                                            <span class="font-semibold text-orange-600">${factor.percentage || factor.value || 0}%</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        <!-- Metadata -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <i class="fas fa-info-circle mr-2"></i>í‰ê°€ ì •ë³´
                            </h4>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-600">í‰ê°€ì¼ì:</span>
                                    <span class="font-semibold ml-2">${result.metadata.appraisal_date}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">ìœ„ì¹˜ë³´ì •:</span>
                                    <span class="font-semibold ml-2">${appraisal.location_factor.toFixed(2)}x</span>
                                </div>
                                ${appraisal.premium_percentage ? `
                                <div>
                                    <span class="text-gray-600">í”„ë¦¬ë¯¸ì—„:</span>
                                    <span class="font-semibold ml-2 text-orange-600">+${appraisal.premium_percentage.toFixed(1)}%</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Notes -->
                        <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-3">
                            <p class="text-xs text-gray-600">
                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                ë³¸ í‰ê°€ëŠ” ì°¸ê³ ìš©ì´ë©°, ê³µì‹ ê°ì •í‰ê°€ëŠ” ê°ì •í‰ê°€ì‚¬ì—ê²Œ ì˜ë¢°í•˜ì„¸ìš”.
                            </p>
                        </div>
                        
                        <!-- PDF Download Button -->
                        <div class="mt-6">
                            <button onclick="downloadAppraisalPDF()" class="w-full gradient-bg text-white py-4 px-6 rounded-xl font-bold text-lg hover:shadow-2xl transition-all duration-300 flex items-center justify-center gap-3">
                                <i class="fas fa-file-pdf text-2xl"></i>
                                <span>ìƒì„¸ ê°ì •í‰ê°€ ë³´ê³ ì„œ PDF ë‹¤ìš´ë¡œë“œ</span>
                                <i class="fas fa-download"></i>
                            </button>
                            <p class="text-xs text-gray-500 text-center mt-2">
                                3ê°€ì§€ í‰ê°€ë°©ì‹ì˜ ìƒì„¸ ê³„ì‚°ê³¼ì •ì´ í¬í•¨ë©ë‹ˆë‹¤
                            </p>
                        </div>
                    `;
                    
                    // Store BOTH request data AND result for PDF download
                    window.lastAppraisalData = data;
                    window.lastAppraisalResult = result;
                    
                    showNotification('ê°ì •í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    // Show detailed error from API
                    const errorMsg = result.message || result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    throw new Error(errorMsg);
                }
                
            } catch (error) {
                console.error('Appraisal Error:', error);
                progressDiv.classList.add('hidden');
                
                resultDiv.innerHTML = `
                    <div class="bg-red-50 p-6 rounded-lg border-2 border-red-200">
                        <div class="text-center mb-4">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-600 mb-3"></i>
                            <p class="text-red-600 font-semibold text-lg">ê°ì •í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                        </div>
                        
                        <div class="bg-white p-4 rounded-lg mb-4">
                            <p class="text-sm text-gray-700 mb-2"><strong>ì˜¤ë¥˜ ë‚´ìš©:</strong></p>
                            <p class="text-sm text-red-600 font-mono">${error.message}</p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-xs text-gray-700 mb-2"><strong>ì‚¬ìš©í•˜ë ¤ë˜ ë°ì´í„°:</strong></p>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>â€¢ ì£¼ì†Œ: ${data.address || 'N/A'}</li>
                                <li>â€¢ ëŒ€ì§€ë©´ì : ${data.land_area_sqm || 'N/A'} ã¡</li>
                                <li>â€¢ ìš©ë„ì§€ì—­: ${data.zone_type || 'N/A'}</li>
                                <li>â€¢ ê°œë³„ê³µì‹œì§€ê°€: ${data.individual_land_price_per_sqm ? data.individual_land_price_per_sqm.toLocaleString() : 'N/A'} ì›/ã¡</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button onclick="location.reload()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-redo mr-2"></i>ë‹¤ì‹œ ì‹œë„
                            </button>
                        </div>
                    </div>
                `;
                showNotification('ê°ì •í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.', 'error');
            }
        });
        
        // ğŸ†• v29.0 - HTML ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('previewHtmlBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            
            const address = document.getElementById('appraisal_address').value;
            const landAreaInput = document.getElementById('appraisal_land_area').value;
            
            if (!address) {
                showNotification('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            // Show loading notification
            showNotification('HTML ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì¤‘...', 'info');
            
            try {
                // Collect premium factors (physical characteristics)
                const premiumFactors = {
                    land_shape: parseFloat(document.getElementById('premium_land_shape')?.value || 0),
                    land_slope: parseFloat(document.getElementById('premium_land_slope')?.value || 0),
                    direction: parseFloat(document.getElementById('premium_direction')?.value || 0),
                    road_facing: parseFloat(document.getElementById('premium_road_facing')?.value || 0)
                };
                
                // Prepare request data
                const data = {
                    address: address,
                    land_area_sqm: landAreaInput ? parseFloat(landAreaInput) : 660,
                    premium_factors: premiumFactors
                };
                
                // Call HTML preview API endpoint
                const response = await fetch('/api/v24.1/appraisal/html', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    // Get HTML content
                    const htmlContent = await response.text();
                    
                    // Open in new window
                    const previewWindow = window.open('', '_blank', 'width=1200,height=900,menubar=yes,toolbar=yes,location=yes,status=yes,scrollbars=yes,resizable=yes');
                    
                    if (previewWindow) {
                        previewWindow.document.write(htmlContent);
                        previewWindow.document.close();
                        showNotification('HTML ë¯¸ë¦¬ë³´ê¸°ê°€ ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤', 'success');
                    } else {
                        showNotification('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”', 'error');
                    }
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'HTML ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('HTML preview error:', error);
                showNotification(`HTML ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        });
        
        // ë³´ê³ ì„œ ìƒì„±
        async function generateReport(reportType) {
            const reportNames = {
                1: 'í† ì§€ì£¼ ìš”ì•½ ë³´ê³ ì„œ',
                2: 'LH ì œì¶œìš© ë³´ê³ ì„œ',
                3: 'ì „ë¬¸ê°€ìš© ìƒì„¸ ë³´ê³ ì„œ',
                4: 'ì •ì±…ì˜í–¥ ë¶„ì„ ë³´ê³ ì„œ',
                5: 'ì‚¬ì—…ììš© íƒ€ë‹¹ì„± ë³´ê³ ì„œ'
            };
            
            const resultDiv = document.getElementById('report-result');
            resultDiv.innerHTML = `
                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600 font-semibold">${reportNames[reportType]} ìƒì„± ì¤‘...</p>
                </div>
            `;
            
            try {
                // ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œë¡œëŠ” API í˜¸ì¶œ
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                resultDiv.innerHTML = `
                    <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-bold text-green-700 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>${reportNames[reportType]}
                                </h4>
                                <p class="text-sm text-gray-600">ìƒì„± ì™„ë£Œ</p>
                            </div>
                            <button class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition">
                                <i class="fas fa-download mr-2"></i>ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                    </div>
                `;
                
                showNotification(`${reportNames[reportType]}ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-600 mb-3"></i>
                        <p class="text-red-600 font-semibold">ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                showNotification('ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }
        
        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-2xl z-50 animate-slide-in`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Premium calculation functions
        function calculatePremiumSummary() {
            const premiumLabels = {
                'premium_land_shape': 'í† ì§€í˜•ìƒ',
                'premium_land_slope': 'í† ì§€ê²½ì‚¬ë„',
                'premium_direction': 'í–¥(å‘)',
                'premium_road_facing': 'ì ‘ë„ì¡°ê±´',
                'premium_subway': 'ì§€í•˜ì² ì—­',
                'premium_school_district': '8í•™êµ°',
                'premium_park': 'ëŒ€í˜•ê³µì›',
                'premium_shopping': 'ë°±í™”ì ',
                'premium_hospital': 'ëŒ€í˜•ë³‘ì›',
                'premium_river_view': 'í•œê°•ì¡°ë§',
                'premium_redevelopment': 'ì¬ê°œë°œ',
                'premium_gtx': 'GTXì—­',
                'premium_greenbelt': 'ê·¸ë¦°ë²¨íŠ¸',
                'premium_cultural_heritage': 'ë¬¸í™”ì¬ë³´í˜¸êµ¬ì—­'
            };
            
            // Collect all premium values
            const premiums = [];
            for (const [id, label] of Object.entries(premiumLabels)) {
                const value = parseFloat(document.getElementById(id)?.value) || 0;
                if (value !== 0) {
                    premiums.push({ label, value, absValue: Math.abs(value) });
                }
            }
            
            // Sort by absolute value descending
            premiums.sort((a, b) => b.absValue - a.absValue);
            
            // Take top 5
            const top5 = premiums.slice(0, 5);
            
            // Calculate total (50% of sum of top 5)
            const sumTop5 = top5.reduce((sum, p) => sum + p.value, 0);
            const totalAdjusted = sumTop5 * 0.5;
            
            // Display summary
            const summaryDiv = document.getElementById('premium-summary');
            const detailsDiv = document.getElementById('premium-details');
            const totalSpan = document.getElementById('total-premium');
            
            if (premiums.length > 0) {
                summaryDiv.classList.remove('hidden');
                
                let detailsHTML = '<div class="space-y-1">';
                detailsHTML += '<div class="font-semibold mb-2">ìƒìœ„ 5ê°œ í”„ë¦¬ë¯¸ì—„ ìš”ì¸:</div>';
                top5.forEach((p, i) => {
                    const sign = p.value >= 0 ? '+' : '';
                    detailsHTML += `<div class="flex justify-between">
                        <span>${i + 1}. ${p.label}</span>
                        <span class="font-semibold">${sign}${p.value}%</span>
                    </div>`;
                });
                detailsHTML += `<div class="flex justify-between pt-2 border-t border-white/30">
                    <span>í•©ê³„:</span>
                    <span class="font-semibold">${sumTop5 >= 0 ? '+' : ''}${sumTop5.toFixed(1)}%</span>
                </div>`;
                detailsHTML += '</div>';
                
                detailsDiv.innerHTML = detailsHTML;
                
                const sign = totalAdjusted >= 0 ? '+' : '';
                totalSpan.textContent = `${sign}${totalAdjusted.toFixed(1)}%`;
            } else {
                summaryDiv.classList.add('hidden');
            }
        }
        
        // Add event listeners to all premium selects
        document.addEventListener('DOMContentLoaded', function() {
            const premiumSelects = [
                'premium_land_shape', 'premium_land_slope', 'premium_direction', 'premium_road_facing',
                'premium_subway', 'premium_school_district', 'premium_park', 'premium_shopping',
                'premium_hospital', 'premium_river_view', 'premium_redevelopment', 'premium_gtx',
                'premium_greenbelt', 'premium_cultural_heritage'
            ];
            
            premiumSelects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculatePremiumSummary);
                }
            });
        });
        
        // ê°ì •í‰ê°€ PDF ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        async function downloadAppraisalPDF() {
            if (!window.lastAppraisalData) {
                showNotification('ë¨¼ì € ê°ì •í‰ê°€ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”', 'warning');
                return;
            }
            
            try {
                showNotification('PDF ìƒì„± ì¤‘... (ìµœëŒ€ 30ì´ˆ ì†Œìš”)', 'info');
                
                // Use detailed-pdf endpoint for comprehensive report
                const response = await fetch('/api/v24.1/appraisal/detailed-pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(window.lastAppraisalData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('PDF generation failed:', errorText);
                    throw new Error(`PDF ìƒì„± ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                }
                
                // Check if response is actually a PDF
                const contentType = response.headers.get('Content-Type');
                if (!contentType || !contentType.includes('pdf')) {
                    console.error('Response is not a PDF. Content-Type:', contentType);
                    const text = await response.text();
                    console.error('Response body:', text.substring(0, 500));
                    throw new Error('ì„œë²„ê°€ PDF ëŒ€ì‹  ë‹¤ë¥¸ í˜•ì‹ì˜ ì‘ë‹µì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤');
                }
                
                // Convert response to blob and download
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                // Extract filename from Content-Disposition header
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = `ê°ì •í‰ê°€ë³´ê³ ì„œ_${new Date().toISOString().split('T')[0]}.pdf`;
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                    if (filenameMatch && filenameMatch[1]) {
                        filename = filenameMatch[1].replace(/['"]/g, '');
                        // Handle UTF-8 encoded filenames
                        if (filename.includes('UTF-8')) {
                            const utf8Match = filename.match(/UTF-8''(.+)/);
                            if (utf8Match) {
                                filename = decodeURIComponent(utf8Match[1]);
                            }
                        }
                    }
                }
                
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                showNotification('PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!', 'success');
            } catch (error) {
                console.error('PDF download error:', error);
                showNotification(`PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
