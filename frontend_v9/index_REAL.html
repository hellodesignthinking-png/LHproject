<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite v9.1 REAL - ì‹¤ì œ ì‘ë™í•˜ëŠ” ë²„ì „</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .result-card { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    ğŸ¯ ZeroSite v9.1 REAL
                </h1>
                <p class="text-gray-600">
                    ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ” LH í† ì§€ ë¶„ì„ ì‹œìŠ¤í…œ | 4ê°œ ì…ë ¥ â†’ 13ê°œ ìë™ ê³„ì‚°
                </p>
            </div>

            <!-- Input Form -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ“ ì…ë ¥ ì •ë³´ (4ê°œ í•„ë“œë§Œ)</h2>
                
                <form id="analysisForm" class="space-y-4">
                    <!-- 1. ì£¼ì†Œ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            1. ì£¼ì†Œ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="address" required
                            placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 120"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 2. ëŒ€ì§€ë©´ì  -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            2. ëŒ€ì§€ë©´ì  (mÂ²) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="land_area" required
                            placeholder="ì˜ˆ: 1000"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 3. í† ì§€ ê°ì •ê°€ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            3. í† ì§€ ê°ì •ê°€ (ì›/mÂ²) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="land_price" required
                            placeholder="ì˜ˆ: 9000000"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 4. ìš©ë„ì§€ì—­ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            4. ìš©ë„ì§€ì—­ <span class="text-red-500">*</span>
                        </label>
                        <select id="zone_type" required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤€ì£¼ê±°ì§€ì—­">ì¤€ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤‘ì‹¬ìƒì—…ì§€ì—­">ì¤‘ì‹¬ìƒì—…ì§€ì—­</option>
                            <option value="ì¼ë°˜ìƒì—…ì§€ì—­">ì¼ë°˜ìƒì—…ì§€ì—­</option>
                            <option value="ê·¼ë¦°ìƒì—…ì§€ì—­">ê·¼ë¦°ìƒì—…ì§€ì—­</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submitBtn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                        ğŸš€ ë¶„ì„ ì‹œì‘
                    </button>
                </form>
            </div>

            <!-- Loading -->
            <div id="loading" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                    <span class="text-blue-700 font-medium">ë¶„ì„ ì¤‘...</span>
                </div>
            </div>

            <!-- Error -->
            <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                <h3 class="text-red-800 font-bold mb-2">âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                <p id="errorMessage" class="text-red-700"></p>
            </div>

            <!-- Results -->
            <div id="results" class="hidden space-y-6">
                <!-- Auto Calculated -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-lg p-6 result-card">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">
                        âœ¨ ìë™ ê³„ì‚°ëœ í•„ë“œ (13ê°œ)
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ“ ì£¼ì†Œ ì •ë³´</h3>
                            <div class="space-y-1 text-sm">
                                <div>ìœ„ë„: <span id="latitude" class="font-mono"></span></div>
                                <div>ê²½ë„: <span id="longitude" class="font-mono"></span></div>
                                <div>ë²•ì •ë™ì½”ë“œ: <span id="legal_code" class="font-mono"></span></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ—ï¸ ê±´ì¶• ê¸°ì¤€</h3>
                            <div class="space-y-1 text-sm">
                                <div>ê±´íìœ¨: <span id="bcr" class="font-semibold"></span>%</div>
                                <div>ìš©ì ë¥ : <span id="far" class="font-semibold"></span>%</div>
                                <div>ë†’ì´ì œí•œ: <span id="height"></span></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ˜ï¸ ì„¸ëŒ€ ì •ë³´</h3>
                            <div class="space-y-1 text-sm">
                                <div>ì„¸ëŒ€ìˆ˜: <span id="units" class="font-semibold text-blue-600"></span>ì„¸ëŒ€</div>
                                <div>ì¸µìˆ˜: <span id="floors" class="font-semibold"></span>ì¸µ</div>
                                <div>ì£¼ì°¨: <span id="parking" class="font-semibold"></span>ëŒ€</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ“ ë©´ì  ì •ë³´</h3>
                            <div class="space-y-1 text-sm">
                                <div>ì´ ì—°ë©´ì : <span id="total_gfa"></span> mÂ²</div>
                                <div>ì£¼ê±° ì—°ë©´ì : <span id="res_gfa"></span> mÂ²</div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ’° ê±´ì¶•ë¹„</h3>
                            <div class="text-lg font-bold text-green-600" id="construction_cost"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸï¸ í† ì§€ë¹„</h3>
                            <div class="text-lg font-bold text-blue-600" id="land_cost"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <h3 class="font-semibold text-gray-700 mb-2">ğŸ’µ ì´ ê³µì‚¬ë¹„</h3>
                            <div class="text-lg font-bold text-purple-600" id="total_cost"></div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="bg-white rounded-lg shadow-lg p-6 result-card">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ¯ ë¶„ì„ ê²°ê³¼</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">LH ì ìˆ˜</div>
                            <div class="text-2xl font-bold text-blue-600" id="lh_score"></div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ë“±ê¸‰</div>
                            <div class="text-2xl font-bold text-green-600" id="lh_grade"></div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ë¦¬ìŠ¤í¬</div>
                            <div class="text-2xl font-bold text-yellow-600" id="risk_level"></div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ìµœì¢… ê²°ì •</div>
                            <div class="text-2xl font-bold text-purple-600" id="decision"></div>
                        </div>
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm text-gray-600">ì‹ ë¢°ë„</div>
                        <div class="text-xl font-bold text-gray-800" id="confidence"></div>
                    </div>
                    
                    <!-- Report Generation Buttons -->
                    <div class="mt-6 text-center space-x-4">
                        <button id="generateReportBtn" 
                            class="hidden bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 shadow-lg">
                            ğŸ“„ HTML ë¦¬í¬íŠ¸ ë³´ê¸°
                        </button>
                        <button id="downloadPdfBtn" 
                            class="hidden bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 shadow-lg">
                            ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = '/api/v9/real/analyze-land';
        const REPORT_API_URL = '/api/v9/real/generate-report';
        let lastRequest = null;

        document.getElementById('analysisForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Hide previous results/errors
            document.getElementById('results').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('submitBtn').disabled = true;

            try {
                // Prepare request
                const requestData = {
                    address: document.getElementById('address').value,
                    land_area: parseFloat(document.getElementById('land_area').value),
                    land_appraisal_price: parseFloat(document.getElementById('land_price').value),
                    zone_type: document.getElementById('zone_type').value
                };

                console.log('Request:', requestData);

                // Call API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();
                console.log('Response:', data);

                if (!data.ok) {
                    throw new Error(data.error?.message || 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }

                // Display auto-calculated fields
                const auto = data.auto_calculated;
                document.getElementById('latitude').textContent = auto.latitude?.toFixed(6) || 'N/A';
                document.getElementById('longitude').textContent = auto.longitude?.toFixed(6) || 'N/A';
                document.getElementById('legal_code').textContent = auto.legal_code || 'N/A';
                document.getElementById('bcr').textContent = auto.building_coverage_ratio || 'N/A';
                document.getElementById('far').textContent = auto.floor_area_ratio || 'N/A';
                document.getElementById('height').textContent = auto.max_height || 'ì œí•œ ì—†ìŒ';
                document.getElementById('units').textContent = auto.unit_count || 'N/A';
                document.getElementById('floors').textContent = auto.floors || 'N/A';
                document.getElementById('parking').textContent = auto.parking_spaces || 'N/A';
                document.getElementById('total_gfa').textContent = (auto.total_gfa || 0).toLocaleString();
                document.getElementById('res_gfa').textContent = (auto.residential_gfa || 0).toLocaleString();
                document.getElementById('construction_cost').textContent = 
                    (auto.construction_cost_per_sqm || 0).toLocaleString() + ' ì›/mÂ²';
                document.getElementById('land_cost').textContent = 
                    (auto.total_land_cost || 0).toLocaleString() + ' ì›';
                document.getElementById('total_cost').textContent = 
                    (auto.total_construction_cost || 0).toLocaleString() + ' ì›';

                // Display analysis results
                const analysis = data.analysis_result;
                if (analysis) {
                    const lh = analysis.lh_scores || {};
                    const risk = analysis.risk_assessment || {};
                    const rec = analysis.final_recommendation || {};

                    document.getElementById('lh_score').textContent = lh.total_score || 'N/A';
                    document.getElementById('lh_grade').textContent = lh.grade || 'N/A';
                    document.getElementById('risk_level').textContent = risk.overall_risk_level || 'N/A';
                    document.getElementById('decision').textContent = rec.decision || 'N/A';
                    document.getElementById('confidence').textContent = 
                        (rec.confidence_level || 'N/A') + '%';
                }

                // Show results
                document.getElementById('results').classList.remove('hidden');
                
                // Show report generation buttons
                document.getElementById('generateReportBtn').classList.remove('hidden');
                document.getElementById('downloadPdfBtn').classList.remove('hidden');
                
                // Store last request for report generation
                lastRequest = requestData;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').textContent = error.message;
                document.getElementById('error').classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('submitBtn').disabled = false;
            }
        });
        
        // Report generation - HTML
        document.getElementById('generateReportBtn').addEventListener('click', async () => {
            if (!lastRequest) {
                alert('ë¨¼ì € í† ì§€ ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const reportBtn = document.getElementById('generateReportBtn');
            reportBtn.disabled = true;
            reportBtn.textContent = 'ğŸ“„ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...';
            
            try {
                console.log('Generating HTML report for:', lastRequest);
                
                const response = await fetch(REPORT_API_URL + '?output_format=html', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(lastRequest)
                });
                
                const data = await response.json();
                console.log('Report response:', data);
                
                if (data.ok && data.report && data.report.content) {
                    // Open report in new window
                    const reportWindow = window.open('', '_blank');
                    reportWindow.document.write(data.report.content);
                    reportWindow.document.close();
                    
                    alert('âœ… ë¦¬í¬íŠ¸ê°€ ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤!');
                } else {
                    throw new Error(data.error?.message || 'ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('Report generation error:', error);
                alert('âŒ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + error.message);
            } finally {
                reportBtn.disabled = false;
                reportBtn.textContent = 'ğŸ“„ ì „ë¬¸ê°€ ë¦¬í¬íŠ¸ ìƒì„±';
            }
        });
    </script>
</body>
</html>

            if (!lastRequest) {
                alert('ë¨¼ì € í† ì§€ ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const pdfBtn = document.getElementById('downloadPdfBtn');
            pdfBtn.disabled = true;
            pdfBtn.textContent = 'ğŸ“¥ PDF ìƒì„± ì¤‘...';
            
            try {
                console.log('Generating PDF for:', lastRequest);
                
                const response = await fetch(REPORT_API_URL + '?output_format=pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(lastRequest)
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ZeroSite_Report_${new Date().toISOString().slice(0,10)}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    alert('âœ… PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
                } else {
                    throw new Error('PDF ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('âŒ PDF ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + error.message);
            } finally {
                pdfBtn.disabled = false;
                pdfBtn.textContent = 'ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ';
            }
        });
    </script>
</body>
</html>
