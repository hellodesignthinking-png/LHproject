<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite v9.1 - LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ í† ì§€ì§„ë‹¨ ì‹œìŠ¤í…œ (4-Field Input)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .auto-calculated-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .required-field-marker {
            color: #3b82f6;
            font-weight: 600;
        }
        
        .auto-field {
            background: #f0f9ff;
            border-color: #93c5fd !important;
        }
        
        .auto-field:focus {
            border-color: #3b82f6 !important;
            ring-color: #3b82f6 !important;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .feature-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gray-50" x-data="zerositeV91App()">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-3">
                    <i class="fas fa-building text-blue-600 text-2xl"></i>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                            ZeroSite
                            <span class="feature-badge">v9.1 âš¡ NEW</span>
                        </h1>
                        <p class="text-xs text-gray-500">60% ì…ë ¥ ê°ì†Œ (10â†’4 í•„ë“œ) - LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ í† ì§€ì§„ë‹¨</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Feature Highlights -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">ğŸš€ ZeroSite v9.1 - ìë™í™” í˜ì‹ </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-bolt text-3xl"></i>
                    <div>
                        <p class="font-semibold">60% ì…ë ¥ ê°ì†Œ</p>
                        <p class="text-sm opacity-90">10ê°œ â†’ 4ê°œ í•„ë“œ</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-clock text-3xl"></i>
                    <div>
                        <p class="font-semibold">80% ì‹œê°„ ë‹¨ì¶•</p>
                        <p class="text-sm opacity-90">5ë¶„ â†’ 1ë¶„ ì…ë ¥</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-magic text-3xl"></i>
                    <div>
                        <p class="font-semibold">12ê°œ í•„ë“œ ìë™</p>
                        <p class="text-sm opacity-90">AI ìë™ ê³„ì‚°</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Form (v9.1 - 4 Fields Only!) -->
        <div class="section-card">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-900 mb-1">í† ì§€ ì •ë³´ ì…ë ¥</h2>
                    <p class="text-sm text-gray-600">
                        <span class="required-field-marker">í•„ìˆ˜ 4ê°œ í•„ë“œë§Œ ì…ë ¥</span>í•˜ì‹œë©´, 
                        ë‚˜ë¨¸ì§€ <strong class="text-blue-600">12ê°œ í•„ë“œëŠ” ìë™ìœ¼ë¡œ ê³„ì‚°</strong>ë©ë‹ˆë‹¤!
                    </p>
                </div>
                <div class="text-right">
                    <p class="text-3xl font-bold text-blue-600">4</p>
                    <p class="text-xs text-gray-500">í•„ìˆ˜ ì…ë ¥ í•„ë“œ</p>
                </div>
            </div>
            
            <form @submit.prevent="analyzeLand">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- CRITICAL 4: Only 4 required fields -->
                    
                    <!-- 1. Address (REQUIRED) -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            <i class="fas fa-map-marker-alt text-blue-600 mr-1"></i>
                            ì£¼ì†Œ <span class="required-field-marker">*</span>
                        </label>
                        <input 
                            type="text" 
                            x-model="landData.address"
                            placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 120"
                            class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                            required>
                        <p class="text-xs text-gray-500 mt-1">
                            âœ¨ ìœ„ë„/ê²½ë„ ìë™ ë³€í™˜
                        </p>
                    </div>
                    
                    <!-- 2. Land Area (REQUIRED) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            <i class="fas fa-ruler-combined text-blue-600 mr-1"></i>
                            ëŒ€ì§€ë©´ì  (ã¡) <span class="required-field-marker">*</span>
                        </label>
                        <input 
                            type="number" 
                            x-model.number="landData.land_area"
                            placeholder="1000"
                            class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                            required>
                    </div>
                    
                    <!-- 3. Land Appraisal Price (REQUIRED) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            <i class="fas fa-won-sign text-blue-600 mr-1"></i>
                            í† ì§€ ê°ì •ê°€ (ì›/ã¡) <span class="required-field-marker">*</span>
                        </label>
                        <input 
                            type="number" 
                            x-model.number="landData.land_appraisal_price"
                            placeholder="9000000"
                            class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                            required>
                        <p class="text-xs text-gray-500 mt-1">
                            ì˜ˆ: 900ë§Œì›/ã¡ â†’ 9000000 ì…ë ¥
                        </p>
                    </div>
                    
                    <!-- 4. Zone Type (REQUIRED) -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-900 mb-2">
                            <i class="fas fa-layer-group text-blue-600 mr-1"></i>
                            ìš©ë„ì§€ì—­ <span class="required-field-marker">*</span>
                        </label>
                        <select 
                            x-model="landData.zone_type"
                            class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                            required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤€ì£¼ê±°ì§€ì—­">ì¤€ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤‘ì‹¬ìƒì—…ì§€ì—­">ì¤‘ì‹¬ìƒì—…ì§€ì—­</option>
                            <option value="ì¼ë°˜ìƒì—…ì§€ì—­">ì¼ë°˜ìƒì—…ì§€ì—­</option>
                            <option value="ê·¼ë¦°ìƒì—…ì§€ì—­">ê·¼ë¦°ìƒì—…ì§€ì—­</option>
                            <option value="ì¤€ê³µì—…ì§€ì—­">ì¤€ê³µì—…ì§€ì—­</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">
                            âœ¨ ê±´íìœ¨/ìš©ì ë¥  ìë™ ì„¤ì •
                        </p>
                    </div>
                </div>
                
                <!-- Auto-Calculated Fields Preview -->
                <div x-show="autoCalculatedFields && Object.keys(autoCalculatedFields).length > 0" 
                     class="mt-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
                        <i class="fas fa-magic text-blue-600"></i>
                        ìë™ ê³„ì‚°ëœ í•„ë“œ (12ê°œ)
                        <span class="auto-calculated-badge">
                            <i class="fas fa-check"></i>
                            AI AUTO
                        </span>
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-xs">
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ìœ„ë„</p>
                            <p class="font-semibold text-gray-900" x-text="autoCalculatedFields.latitude?.toFixed(6) || '-'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ê²½ë„</p>
                            <p class="font-semibold text-gray-900" x-text="autoCalculatedFields.longitude?.toFixed(6) || '-'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ê±´íìœ¨</p>
                            <p class="font-semibold text-gray-900" x-text="(autoCalculatedFields.building_coverage_ratio || '-') + '%'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ìš©ì ë¥ </p>
                            <p class="font-semibold text-gray-900" x-text="(autoCalculatedFields.floor_area_ratio || '-') + '%'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ì„¸ëŒ€ìˆ˜</p>
                            <p class="font-semibold text-blue-600" x-text="(autoCalculatedFields.unit_count || '-') + 'ì„¸ëŒ€'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ì¸µìˆ˜</p>
                            <p class="font-semibold text-blue-600" x-text="(autoCalculatedFields.estimated_floors || '-') + 'ì¸µ'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ì£¼ì°¨ëŒ€ìˆ˜</p>
                            <p class="font-semibold text-blue-600" x-text="(autoCalculatedFields.parking_spaces || '-') + 'ëŒ€'"></p>
                        </div>
                        <div class="bg-white p-2 rounded">
                            <p class="text-gray-600">ì—°ë©´ì </p>
                            <p class="font-semibold text-blue-600" x-text="autoCalculatedFields.total_gfa ? autoCalculatedFields.total_gfa.toFixed(0) + 'ã¡' : '-'"></p>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="mt-6 flex gap-3">
                    <button 
                        type="submit"
                        :disabled="loading"
                        class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg">
                        <i class="fas fa-rocket text-xl"></i>
                        <span x-text="loading ? 'âš¡ ë¶„ì„ ì¤‘...' : 'âš¡ 1ë¶„ ë§Œì— ë¶„ì„ ì‹œì‘'"></span>
                    </button>
                    <button 
                        type="button"
                        @click="resetForm"
                        class="px-6 py-4 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition">
                        <i class="fas fa-redo"></i> ì´ˆê¸°í™”
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Loading State -->
        <div x-show="loading" class="section-card text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium text-lg">ğŸ¤– AIê°€ 12ê°œ í•„ë“œë¥¼ ìë™ ê³„ì‚° ì¤‘...</p>
            <p class="text-sm text-gray-500 mt-2">ì£¼ì†Œ í•´ì„ â†’ ì¢Œí‘œ ë³€í™˜ â†’ ìš©ë„ì§€ì—­ ê¸°ì¤€ â†’ ì„¸ëŒ€ìˆ˜ ì¶”ì • â†’ ì¬ë¬´ ë¶„ì„</p>
        </div>
        
        <!-- Results (same as v9.0, just show auto-calculated fields) -->
        <div x-show="results && !loading" x-cloak>
            <div class="section-card bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-300">
                <h2 class="text-xl font-bold text-gray-900 mb-3">
                    âœ… ë¶„ì„ ì™„ë£Œ! 
                    <span class="text-green-600">12ê°œ í•„ë“œ ìë™ ê³„ì‚° ì„±ê³µ</span>
                </h2>
                <p class="text-gray-700 mb-4">
                    ì…ë ¥ ì‹œê°„: <strong class="text-blue-600" x-text="inputTime + 'ì´ˆ'"></strong> | 
                    ìë™ ê³„ì‚° ì‹œê°„: <strong class="text-purple-600" x-text="analysisTime + 'ì´ˆ'"></strong>
                </p>
                
                <!-- Analysis Results Summary -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-600 mb-1">LH í‰ê°€ì ìˆ˜</p>
                        <p class="text-2xl font-bold text-blue-600" x-text="results?.lh_score + '/110'"></p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-600 mb-1">ìë™ ê³„ì‚° í•„ë“œ</p>
                        <p class="text-2xl font-bold text-purple-600">12ê°œ</p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-600 mb-1">ìµœì¢… ê²°ì •</p>
                        <p class="text-lg font-bold" 
                           :class="results?.decision === 'PROCEED' ? 'text-green-600' : 'text-orange-600'"
                           x-text="results?.decision === 'PROCEED' ? 'âœ“ ì§„í–‰ ê¶Œì¥' : 'â–³ ë³´ì™„ í•„ìš”'"></p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow">
                        <p class="text-sm text-gray-600 mb-1">ì…ë ¥ íš¨ìœ¨</p>
                        <p class="text-2xl font-bold text-green-600">60%â†“</p>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <a href="#" @click.prevent="viewFullReport" 
                       class="inline-flex items-center gap-2 text-blue-600 font-semibold hover:text-blue-800">
                        <i class="fas fa-file-pdf"></i>
                        ì „ì²´ ë¦¬í¬íŠ¸ ë³´ê¸°
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Error Display -->
        <div x-show="error" class="section-card bg-red-50 border-l-4 border-red-600" x-cloak>
            <div class="flex items-start gap-3">
                <i class="fas fa-exclamation-circle text-red-600 text-xl mt-1"></i>
                <div>
                    <h3 class="font-semibold text-red-900 mb-1">ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p class="text-sm text-red-700" x-text="error"></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center">
                <p class="text-sm text-gray-500">
                    Â© 2024 ZeroSite v9.1 - LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ í† ì§€ì§„ë‹¨ ì‹œìŠ¤í…œ (60% ì…ë ¥ ê°ì†Œ, 80% ì‹œê°„ ë‹¨ì¶•)
                </p>
            </div>
        </div>
    </footer>

    <!-- Alpine.js App Logic -->
    <script>
        function zerositeV91App() {
            return {
                // State
                landData: {
                    address: '',
                    land_area: null,
                    land_appraisal_price: null,
                    zone_type: ''
                },
                loading: false,
                results: null,
                error: null,
                autoCalculatedFields: {},
                inputTime: 0,
                analysisTime: 0,
                startTime: null,
                
                // API Base URL
                apiBaseUrl: window.location.origin,
                
                // Methods
                async analyzeLand() {
                    this.loading = true;
                    this.error = null;
                    this.results = null;
                    this.autoCalculatedFields = {};
                    
                    const inputEndTime = Date.now();
                    this.inputTime = this.startTime ? Math.round((inputEndTime - this.startTime) / 1000) : 0;
                    
                    const analysisStartTime = Date.now();
                    
                    try {
                        // Call v9.1 API with only 4 fields
                        const apiPayload = {
                            address: this.landData.address,
                            land_area: this.landData.land_area,
                            land_appraisal_price: this.landData.land_appraisal_price,
                            zone_type: this.landData.zone_type
                        };
                        
                        console.log('ğŸ“¤ [v9.1] Sending minimal input (4 fields):', apiPayload);
                        
                        const response = await fetch(`${this.apiBaseUrl}/api/v9/analyze-land`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(apiPayload)
                        });
                        
                        if (!response.ok) {
                            let errorMessage = '';
                            try {
                                const errorData = await response.json();
                                if (errorData.detail && Array.isArray(errorData.detail)) {
                                    const errors = errorData.detail.map(e => `${e.loc.join('.')}: ${e.msg}`).join(', ');
                                    errorMessage = `ì…ë ¥ê°’ ì˜¤ë¥˜: ${errors}`;
                                } else if (errorData.detail) {
                                    errorMessage = typeof errorData.detail === 'string' ? errorData.detail : JSON.stringify(errorData.detail);
                                } else {
                                    errorMessage = JSON.stringify(errorData);
                                }
                            } catch (e) {
                                errorMessage = await response.text();
                            }
                            throw new Error(`API ì˜¤ë¥˜ (${response.status}): ${errorMessage}`);
                        }
                        
                        const responseData = await response.json();
                        console.log('ğŸ“¥ [v9.1] Response:', responseData);
                        
                        if (responseData.success && responseData.data) {
                            this.results = {
                                lh_score: responseData.data.lh_scores?.total_score || 0,
                                decision: responseData.data.final_recommendation?.decision || 'REVISE',
                                full_data: responseData.data
                            };
                            
                            // Extract auto-calculated fields
                            this.autoCalculatedFields = responseData.auto_calculated_fields || {};
                            
                            console.log('âœ… [v9.1] Auto-calculated fields:', this.autoCalculatedFields);
                            
                            const analysisEndTime = Date.now();
                            this.analysisTime = Math.round((analysisEndTime - analysisStartTime) / 1000);
                        } else {
                            throw new Error(responseData.message || 'ë¶„ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                        }
                        
                    } catch (err) {
                        this.error = err.message || String(err);
                        console.error('âŒ [v9.1] Analysis error:', err);
                    } finally {
                        this.loading = false;
                    }
                },
                
                resetForm() {
                    this.landData = {
                        address: '',
                        land_area: null,
                        land_appraisal_price: null,
                        zone_type: ''
                    };
                    this.results = null;
                    this.error = null;
                    this.autoCalculatedFields = {};
                    this.startTime = Date.now();
                },
                
                viewFullReport() {
                    alert('ì „ì²´ ë¦¬í¬íŠ¸ ê¸°ëŠ¥ì€ v9.0 UIë¥¼ ì°¸ì¡°í•˜ì„¸ìš” (index.html)');
                },
                
                init() {
                    this.startTime = Date.now();
                    console.log('ğŸš€ ZeroSite v9.1 Frontend initialized (4-field input)');
                }
            }
        }
    </script>
</body>
</html>
