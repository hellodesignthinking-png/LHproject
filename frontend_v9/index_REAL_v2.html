<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite v9.1 REAL - Expert Edition (v2.0)</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .result-card { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg p-6 mb-6 text-white">
                <h1 class="text-3xl font-bold mb-2">
                    ğŸ¯ ZeroSite v9.1 REAL - Expert Edition
                </h1>
                <p class="text-purple-100">
                    v11.0 Expert Edition ë¦¬í¬íŠ¸ ìƒì„±ê¸° | 4ê°œ ì…ë ¥ â†’ 13ê°œ ìë™ ê³„ì‚°
                </p>
                <div class="mt-2 text-sm text-purple-200">
                    âœ… v2.0 - ìºì‹œ ì—†ëŠ” ìµœì‹  ë²„ì „
                </div>
            </div>

            <!-- Input Form -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ“ ì…ë ¥ ì •ë³´ (4ê°œ í•„ë“œë§Œ)</h2>
                
                <form id="analysisForm" class="space-y-4">
                    <!-- 1. ì£¼ì†Œ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            1. ì£¼ì†Œ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="address" required
                            placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 120"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 2. ëŒ€ì§€ë©´ì  -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            2. ëŒ€ì§€ë©´ì  (mÂ²) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="land_area" required
                            placeholder="ì˜ˆ: 1000"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 3. í† ì§€ ê°ì •ê°€ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            3. í† ì§€ ê°ì •ê°€ (ì›/mÂ²) <span class="text-red-500">*</span>
                        </label>
                        <input type="number" id="land_price" required
                            placeholder="ì˜ˆ: 9000000"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 4. ìš©ë„ì§€ì—­ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            4. ìš©ë„ì§€ì—­ <span class="text-red-500">*</span>
                        </label>
                        <select id="zone_type" required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ1ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤€ì£¼ê±°ì§€ì—­">ì¤€ì£¼ê±°ì§€ì—­</option>
                            <option value="ì¤‘ì‹¬ìƒì—…ì§€ì—­">ì¤‘ì‹¬ìƒì—…ì§€ì—­</option>
                            <option value="ì¼ë°˜ìƒì—…ì§€ì—­">ì¼ë°˜ìƒì—…ì§€ì—­</option>
                            <option value="ê·¼ë¦°ìƒì—…ì§€ì—­">ê·¼ë¦°ìƒì—…ì§€ì—­</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submitBtn"
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                        ğŸš€ Expert Edition ë¶„ì„ ì‹œì‘
                    </button>
                </form>
            </div>

            <!-- Loading -->
            <div id="loading" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                <div class="flex items-center justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
                    <span class="text-blue-700 font-medium">Expert Edition ë¶„ì„ ì¤‘...</span>
                </div>
            </div>

            <!-- Error -->
            <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                <h3 class="text-red-800 font-bold mb-2">âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                <p id="errorMessage" class="text-red-700"></p>
            </div>

            <!-- Results -->
            <div id="results" class="hidden space-y-6">
                <!-- Analysis Results -->
                <div class="bg-white rounded-lg shadow-lg p-6 result-card">
                    <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ¯ ë¶„ì„ ê²°ê³¼</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">LH ì ìˆ˜</div>
                            <div class="text-2xl font-bold text-blue-600" id="lh_score"></div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ë“±ê¸‰</div>
                            <div class="text-2xl font-bold text-green-600" id="lh_grade"></div>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ë¦¬ìŠ¤í¬</div>
                            <div class="text-2xl font-bold text-yellow-600" id="risk_level"></div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-sm text-gray-600 mb-1">ìµœì¢… ê²°ì •</div>
                            <div class="text-2xl font-bold text-purple-600" id="decision"></div>
                        </div>
                    </div>
                    
                    <!-- Report Generation Buttons -->
                    <div class="mt-6 text-center space-x-4">
                        <button id="generateReportBtn" 
                            class="hidden bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 shadow-lg">
                            ğŸ“„ Expert Edition HTML ë¦¬í¬íŠ¸
                        </button>
                        <button id="downloadPdfBtn" 
                            class="hidden bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 shadow-lg">
                            ğŸ“¥ Expert Edition PDF ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cache buster
        console.log('ğŸ¯ Expert Edition Frontend v2.0 - Cache-Free Version');
        console.log('â° Loaded at:', new Date().toISOString());
        
        const API_URL = '/api/v9/real/analyze-land';
        const REPORT_API_URL = '/api/v9/real/generate-report';
        let lastRequest = null;

        document.getElementById('analysisForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            document.getElementById('results').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('submitBtn').disabled = true;

            try {
                const requestData = {
                    address: document.getElementById('address').value,
                    land_area: parseFloat(document.getElementById('land_area').value),
                    land_appraisal_price: parseFloat(document.getElementById('land_price').value),
                    zone_type: document.getElementById('zone_type').value
                };

                console.log('ğŸ“¤ Request:', requestData);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();
                console.log('ğŸ“¥ Response:', data);

                if (!data.ok) {
                    throw new Error(data.error?.message || 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }

                const analysis = data.analysis_result;
                if (analysis) {
                    const lh = analysis.lh_scores || {};
                    const risk = analysis.risk_assessment || {};
                    const rec = analysis.final_recommendation || {};

                    document.getElementById('lh_score').textContent = lh.total_score || 'N/A';
                    document.getElementById('lh_grade').textContent = lh.grade || 'N/A';
                    document.getElementById('risk_level').textContent = risk.overall_risk_level || 'N/A';
                    document.getElementById('decision').textContent = rec.decision || 'N/A';
                }

                document.getElementById('results').classList.remove('hidden');
                document.getElementById('generateReportBtn').classList.remove('hidden');
                document.getElementById('downloadPdfBtn').classList.remove('hidden');
                
                lastRequest = requestData;
                
            } catch (error) {
                console.error('âŒ Error:', error);
                document.getElementById('errorMessage').textContent = error.message;
                document.getElementById('error').classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('submitBtn').disabled = false;
            }
        });
        
        // HTML Report
        document.getElementById('generateReportBtn').addEventListener('click', async () => {
            if (!lastRequest) {
                alert('ë¨¼ì € í† ì§€ ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const reportBtn = document.getElementById('generateReportBtn');
            reportBtn.disabled = true;
            reportBtn.textContent = 'ğŸ“„ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...';
            
            try {
                console.log('ğŸ“„ Generating HTML report...');
                
                const response = await fetch(REPORT_API_URL + '?output_format=html', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(lastRequest)
                });
                
                const data = await response.json();
                
                if (data.ok && data.report && data.report.content) {
                    const reportWindow = window.open('', '_blank');
                    reportWindow.document.write(data.report.content);
                    reportWindow.document.close();
                    alert('âœ… Expert Edition ë¦¬í¬íŠ¸ê°€ ìƒˆ ì°½ì—ì„œ ì—´ë ¸ìŠµë‹ˆë‹¤!');
                } else {
                    throw new Error(data.error?.message || 'ë¦¬í¬íŠ¸ ìƒì„± ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('âŒ Report error:', error);
                alert('âŒ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + error.message);
            } finally {
                reportBtn.disabled = false;
                reportBtn.textContent = 'ğŸ“„ Expert Edition HTML ë¦¬í¬íŠ¸';
            }
        });
        
        // PDF Download - WITH CACHE BUSTING!
        document.getElementById('downloadPdfBtn').addEventListener('click', async () => {
            if (!lastRequest) {
                alert('ë¨¼ì € í† ì§€ ë¶„ì„ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const pdfBtn = document.getElementById('downloadPdfBtn');
            pdfBtn.disabled = true;
            pdfBtn.textContent = 'ğŸ“¥ PDF ìƒì„± ì¤‘...';
            
            try {
                console.log('ğŸ“¥ Generating PDF with cache busting...');
                console.log('Request data:', lastRequest);
                
                const response = await fetch(REPORT_API_URL + '?output_format=pdf&nocache=' + Date.now(), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(lastRequest),
                    cache: 'no-store'  // Force no cache
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const sizeMB = (blob.size / 1024 / 1024).toFixed(2);
                    const sizeKB = (blob.size / 1024).toFixed(1);
                    
                    console.log(`ğŸ“Š PDF Size: ${blob.size} bytes (${sizeKB} KB / ${sizeMB} MB)`);
                    
                    // Create unique filename with timestamp
                    const timestamp = Date.now();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ZeroSite_ExpertEdition_${timestamp}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Alert based on size
                    if (blob.size < 100000) {
                        alert(`âœ… Expert Edition PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!\n\ní¬ê¸°: ${sizeKB} KB (ì‹ ë²„ì „)\níŒŒì¼ëª…: ZeroSite_ExpertEdition_${timestamp}.pdf\n\nâœ¨ ì´ê²ƒì´ ì§„ì§œ Expert Editionì…ë‹ˆë‹¤!`);
                    } else {
                        alert(`âš ï¸ PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\n\ní¬ê¸°: ${sizeMB} MB\níŒŒì¼ëª…: ZeroSite_ExpertEdition_${timestamp}.pdf\n\nâš ï¸ í¬ê¸°ê°€ í° ê²½ìš° êµ¬ë²„ì „ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì‹œí¬ë¦¿ ëª¨ë“œë¡œ ì¬ì‹œë„í•´ì£¼ì„¸ìš”.`);
                    }
                } else {
                    throw new Error('PDF ìƒì„± ì‹¤íŒ¨: ' + response.status);
                }
                
            } catch (error) {
                console.error('âŒ PDF error:', error);
                alert('âŒ PDF ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + error.message);
            } finally {
                pdfBtn.disabled = false;
                pdfBtn.textContent = 'ğŸ“¥ Expert Edition PDF ë‹¤ìš´ë¡œë“œ';
            }
        });
    </script>
</body>
</html>
