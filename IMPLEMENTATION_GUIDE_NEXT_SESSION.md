# 🚀 다음 세션 실행 가이드 - 6종 보고서 구현

## 📋 전체 상황 요약

### ✅ 현재까지 완료된 작업 (2025-12-31)
1. **M2~M6 레이아웃 문제 해결** (PR #16)
   - CSS @page 중복 제거
   - 페이지 번호 동적 계산
   - 모듈 간 전제 조건 박스 추가
2. **6종 보고서 아키텍처 설계 완료**
   - REPORT_ARCHITECTURE_6TYPES.md 작성

### ⚠️ 다음 세션 목표
**M2~M6 데이터를 기반으로 6종 독립 보고서 템플릿 구현**

---

## 🔴 절대 원칙 (다시 한번 강조)

### 불변 규칙
```
❌ M2~M6 계산 로직 수정 금지
❌ 수치/점수/IRR 재가공 금지
❌ 새로운 데이터 생성 금지

✅ 출력 구조만 변경
✅ 해석 문장만 조정
✅ 강조점만 이동
```

### 역할 정의
```
당신은 "계산자"가 아니라 "보고서 편집자·구성자"입니다.
```

---

## 📚 4개 핵심 프롬프트

---

## 1️⃣ 전체 아키텍처 확인 프롬프트

### 사용 시점
- 다음 세션 시작 시 맨 처음 실행
- 방향성 재확인용

### 프롬프트
```
당신은 공공주택·LH 매입임대 보고서 시스템의 리포트 아키텍트입니다.

아래 파일을 읽고 전체 아키텍처를 이해하십시오:
- REPORT_ARCHITECTURE_6TYPES.md

그리고 다음을 확인하십시오:

1. 6종 보고서의 목적과 독자가 명확히 구분되는가?
2. 각 보고서에서 M2~M6 모듈을 어떻게 다르게 사용하는가?
3. 공통 컴포넌트(대상지 식별정보 표)는 무엇인가?
4. 절대 금지 원칙(계산 로직 수정 금지)을 이해했는가?

위 4가지를 간단히 요약하여 답변하십시오.
```

### 기대 결과
- 아키텍처 이해도 확인
- 다음 작업 방향 정렬

---

## 2️⃣ 🔥 LH 기술검증 보고서 템플릿 생성 프롬프트 (최우선)

### 사용 시점
- 아키텍처 확인 직후
- **가장 먼저 구현**

### 프롬프트
```
당신은 LH 내부 기술검증 보고서를 작성하는 공공주택 심사 실무자 출신 분석가입니다.

아래 조건을 만족하는 LH 제출용 기술검증 보고서 템플릿을 작성하십시오.

---

## 템플릿 기본 정보

파일명: app/templates_v13/lh_technical_validation.html
목적: LH 내부 검토 및 기술·사업 적합성 판단
성격: 객관적 / 조건부 / 비확정
대상 독자: LH 담당자, 기술검토위원, 외부 심의자

---

## 필수 구성 (18-22 페이지)

### 1. 표지 (1p)
- 보고서명: "LH 제출용 기술검증 보고서"
- 대상지 주소: {{ meta.address }}
- PNU: {{ meta.parcel_id }}
- 분석 RUN_ID: {{ meta.run_id }}
- 분석 기준일: {{ meta.eval_base_date }}
- 하단 주석: "본 보고서는 LH 내부 검토 참고용이며, 법적 효력이 없습니다."

### 2. 분석 개요 & 범위 선언 (1p)
필수 문구:
- "본 보고서는 ZeroSite M2~M6 자동 분석 결과를 기반으로 작성되었습니다."
- "분석 목적: LH 매입임대 사업 사전 기술검증"
- "적용 기준: LH 매입임대 운영 기준 / 공공주택 사업 기준"
- "분석 범위: 토지평가(M2), 공급유형(M3), 건축규모(M4), 사업성(M5), 종합판단(M6)"
- "한계: 본 분석은 시뮬레이션 기반이며, 실제 매입 확정과 무관합니다."

### 3. 대상지 식별정보 (1p)
※ 공통 컴포넌트 사용 (아래 5번 프롬프트 참조)

<table class="site-identity-table">
    <tr>
        <th>대상지 주소</th>
        <td>{{ meta.address }}</td>
    </tr>
    <tr>
        <th>필지번호 (PNU)</th>
        <td>{{ meta.parcel_id }}</td>
    </tr>
    <tr>
        <th>분석 기준일</th>
        <td>{{ meta.eval_base_date }}</td>
    </tr>
    <tr>
        <th>분석 실행 ID</th>
        <td style="font-family: monospace; font-size: 9pt;">{{ meta.run_id }}</td>
    </tr>
    <tr>
        <th>적용 기준</th>
        <td>LH 매입임대 운영 기준 / 공공주택 사업 기준</td>
    </tr>
</table>

### 4. M2 토지감정평가 기술 검토 (4p)

#### 섹션 구성:
- 4.1 평가 개요
- 4.2 거래사례 분석 (공공 조정 논리 중심)
- 4.3 최종 평가액 산출
- 4.4 기술 검토 의견

#### 톤 규칙:
✅ "거래사례 {{ transaction_count }}건을 분석한 결과, 평균 단가는 {{ avg_price }} 원/㎡로 산정되었습니다."
✅ "LH 공공 매입 기준을 적용하여 보수적으로 조정한 결과, 최종 평가액은 {{ price_per_sqm }} 원/㎡로 판단됩니다."
✅ "본 평가액은 공시지가 대비 약 {{ adjustment_ratio }}% 수준으로, LH 매입 기준에 부합하는 것으로 해석됩니다."

❌ "탁월한 입지"
❌ "매우 우수한"
❌ "반드시 매입해야 함"

### 5. M3 공급유형 적합성 검토 (3p)

#### 섹션 구성:
- 5.1 5개 공급유형 비교표
- 5.2 청년형 매입임대 선정 근거
- 5.3 정책 부합성 검토

#### 필수 문구:
- "청년형 매입임대는 종합 점수 {{ m3_score }}점으로 1순위로 평가되었습니다."
- "해당 판단은 대상지 입지(상암 DMC + 홍대/연남 생활권), 접근성, 주거 수요 분석을 종합한 결과입니다."
- "최종 공급유형은 LH 내부 정책 및 지역별 공급 계획에 따라 조정될 수 있습니다."

### 6. M4 건축규모 적합성 검토 (4p)

#### 섹션 구성:
- 6.1 3개 대안 비교표
- 6.2 B안(34세대) 선정 근거
- 6.3 법규 및 LH 운영 기준 검토
- 6.4 주차·효율률 검증

#### 필수 문구:
- "B안(34세대)은 법적 최대치가 아닌, LH 운영 기준에 부합하는 실행 가능한 규모로 판단됩니다."
- "효율률 {{ efficiency_rate }}%, 주차 {{ parking_spaces }}대는 LH 매입임대 기준을 충족합니다."
- "최종 건축 규모는 인허가 과정에서 조정될 수 있습니다."

### 7. M5 사업성 기술 검증 (4p)

#### 섹션 구성:
- 7.1 3개 시나리오 비교표
- 7.2 IRR 4.8% 해석 (공공 기준)
- 7.3 민감도 분석
- 7.4 재무 안정성 평가

#### 필수 문구:
- "IRR {{ irr_value }}%는 공공 매입임대 기준(4~5%)에 부합하는 적정 수준으로 해석됩니다."
- "본 IRR은 민간 사업 기준(8~12%)과 직접 비교할 수 없으며, 공공주택 정책 목표를 반영한 수치입니다."
- "사업성 판단은 토지가격(M2), 공급유형(M3), 건축규모(M4)를 전제로 한 결과입니다."

### 8. M6 종합 기술 판단 (2p)

#### 섹션 구성:
- 8.1 모듈별 평가 요약 (M2~M5)
- 8.2 리스크 종합 평가
- 8.3 최종 기술 판단

#### 필수 문구 (반드시 포함):
```
본 대상지는 다음과 같은 평가 결과를 종합할 때,
조건부 검토 가능 대상으로 판단됩니다.

• M2 토지평가: 공공 기준 적정 수준
• M3 공급유형: 청년형 매입임대 1순위
• M4 건축규모: B안 34세대 (LH 운영 기준 부합)
• M5 사업성: IRR 4.8% (공공 기준 적정)

다만, 본 판단은 시뮬레이션 기반이며,
실제 매입 여부는 다음 조건의 충족 여부에 따라 결정됩니다:

1. LH 내부 심사 기준 통과
2. 토지주와의 협의 완료
3. 인허가 실사 완료
4. 지역별 공급 계획과의 정합성 확인

따라서 즉시 매입 확정 대상은 아니며,
추가 실사 및 내부 검토가 필요합니다.
```

### 9. 검토 한계 및 유의사항 (1p)

#### 필수 문구:
- "본 보고서는 자동 분석 시스템에 의해 생성된 시뮬레이션 결과입니다."
- "실제 현장 실사, 인허가 검토, 토지주 협의 등은 별도로 수행되어야 합니다."
- "본 분석 결과는 LH 내부 의사결정을 대체할 수 없으며, 참고 자료로만 활용되어야 합니다."
- "최종 매입 여부는 LH 내부 심사 기준 및 정책 방향에 따라 결정됩니다."

---

## 디자인 & 레이아웃 규칙

### CSS 스타일
- M2~M6 Classic 템플릿과 동일한 디자인 시스템 사용
- 폰트: Malgun Gothic (맑은 고딕)
- 색상: Navy (#003366), Gray (#6c757d), Soft Blue (#e8f4f8)
- 표: 3선 테이블 (header, 구분선, footer)

### 페이지 구성
- A4 기준
- 상단 여백: 20mm
- 페이지 번호: 하단 중앙 (동적 계산)
- 워터마크: "ZEROSITE" (투명도 3%)

---

## 데이터 바인딩

### 사용할 변수 (Jinja2)
```python
# 메타 정보
{{ meta.address }}           # 대상지 주소
{{ meta.parcel_id }}         # PNU
{{ meta.run_id }}            # RUN_ID
{{ meta.eval_base_date }}    # 평가 기준일

# M2 데이터
{{ m2.price_per_sqm }}       # 최종 평가액 (원/㎡)
{{ m2.transaction_count }}   # 거래사례 건수
{{ m2.avg_price }}           # 평균 단가

# M3 데이터
{{ m3.recommended_type }}    # 추천 공급유형
{{ m3.score }}               # 종합 점수
{{ m3.confidence }}          # 신뢰도

# M4 데이터
{{ m4.recommended_plan }}    # 추천 대안 (B안)
{{ m4.unit_count }}          # 세대수
{{ m4.efficiency_rate }}     # 효율률
{{ m4.parking_spaces }}      # 주차 대수

# M5 데이터
{{ m5.irr }}                 # IRR
{{ m5.npv }}                 # NPV

# M6 데이터
{{ m6.final_decision }}      # 최종 판단
{{ m6.risk_level }}          # 리스크 레벨
```

---

## 산출물 요구사항

1. **실제 사용 가능한 HTML 템플릿**
   - 더미 텍스트 금지
   - 실제 문장 수준

2. **Jinja2 변수 바인딩**
   - {{ }} 구문 사용
   - 기본값 처리: {{ meta.address | default('주소 확인 필요') }}

3. **CSS 인라인 스타일**
   - PDF 변환 안정성 확보

4. **주석 포함**
   - <!-- 섹션 시작: M2 토지감정평가 -->

---

## 최종 검증 질문

템플릿 작성 후 다음을 확인하십시오:

1. ✅ M2~M6 계산을 수정하지 않았는가?
2. ✅ 객관적·기술적 톤을 유지했는가?
3. ✅ "조건부 검토 가능" 문구가 명확한가?
4. ✅ 설득/마케팅 표현이 없는가?
5. ✅ LH 담당자가 읽기에 적합한가?

모두 YES여야 합니다.

---

이 프롬프트를 100% 준수하여 LH 제출용 기술검증 보고서 템플릿을 완성하십시오.
```

---

## 3️⃣ 공통 컴포넌트 추출 프롬프트

### 사용 시점
- LH 템플릿 작성 직후
- 다른 5종 보고서에도 재사용

### 프롬프트
```
당신은 리포트 UI/UX 전문가입니다.

아래 조건을 만족하는 '대상지 식별정보 표' 공통 컴포넌트를 설계하십시오.

---

## 요구사항

### 목적
- 모든 보고서(M2~M6 Classic, 6종 보고서)에 공통 사용
- 일관된 디자인과 데이터 구조

### 기술 스택
- HTML5 + CSS3
- Jinja2 템플릿 엔진
- PDF 변환 고려 (WeasyPrint 또는 유사 엔진)

### 필수 포함 항목
1. 대상지 주소
2. 필지번호 (PNU)
3. 분석 실행 ID (RUN_ID)
4. 분석 기준일
5. 적용 기준 (LH 매입임대 운영 기준 / 공공주택 사업 기준)

### 디자인 요구사항
- 표 깨짐 방지 (page-break-inside: avoid)
- PDF 변환 시 안정성 확보
- 가독성 최우선
- 3선 테이블 스타일 (header, body, footer 구분선)

---

## 산출물

### 1. HTML 구조
```html
<!-- 공통 컴포넌트: 대상지 식별정보 표 -->
<div class="site-identity-block">
    <h2 class="section-title">대상지 식별 정보</h2>
    <table class="site-identity-table">
        <!-- 여기에 표 구조 작성 -->
    </table>
</div>
```

### 2. CSS 클래스 정의
```css
.site-identity-block { }
.site-identity-table { }
.site-identity-table th { }
.site-identity-table td { }
```

### 3. Jinja2 변수 바인딩
```jinja2
{{ meta.address }}
{{ meta.parcel_id }}
{{ meta.run_id }}
{{ meta.eval_base_date }}
```

### 4. 재사용 가이드
- 어떤 보고서에 어떻게 삽입하는가?
- 커스터마이징 가능 영역은?

---

이 프롬프트를 100% 준수하여 공통 컴포넌트를 완성하십시오.
```

---

## 4️⃣ 나머지 5종 보고서 순차 생성 프롬프트

### 사용 시점
- LH 템플릿 완성 후
- 한 번에 하나씩 순차 진행

### 프롬프트 (A. 종합 최종보고서 예시)
```
당신은 공공주택 분석 전문가입니다.

REPORT_ARCHITECTURE_6TYPES.md를 참조하여,
"A. 종합 최종보고서 (Master Report)" 템플릿을 작성하십시오.

---

## 템플릿 기본 정보

파일명: app/templates_v13/master_comprehensive_report.html
목적: M2~M6 전체 분석을 하나의 논리 흐름으로 통합한 아카이브용 기준 문서
독자: 토지주, LH, 내부 의사결정자, 파트너사 (가장 범용)
톤: 중립적, 설명 중심, 결론 강요 금지
페이지 수: 20-25

---

## 필수 구성

1. 표지 (1p)
2. Executive Summary (2p)
   - 핵심 결론 4가지
   - KPI 카드 (토지가격, 공급유형, 규모, IRR)
3. 대상지 식별정보 (1p)
   - 공통 컴포넌트 사용
4. M2 토지감정평가 (4-5p)
   - 평가 개요
   - 거래사례 분석
   - 공공 조정 논리
   - 최종 평가액 산출
5. M3 공급유형 판단 (3-4p)
   - 5개 공급유형 비교표
   - 청년형 매입임대 선정 근거
6. M4 건축규모 판단 (4-5p)
   - 3개 대안 비교
   - B안(34세대) 선정 근거
7. M5 사업성 분석 (4-5p)
   - 3개 시나리오 비교
   - IRR 4.8% 해석
8. M6 종합 판단 (2-3p)
   - 모듈별 요약
   - 최종 판단 (조건부)
9. 부록 (1-2p)
   - 기준 및 가정
   - 주의사항

---

## 톤 규칙

✅ 허용:
- "~로 판단됨"
- "~로 분석됨"
- "조건 충족 시 검토 가능"

❌ 금지:
- "확정"
- "보장"
- 한쪽에 치우친 표현

---

이 지침을 100% 준수하여 템플릿을 작성하십시오.
```

※ B, D, E, F 보고서도 동일한 구조로 프롬프트 작성

---

## 📋 다음 세션 실행 순서

### Phase 1: 확인 (5분)
1. REPORT_ARCHITECTURE_6TYPES.md 읽기
2. 전체 아키텍처 이해도 확인 (프롬프트 1️⃣)

### Phase 2: LH 보고서 (60-90분)
3. LH 기술검증 보고서 템플릿 작성 (프롬프트 2️⃣)
4. 공통 컴포넌트 추출 (프롬프트 3️⃣)
5. 백엔드 라우팅 추가
6. 테스트 및 검증

### Phase 3: 나머지 보고서 (120-180분)
7. A. 종합 최종보고서 (프롬프트 4️⃣)
8. B. 토지주 제출용 보고서
9. D. 사업성·투자 검토 보고서
10. E. 사전 검토 리포트
11. F. 설명용 프레젠테이션

### Phase 4: 통합 (30분)
12. 전체 테스트
13. 문서화
14. PR 생성

---

## 🔍 중간 검증 체크리스트

각 보고서 완성 시 다음을 확인:

1. ☐ M2~M6 계산을 수정하지 않았는가?
2. ☐ 독자에 맞는 톤을 유지했는가?
3. ☐ 공통 컴포넌트를 재사용했는가?
4. ☐ 데이터 바인딩이 올바른가?
5. ☐ PDF 변환 시 안정적인가?

---

## 📦 최종 산출물

### 템플릿 파일 (6개)
```
app/templates_v13/
  ├─ lh_technical_validation.html        (C. LH 기술검증) ⭐
  ├─ master_comprehensive_report.html    (A. 종합 최종)
  ├─ landowner_submission_report.html    (B. 토지주 제출)
  ├─ investment_feasibility_report.html  (D. 투자 검토)
  ├─ quick_review_report.html            (E. 사전 검토)
  └─ presentation_report.html            (F. 프레젠테이션)
```

### 공통 컴포넌트
```
app/templates_v13/components/
  └─ site_identity_block.html
```

### 백엔드 라우팅
```python
# app/routers/reports.py
@router.get("/reports/{report_type}/html")
async def get_report_html(
    report_type: str,  # master, landowner, lh_technical, etc.
    context_id: str
):
    # ...
```

---

## 🚨 주의사항

### 절대 하지 말 것
1. M2~M6 계산 로직 수정
2. 수치 재가공
3. 새로운 데이터 생성
4. 보고서 간 톤 혼용

### 반드시 할 것
1. 각 보고서 독자 명확히 인식
2. 공통 컴포넌트 재사용
3. 데이터 바인딩 일관성 유지
4. 중간 검증 체크리스트 확인

---

**문서 작성일**: 2025-12-31  
**다음 세션 시작 시**: 이 문서를 맨 먼저 읽으십시오  
**상태**: ✅ **READY FOR NEXT SESSION**
