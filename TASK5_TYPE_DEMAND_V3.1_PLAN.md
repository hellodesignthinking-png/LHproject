# 🎯 ZeroSite v7.1 - Task 5: Type Demand Score v3.1

**날짜**: 2024-12-01  
**우선순위**: HIGH (3/5 핵심 개선사항)  
**예상 시간**: 3-4시간  
**현재 진행률**: 44.4% → 55.6% (목표)

---

## 📋 **작업 개요**

### **목표**
LH 2025 공식 규정 100% 반영한 유형별 수요 점수 시스템 v3.1 구축

### **현재 상태 (v3.0)**
- LH 2024 기준 적용
- 5가지 유형 지원 (청년, 신혼I, 신혼II, 다자녀, 고령자)
- POI 거리 가중치 차등 적용
- 문제: 타입별 점수 차이 불안정 (현재 6-12점)

### **목표 상태 (v3.1)**
- ✅ LH 2025 기준 100% 반영
- ✅ 다자녀 가중치 +3 적용
- ✅ 신혼I·II 차별 점수 (현재 동일 → 5점 차이)
- ✅ 고령자 시설 가중치 강화
- ✅ POI 반영률 조정 (학교 +10%, 병원 +15%)
- ✅ 타입별 점수 차이 12-25점 안정화

---

## 🎯 **핵심 구현 사항**

### **1. LH 2025 기준 가중치 업데이트**

#### **Before (v3.0 - 2024 기준)**
```python
"다자녀": {
    "base": {
        "교통접근성": 15,
        "교육시설": 35,  # 현재
        "의료시설": 25,
        "편의시설": 10,
        "인구밀도": 15
    }
}
```

#### **After (v3.1 - 2025 기준)** 🎉
```python
"다자녀": {
    "base": {
        "교통접근성": 15,
        "교육시설": 38,  # +3 증가
        "의료시설": 25,
        "편의시설": 10,
        "인구밀도": 12   # -3 조정
    }
}
```

### **2. 신혼·신생아 I vs II 차별화**

#### **Before (v3.0)**
- 신혼I: 교육 30, 의료 25 (차이: 5)
- 신혼II: 교육 25, 의료 30 (차이: 5)
- **문제**: 최종 점수 차이 2-4점 (불안정)

#### **After (v3.1)** 🎉
```python
"신혼·신생아 I": {
    "base": {
        "교통접근성": 20,
        "교육시설": 32,  # +2 (학교 중심)
        "의료시설": 23,  # -2
        "편의시설": 10,
        "인구밀도": 15
    },
    "poi_multipliers": {
        "school": 1.7,   # 1.5 → 1.7 (+13%)
        "hospital": 1.3, # 1.4 → 1.3 (-7%)
    }
}

"신혼·신생아 II": {
    "base": {
        "교통접근성": 20,
        "교육시설": 22,  # -3
        "의료시설": 33,  # +3 (의료 중심)
        "편의시설": 10,
        "인구밀도": 15
    },
    "poi_multipliers": {
        "hospital": 1.7,  # 1.5 → 1.7 (+13%)
        "school": 1.2,    # 1.3 → 1.2 (-8%)
    }
}
```

**결과**: 신혼I·II 점수 차이 **5-8점** 보장

### **3. 고령자 의료시설 가중치 강화**

#### **Before (v3.0)**
```python
"고령자": {
    "base": {
        "의료시설": 40,
    },
    "poi_multipliers": {
        "hospital": 1.6,
    }
}
```

#### **After (v3.1)** 🎉
```python
"고령자": {
    "base": {
        "의료시설": 45,  # +5 (최우선)
        "편의시설": 20,  # 유지
        "교통접근성": 15, # 유지
        "인구밀도": 15,   # -5
        "교육시설": 5
    },
    "poi_multipliers": {
        "hospital": 1.8,  # 1.6 → 1.8 (+12.5%)
        "convenience": 1.4, # 1.3 → 1.4
    }
}
```

### **4. POI 거리 반영률 조정**

#### **학교 POI +10% 적용**
```python
# Before
DISTANCE_STANDARDS = {
    "school": {
        "excellent": 300,
        "good": 600,
        "fair": 1000,
        "poor": 1500
    }
}

# After
DISTANCE_STANDARDS = {
    "school": {
        "excellent": 400,   # +100m (33%)
        "good": 700,        # +100m (17%)
        "fair": 1100,       # +100m (10%)
        "poor": 1650        # +150m (10%)
    }
}
```

#### **병원 POI +15% 적용**
```python
# Before
"hospital": {
    "excellent": 500,
    "good": 1000,
    "fair": 1500,
    "poor": 2000
}

# After
"hospital": {
    "excellent": 600,   # +100m (20%)
    "good": 1200,       # +200m (20%)
    "fair": 1800,       # +300m (20%)
    "poor": 2500        # +500m (25%)
}
```

### **5. 타입별 POI 우선순위 차별화**

#### **Required POIs 재정의**
```python
TYPE_WEIGHTS = {
    "청년": {
        "required_pois": ["subway", "convenience", "university"],
        "critical_poi": "subway",  # 신규: 핵심 POI
        "poi_weight_adjustment": 1.2  # 청년 전용 가산점
    },
    
    "신혼·신생아 I": {
        "required_pois": ["school", "hospital", "subway"],
        "critical_poi": "school",  # 학교 필수
        "poi_weight_adjustment": 1.3
    },
    
    "다자녀": {
        "required_pois": ["school", "hospital", "convenience"],
        "critical_poi": "school",
        "poi_weight_adjustment": 1.4  # 다자녀 최고 가산점
    },
    
    "고령자": {
        "required_pois": ["hospital", "convenience", "subway"],
        "critical_poi": "hospital",  # 병원 필수
        "poi_weight_adjustment": 1.5
    }
}
```

---

## 📊 **예상 점수 분포 (v3.1)**

### **테스트 케이스: "서울 강남구 역삼동"**

#### **POI 거리**
- 지하철: 200m
- 학교: 500m
- 병원: 800m
- 편의점: 150m
- 대학: 1500m

#### **v3.0 점수 (현재)**
```
청년: 82.3점
신혼I: 80.5점   ← 차이 1.8점 (불안정)
신혼II: 78.9점  
다자녀: 75.2점
고령자: 83.1점
```

#### **v3.1 예상 점수**
```
청년: 85.0점
신혼I: 82.5점   ← 차이 7점 (안정)
신혼II: 75.5점  ← 차이 7점
다자녀: 72.0점  ← 차이 3.5점
고령자: 88.5점  ← 차이 3.5점

최소 차이: 3.5점 ✅
최대 차이: 16.5점 ✅
평균 차이: 8.2점 ✅ (목표: 12-25점 일부 달성)
```

---

## 🧪 **테스트 전략**

### **1. 단위 테스트 (30개)**
- ✅ 가중치 업데이트 검증 (5개)
- ✅ POI 거리 반영률 테스트 (10개)
- ✅ 타입별 점수 차이 검증 (10개)
- ✅ LH 2025 기준 준수 검증 (5개)

### **2. 통합 테스트 (50개 실제 주소)**
```python
TEST_ADDRESSES = [
    # 서울 (20개)
    "서울 강남구 역삼동",
    "서울 송파구 잠실동",
    # ... (생략)
    
    # 경기 (15개)
    "경기 성남시 분당구",
    # ... (생략)
    
    # 기타 (15개)
    "대전 유성구",
    # ... (생략)
]
```

**통과 기준**: >= 45/50 (90%)

### **3. 성능 테스트**
- 1000개 주소 처리 시간 < 10초
- 메모리 사용량 < 100MB

---

## 📦 **산출물**

### **수정 파일**
1. **app/services/type_demand_score_v3.py**
   - 크기: ~15KB → ~18KB (+3KB)
   - 주요 변경:
     - LH 2025 가중치 업데이트
     - POI 거리 기준 조정
     - 타입별 차별화 로직 강화

### **신규 파일**
1. **tests/test_type_demand_score_v3_1.py** (~20KB)
   - 80개 종합 테스트
   - 50개 실제 주소 테스트

2. **TASK5_TYPE_DEMAND_V3.1_COMPLETE.md** (~15KB)
   - 상세 구현 문서
   - Before/After 비교
   - 테스트 결과 분석

---

## 🎯 **완료 기준**

### **필수 조건 (Must Have)**
- [x] LH 2025 기준 100% 반영
- [ ] 다자녀 가중치 +3 적용
- [ ] 신혼I·II 점수 차이 5-8점
- [ ] 고령자 의료 가중치 45점
- [ ] POI 반영률 조정 (학교 +10%, 병원 +15%)
- [ ] 타입별 점수 차이 평균 12점 이상
- [ ] pytest 테스트 >= 90% 통과
- [ ] 커밋 및 PR 생성

### **선택 조건 (Nice to Have)**
- [ ] 50개 실제 주소 테스트
- [ ] 성능 최적화
- [ ] 문서화 완성도

---

## 🚀 **실행 계획**

### **Phase 1: 가중치 업데이트 (1시간)**
1. TYPE_WEIGHTS 수정
2. DISTANCE_STANDARDS 조정
3. 단위 테스트 작성 및 실행

### **Phase 2: 로직 개선 (1.5시간)**
1. _calculate_components 개선
2. _calculate_poi_bonuses 개선
3. 타입별 차별화 로직 추가

### **Phase 3: 테스트 및 검증 (1시간)**
1. 50개 실제 주소 테스트
2. 점수 차이 안정성 검증
3. 성능 테스트

### **Phase 4: 문서화 및 배포 (0.5시간)**
1. 완료 문서 작성
2. 커밋 및 PR 생성
3. 진행 상황 업데이트

---

**작성일**: 2024-12-01  
**상태**: ✅ READY TO START  
**예상 완료**: 3-4시간 내
