<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite API Keys ìë™ ì„¤ì •</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .title {
            font-size: 28px;
            font-weight: 700;
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .status {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 600;
            color: #333;
        }
        
        .status-value {
            font-size: 14px;
            color: #666;
        }
        
        .status-ok {
            color: #4CAF50;
            font-weight: 700;
        }
        
        .status-error {
            color: #f44336;
            font-weight: 700;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4CAF50;
        }
        
        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }
        
        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196F3;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ğŸ”‘</div>
        <h1 class="title">API Keys ìë™ ì„¤ì •</h1>
        <p class="subtitle">ì£¼ì†Œ ê²€ìƒ‰ì„ ìœ„í•œ API í‚¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤</p>
        
        <div class="status" id="status">
            <div class="status-item">
                <span class="status-label">Kakao API</span>
                <span class="status-value" id="kakao-status">í™•ì¸ ì¤‘...</span>
            </div>
            <div class="status-item">
                <span class="status-label">VWorld API</span>
                <span class="status-value" id="vworld-status">í™•ì¸ ì¤‘...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Data.go.kr API</span>
                <span class="status-value" id="datagokr-status">í™•ì¸ ì¤‘...</span>
            </div>
        </div>
        
        <button class="btn" id="setupBtn" onclick="setupApiKeys()">
            API Keys ì„¤ì •í•˜ê¸°
        </button>
        
        <button class="btn" id="testBtn" onclick="testAddressSearch()" style="display: none;">
            ì£¼ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        </button>
        
        <button class="btn" id="goBtn" onclick="goToMain()" style="display: none;">
            ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
        </button>
        
        <div id="message"></div>
    </div>
    
    <script>
        const API_KEYS = {
            kakao: '1b172a21a17b8b51dd47884b45228483',
            vworld: '781864DB-126D-3B14-A0EE-1FD1B1000534',
            dataGoKr: '702ee131547fa817de152355d87249805da836374a7ffefee1c511897353807d'
        };
        
        function checkApiKeys() {
            try {
                const keysJson = sessionStorage.getItem('m1_api_keys');
                if (keysJson) {
                    const keys = JSON.parse(keysJson);
                    document.getElementById('kakao-status').innerHTML = keys.kakao ? '<span class="status-ok">âœ“ ì„¤ì •ë¨</span>' : '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                    document.getElementById('vworld-status').innerHTML = keys.vworld ? '<span class="status-ok">âœ“ ì„¤ì •ë¨</span>' : '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                    document.getElementById('datagokr-status').innerHTML = keys.dataGoKr ? '<span class="status-ok">âœ“ ì„¤ì •ë¨</span>' : '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                    
                    if (keys.kakao && keys.vworld && keys.dataGoKr) {
                        return true;
                    }
                }
                
                document.getElementById('kakao-status').innerHTML = '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                document.getElementById('vworld-status').innerHTML = '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                document.getElementById('datagokr-status').innerHTML = '<span class="status-error">âœ— ë¯¸ì„¤ì •</span>';
                return false;
            } catch (e) {
                console.error('API Keys check failed:', e);
                return false;
            }
        }
        
        function setupApiKeys() {
            const btn = document.getElementById('setupBtn');
            const messageDiv = document.getElementById('message');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> ì„¤ì • ì¤‘...';
            
            try {
                sessionStorage.setItem('m1_api_keys', JSON.stringify(API_KEYS));
                
                setTimeout(() => {
                    if (checkApiKeys()) {
                        messageDiv.innerHTML = '<div class="message success">âœ… API Keysê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                        btn.style.display = 'none';
                        document.getElementById('testBtn').style.display = 'inline-block';
                        document.getElementById('goBtn').style.display = 'inline-block';
                    } else {
                        throw new Error('ì„¤ì • ê²€ì¦ ì‹¤íŒ¨');
                    }
                }, 500);
            } catch (e) {
                messageDiv.innerHTML = '<div class="message error">âŒ ì„¤ì • ì‹¤íŒ¨: ' + e.message + '</div>';
                btn.disabled = false;
                btn.innerHTML = 'API Keys ì„¤ì •í•˜ê¸°';
            }
        }
        
        async function testAddressSearch() {
            const btn = document.getElementById('testBtn');
            const messageDiv = document.getElementById('message');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                const keys = JSON.parse(sessionStorage.getItem('m1_api_keys'));
                
                // Use backend API URL directly
                const backendUrl = 'https://49999-ix27pwgxgiz4rqbhpf92x-a402f90a.sandbox.novita.ai';
                
                const response = await fetch(`${backendUrl}/api/m1/address/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Kakao-API-Key': keys.kakao,
                        'X-VWorld-API-Key': keys.vworld,
                        'X-DataGoKr-API-Key': keys.dataGoKr
                    },
                    body: JSON.stringify({ query: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬' })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                const result = text ? JSON.parse(text) : { error: 'Empty response' };
                
                if (result.success && !result.using_mock_data) {
                    messageDiv.innerHTML = '<div class="message success">âœ… ì£¼ì†Œ ê²€ìƒ‰ ì„±ê³µ! ' + (result.suggestions?.length || 0) + 'ê°œ ê²°ê³¼</div>';
                } else if (result.using_mock_data) {
                    messageDiv.innerHTML = '<div class="message error">âš ï¸ Mock ë°ì´í„° ë°˜í™˜ë¨. API í‚¤ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>';
                } else {
                    messageDiv.innerHTML = '<div class="message error">âŒ ê²€ìƒ‰ ì‹¤íŒ¨: ' + JSON.stringify(result.error || result) + '</div>';
                }
            } catch (e) {
                messageDiv.innerHTML = '<div class="message error">âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.message + '</div>';
            }
            
            btn.disabled = false;
            btn.innerHTML = 'ì£¼ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸';
        }
        
        function goToMain() {
            window.location.href = '/';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì²´í¬
        window.addEventListener('load', () => {
            if (checkApiKeys()) {
                document.getElementById('message').innerHTML = '<div class="message info">â„¹ï¸ API Keysê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜ ë©”ì¸ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.</div>';
                document.getElementById('setupBtn').style.display = 'none';
                document.getElementById('testBtn').style.display = 'inline-block';
                document.getElementById('goBtn').style.display = 'inline-block';
            }
        });
    </script>
</body>
</html>
