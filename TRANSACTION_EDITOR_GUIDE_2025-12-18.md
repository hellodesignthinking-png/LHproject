# 💰 거래사례 직접 입력 기능 가이드
**Date:** 2025-12-18  
**Feature:** Transaction Editor  
**Status:** ✅ IMPLEMENTED

---

## 🎯 기능 개요

**거래사례(Transaction)를 직접 입력/수정할 수 있는 UI 컴포넌트**

### 위치:
```
M1 ReviewScreen → 시장 정보 섹션 → 거래사례
```

### 주요 기능:
- ✅ 거래사례 추가/삭제
- ✅ 각 필드 수정 (날짜, 면적, 금액, 거리, 주소)
- ✅ 단가 자동 계산
- ✅ 통계 요약 표시
- ✅ 실시간 유효성 검증

---

## 📝 거래사례 입력 항목

### 필수 입력 필드:

| 필드 | 타입 | 단위 | 설명 | 예시 |
|------|------|------|------|------|
| **거래일자** | Date | - | 실제 거래가 이루어진 날짜 | 2024-06-15 |
| **토지면적** | Number | ㎡ | 거래된 토지의 면적 | 500.00 |
| **거래금액** | Number | 원 | 총 거래 금액 | 500,000,000 |
| **거리** | Number | m | 대상 토지와의 거리 | 150 |
| **주소** | String | - | 거래 토지의 주소 | 서울특별시 강남구 역삼동 123-45 |

### 자동 계산 필드:

| 필드 | 계산식 | 단위 |
|------|--------|------|
| **단가** | 거래금액 ÷ 토지면적 | 원/㎡ |

---

## 🖥 사용 방법

### Step 1: ReviewScreen 진입
```
주소 입력 → 위치 확인 → 다음 → ReviewScreen
```

### Step 2: 시장 정보 섹션 찾기
```
📄 지적 정보
⚖️  법적 정보
🛣  도로 정보
💰 시장 정보 ← 여기!
```

### Step 3: 거래사례 추가
```
[+ 거래사례 추가] 버튼 클릭
```

### Step 4: 정보 입력
```
거래일자: 2024-06-15
토지면적: 500 ㎡
거래금액: 500,000,000 원
거리: 150 m
주소: 서울특별시 강남구 역삼동 123-45

→ 단가가 자동 계산됨: 1,000,000 원/㎡
```

### Step 5: 추가 거래사례 입력
```
최소 3건 이상 입력 권장
[+ 거래사례 추가] 버튼으로 계속 추가
```

### Step 6: 저장
```
모든 필드 입력 완료 후
[🔒 토지 사실 확정 (M1 Lock)] 버튼 클릭
```

---

## 📸 UI 구성

### 거래사례 리스트:
```
┌─────────────────────────────────────────┐
│ 💰 거래사례 (3건)  [+ 거래사례 추가]    │
├─────────────────────────────────────────┤
│ #1                            [🗑️ 삭제]  │
│ ┌─────────────────────────────────────┐ │
│ │ 거래일자: [2024-06-15           ]  │ │
│ │ 토지면적: [500.00        ] ㎡    │ │
│ │ 거래금액: [500000000     ] 원    │ │
│ │ 단가:     1,000,000 원/㎡  (계산) │ │
│ │ 거리:     [150           ] m     │ │
│ │ 주소:     [서울 강남구...     ]  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ #2                            [🗑️ 삭제]  │
│ ...                                      │
├─────────────────────────────────────────┤
│ #3                            [🗑️ 삭제]  │
│ ...                                      │
└─────────────────────────────────────────┘
```

### 통계 요약:
```
┌─────────────────────────────────────────┐
│ 📊 통계 요약                             │
├─────────────┬─────────────┬─────────────┤
│ 총 거래건수  │ 평균 단가    │ 최고가      │
│    3건      │ 1,000,000원 │ 1,200,000원 │
├─────────────┴─────────────┴─────────────┤
│ 최저가: 800,000 원/㎡                   │
└─────────────────────────────────────────┘
```

---

## 💡 입력 가이드

### ✅ 좋은 거래사례 선정 기준:

#### 1. **거리 (Distance)**
```
최우선: 500m 이내
권장:   1km 이내
최대:   2km 이내
```

#### 2. **시기 (Date)**
```
최우선: 최근 6개월 이내
권장:   최근 1년 이내
최대:   최근 2년 이내
```

#### 3. **면적 (Area)**
```
대상 토지 면적의 50% ~ 200% 범위
예: 대상이 500㎡면
    250㎡ ~ 1000㎡ 사이의 거래사례
```

#### 4. **용도 (Land Use)**
```
동일 용도지역 우선
예: 제2종일반주거지역 → 제2종일반주거지역
```

---

### 📋 입력 예시

#### 예시 1: 강남구 역삼동 500㎡ 대지
```
거래사례 #1:
- 거래일자: 2024-06-15
- 토지면적: 480 ㎡
- 거래금액: 384,000,000 원
- 단가: 800,000 원/㎡
- 거리: 150 m
- 주소: 서울특별시 강남구 역삼동 123-45

거래사례 #2:
- 거래일자: 2024-05-20
- 토지면적: 520 ㎡
- 거래금액: 468,000,000 원
- 단가: 900,000 원/㎡
- 거리: 200 m
- 주소: 서울특별시 강남구 역삼동 234-56

거래사례 #3:
- 거래일자: 2024-04-10
- 토지면적: 500 ㎡
- 거래금액: 550,000,000 원
- 단가: 1,100,000 원/㎡
- 거리: 180 m
- 주소: 서울특별시 강남구 역삼동 345-67

→ 평균 단가: 933,333 원/㎡
→ 대상 토지 추정가: 500㎡ × 933,333원 = 466,666,500원
```

---

## 🔍 감정평가에 미치는 영향

### M2 감정평가 시 거래사례 활용:

#### 1. **거래사례비교법 적용**
```python
# M2 Appraisal Engine
land_value = calculate_comparative_approach(
    transactions=market_data.transactions,  # 입력한 거래사례
    target_area=land_data.area,
    target_location=land_data.coordinates
)
```

#### 2. **가중평균 계산**
```
각 거래사례의 가중치:
- 거리: 가까울수록 높음 (1/distance)
- 시기: 최근일수록 높음 (recency_factor)
- 면적: 유사할수록 높음 (similarity_factor)

최종 단가 = Σ(거래단가 × 가중치) / Σ(가중치)
```

#### 3. **신뢰도 점수**
```
신뢰도 점수 = f(거래건수, 거리, 시기, 분산)

거래건수 많을수록: ↑
거리 가까울수록: ↑
시기 최근일수록: ↑
단가 분산 작을수록: ↑
```

---

## ⚠️ 주의사항

### ❌ 피해야 할 것:

#### 1. **너무 적은 거래사례**
```
❌ 1건: 신뢰도 낮음 (20%)
⚠️  2건: 신뢰도 보통 (50%)
✅ 3건: 신뢰도 양호 (70%)
✅ 5건 이상: 신뢰도 높음 (90%)
```

#### 2. **너무 먼 거래사례**
```
❌ 5km 이상: 지역 특성 다름
⚠️  2km 이상: 참고용
✅ 1km 이내: 신뢰 가능
✅ 500m 이내: 최적
```

#### 3. **너무 오래된 거래**
```
❌ 3년 이상: 시장 변화 반영 안 됨
⚠️  2년 이상: 조정 필요
✅ 1년 이내: 신뢰 가능
✅ 6개월 이내: 최적
```

#### 4. **면적 차이 과다**
```
❌ 10배 이상 차이: 단가 왜곡
⚠️  5배 이상 차이: 조정 필요
✅ 2배 이내 차이: 신뢰 가능
✅ 50% 이내 차이: 최적
```

---

## 🛠 기술 구현

### Component Structure:
```typescript
<TransactionEditor
  transactions={editedData.market.transactions || []}
  onChange={(transactions) => {
    setEditedData(prev => ({
      ...prev!,
      market: {
        ...prev!.market,
        transactions: transactions
      }
    }));
  }}
  readonly={false}  // 수정 가능
/>
```

### Data Type:
```typescript
interface Transaction {
  date: string;        // "YYYY-MM-DD"
  area: number;        // ㎡
  amount: number;      // 원
  distance: number;    // m
  address: string;     // 주소
}
```

### Features:
- ✅ Add transaction
- ✅ Edit transaction
- ✅ Delete transaction
- ✅ Auto-calculate price per sqm
- ✅ Display statistics
- ✅ Validation
- ✅ Responsive design

---

## 📊 데이터 검증

### 자동 검증 항목:

1. **필수 필드 검증**
   ```
   ❌ 거래일자 누락: "거래일자를 입력하세요"
   ❌ 면적 0: "면적을 입력하세요"
   ❌ 금액 0: "거래금액을 입력하세요"
   ```

2. **범위 검증**
   ```
   ❌ 거래일자 미래: "미래 날짜는 입력할 수 없습니다"
   ❌ 면적 음수: "면적은 0보다 커야 합니다"
   ❌ 금액 음수: "금액은 0보다 커야 합니다"
   ```

3. **논리 검증**
   ```
   ⚠️  단가 너무 높음: "단가가 비정상적으로 높습니다 (10,000,000원/㎡ 이상)"
   ⚠️  단가 너무 낮음: "단가가 비정상적으로 낮습니다 (100,000원/㎡ 이하)"
   ```

---

## 🎯 Best Practice

### 권장 입력 프로세스:

#### Step 1: 거래사례 조사
```
1. 부동산 거래 사이트 (국토교통부 실거래가)
2. 공인중개사 문의
3. 지역 부동산 시장 조사
```

#### Step 2: 유사 거래사례 선별
```
조건:
- 대상 토지 1km 이내
- 최근 1년 이내
- 면적 50~200% 범위
- 동일 용도지역
```

#### Step 3: 데이터 입력
```
최소 3건, 권장 5건 이상 입력
```

#### Step 4: 검증
```
통계 요약 확인:
- 평균 단가가 합리적인지
- 최고가/최저가 편차가 크지 않은지
- 이상값(outlier) 있는지
```

#### Step 5: M1 Lock
```
모든 필드 입력 완료 후
토지 사실 확정
```

---

## 📄 생성된 파일

1. **`TransactionEditor.tsx`**
   - 거래사례 편집 컴포넌트
   - 추가/수정/삭제 기능
   - 통계 계산 및 표시

2. **`TransactionEditor.css`**
   - 스타일링
   - 반응형 디자인
   - 인터랙션 효과

3. **`ReviewScreen.tsx` (수정)**
   - TransactionEditor 통합
   - 시장 정보 섹션 확장

---

## ✅ 체크리스트

### 거래사례 입력 완료 확인:

- [ ] 최소 3건 이상 입력
- [ ] 모든 필수 필드 입력 (날짜, 면적, 금액, 거리, 주소)
- [ ] 대상 토지와 1km 이내
- [ ] 최근 1년 이내 거래
- [ ] 단가가 합리적인 범위
- [ ] 통계 요약 확인
- [ ] 이상값 제거

---

## 🎊 완료!

**거래사례 직접 입력 기능이 완벽하게 구현되었습니다!**

- ✅ UI 컴포넌트 완성
- ✅ 자동 계산 기능
- ✅ 통계 요약
- ✅ 검증 로직
- ✅ 사용 가이드 완비

**이제 사용자가 거래사례를 직접 입력하여 정확한 감정평가를 받을 수 있습니다!**
