# Alertmanager Configuration
# ì•Œë¦¼ ë¼ìš°íŒ… ë° ë°œì†¡ ì„¤ì •

global:
  # SMTP ì„¤ì • (ì´ë©”ì¼ ì•Œë¦¼)
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'zerosite-alerts@example.com'
  smtp_auth_username: 'your-email@gmail.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true

# ì•Œë¦¼ ë¼ìš°íŒ…
route:
  # ê¸°ë³¸ ìˆ˜ì‹ ì
  receiver: 'default'
  
  # ê·¸ë£¹í™” ì„¤ì •
  group_by: ['alertname', 'severity', 'component']
  group_wait: 10s        # ì²« ì•Œë¦¼ ëŒ€ê¸° ì‹œê°„
  group_interval: 10s    # ê·¸ë£¹ ë‚´ ì¶”ê°€ ì•Œë¦¼ ê°„ê²©
  repeat_interval: 12h   # ì•Œë¦¼ ë°˜ë³µ ê°„ê²©
  
  # í•˜ìœ„ ë¼ìš°íŠ¸
  routes:
    # Critical ì•Œë¦¼ - ì¦‰ì‹œ ë°œì†¡
    - match:
        severity: critical
      receiver: 'critical-team'
      group_wait: 0s
      repeat_interval: 5m
    
    # Warning ì•Œë¦¼ - 5ë¶„ ëŒ€ê¸°
    - match:
        severity: warning
      receiver: 'warning-team'
      group_wait: 5m
      repeat_interval: 1h
    
    # ë³´ì•ˆ ê´€ë ¨ ì•Œë¦¼
    - match:
        component: security
      receiver: 'security-team'
      group_wait: 0s
      repeat_interval: 15m
    
    # ë°ì´í„°ë² ì´ìŠ¤ ì•Œë¦¼
    - match:
        component: database
      receiver: 'database-team'
      group_wait: 2m
      repeat_interval: 30m

# ì•Œë¦¼ ìˆ˜ì‹ ì ì„¤ì •
receivers:
  # ê¸°ë³¸ ìˆ˜ì‹ ì
  - name: 'default'
    email_configs:
      - to: 'team@example.com'
        headers:
          Subject: '[ZeroSite] Alert: {{ .GroupLabels.alertname }}'
        html: |
          <h2>ZeroSite v4.0 Alert</h2>
          <p><strong>Alert:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>Severity:</strong> {{ .GroupLabels.severity }}</p>
          <p><strong>Component:</strong> {{ .GroupLabels.component }}</p>
          <hr>
          {{ range .Alerts }}
          <p>{{ .Annotations.summary }}</p>
          <p>{{ .Annotations.description }}</p>
          {{ end }}
  
  # Critical íŒ€
  - name: 'critical-team'
    email_configs:
      - to: 'critical-team@example.com'
        send_resolved: true
    # Slack ì•Œë¦¼ (ì„ íƒì‚¬í•­)
    # slack_configs:
    #   - api_url: 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
    #     channel: '#critical-alerts'
    #     title: 'ğŸš¨ Critical Alert'
    #     text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
  
  # Warning íŒ€
  - name: 'warning-team'
    email_configs:
      - to: 'warning-team@example.com'
  
  # ë³´ì•ˆ íŒ€
  - name: 'security-team'
    email_configs:
      - to: 'security-team@example.com'
        send_resolved: true
  
  # ë°ì´í„°ë² ì´ìŠ¤ íŒ€
  - name: 'database-team'
    email_configs:
      - to: 'database-team@example.com'

# ì•Œë¦¼ ì–µì œ ê·œì¹™
inhibit_rules:
  # Criticalì´ ë°œìƒí•˜ë©´ Warning ì–µì œ
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'component']
  
  # ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œ ë‹¤ë¥¸ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*'
    equal: ['instance']
