# 거래사례 직접입력 방법 - 최종 답변 📋

## 질문
> **거래사례는 직접입력으로 어떤식으로 해야하는지 알려줘.**

---

## ✅ 답변 요약

**거래사례는 M1 Review Screen의 "💰 시장 정보" 섹션에서 직접 입력할 수 있습니다.**

### 🚀 3단계 간단 요약

```
1️⃣  Review Screen 진입
    M1 Landing Page → Step 3.5 → 💰 시장 정보

2️⃣  거래사례 추가 버튼 클릭
    [+ 거래사례 추가] → 6개 필드 입력

3️⃣  M1 Lock 실행
    [토지 사실 확정] → M2 감정평가 자동 실행
```

---

## 📝 상세 입력 방법

### Step 1: Review Screen 진입

#### 경로
```
프론트엔드 접속
   ↓
Step 1: 주소 검색 (예: 서울특별시 강남구 테헤란로 521)
   ↓
Step 2: 좌표 확인
   ↓
Step 3: 데이터 수집 (API/PDF/Manual)
   ↓
Step 3.5: Review Screen 🎯
   ↓
스크롤 다운 → "💰 시장 정보" 섹션
```

### Step 2: 거래사례 입력

#### 화면 위치
```
┌────────────────────────────────────────────────┐
│ 💰 시장 정보                                    │
│ ────────────────────────────────────────────── │
│ 공시지가:        10,000,000 원/㎡              │
│ 공시지가 기준일: 2025-01-01                    │
│                                                 │
│ ┌──────────────────────────────────────────┐  │
│ │ 💰 거래사례 (0건) [+ 거래사례 추가] ← 클릭│  │
│ └──────────────────────────────────────────┘  │
└────────────────────────────────────────────────┘
```

#### 입력 필드
```
┌────────────────────────────────────────────────┐
│ #1                              [🗑️ 삭제]      │
│ ────────────────────────────────────────────── │
│                                                 │
│ 거래일자:       [2025-11-20]    📅 날짜 선택   │
│ 토지면적 (㎡):  [450.00]        🏞️ 숫자 입력   │
│ 거래금액 (원):  [540000000]     💵 숫자 입력   │
│ 단가 (원/㎡):   1,200,000       ✨ 자동 계산   │
│ 거리 (m):       [120]           📍 숫자 입력   │
│ 주소:           [서울특별시 강남구 역삼동 736-3]│
│                                                 │
└────────────────────────────────────────────────┘
```

### Step 3: 통계 확인 및 M1 Lock

#### 통계 자동 표시
```
┌────────────────────────────────────────────────┐
│ 📊 통계 요약                                    │
│ ────────────────────────────────────────────── │
│ 총 거래건수:    3건                             │
│ 평균 단가:      1,200,351 원/㎡                 │
│ 최고가:         1,250,000 원/㎡                 │
│ 최저가:         1,151,053 원/㎡                 │
└────────────────────────────────────────────────┘
```

#### M1 Lock 실행
```
┌────────────────────────────────────────────────┐
│ [뒤로 가기]    [토지 사실 확정 (M1 Lock)]      │
│                         ↑                       │
│                      클릭 후                    │
│                         ↓                       │
│                  M2 감정평가 자동 실행          │
└────────────────────────────────────────────────┘
```

---

## 📊 입력 필드 상세

| 필드명 | 입력 형식 | 예시 | 설명 |
|--------|-----------|------|------|
| **거래일자** | YYYY-MM-DD | 2025-11-20 | 날짜 선택기 (오늘 이전만 가능) |
| **토지면적** | 숫자 (㎡) | 450.00 | 소수점 2자리까지 가능 |
| **거래금액** | 숫자 (원) | 540,000,000 | 정수 입력 |
| **단가** | 자동 계산 | 1,200,000 | 거래금액 ÷ 면적 (입력 불가) |
| **거리** | 숫자 (m) | 120 | 대상 토지와의 직선 거리 |
| **주소** | 텍스트 | 서울특별시 강남구 역삼동 736-3 | 도로명 또는 지번 주소 |

---

## 💡 입력 팁

### ✅ 권장 사항

```
✔️ 최소 3건 이상 입력
   → M2 감정평가 정확도 향상

✔️ 대상 토지 기준 500m 이내
   → 인근 거래사례 우선

✔️ 최근 1년 이내 거래
   → 유효성 최대

✔️ 유사한 면적 (±30% 이내)
   → 비교 가능성 향상

✔️ 동일한 용도지역/지목
   → 평가 신뢰도 향상
```

### ⚠️ 주의사항

```
❌ 거래일자: 오늘 이후 날짜 입력 불가
❌ 토지면적: 0 이하 값 입력 불가
❌ 거래금액: 음수 값 입력 불가
❌ 거리: 음수 값 입력 불가
✅ 단가: 자동 계산 (직접 입력 불가)
```

---

## 🎯 실전 예시

### 강남구 테헤란로 521 인근 거래사례

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래사례 #1
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래일자:      2025-11-20
토지면적:      450.00 ㎡
거래금액:      540,000,000 원
단가:          1,200,000 원/㎡  (자동 계산)
거리:          120 m
주소:          서울특별시 강남구 역삼동 736-3
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래사례 #2
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래일자:      2025-10-15
토지면적:      520.50 ㎡
거래금액:      650,625,000 원
단가:          1,250,000 원/㎡  (자동 계산)
거리:          250 m
주소:          서울특별시 강남구 역삼동 819-10
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래사례 #3
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
거래일자:      2025-09-10
토지면적:      380.00 ㎡
거래금액:      437,400,000 원
단가:          1,151,053 원/㎡  (자동 계산)
거리:          450 m
주소:          서울특별시 강남구 역삼동 647-22
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 통계 결과
```
총 거래건수:    3건
평균 단가:      1,200,351 원/㎡
최고가:         1,250,000 원/㎡
최저가:         1,151,053 원/㎡
```

---

## 🔒 Mock 데이터 경고

### ⚠️ Mock 데이터 사용 시 M1 Lock 불가

API 데이터 수집 실패로 Mock 데이터 사용 중인 경우:

```
┌────────────────────────────────────────────────┐
│ ⚠️ Mock 데이터 사용 중                          │
│                                                 │
│ M1 Lock은 실제 API 데이터 또는 수동 입력된     │
│ 데이터만 허용합니다.                            │
│                                                 │
│ 해결 방법:                                      │
│ • 📄 PDF 업로드 (토지대장, 토지이용계획확인서) │
│ • ✏️ 모든 필드 수동 입력 (거래사례 포함)       │
│ • 🔑 API 키 설정 (Step 0)                      │
└────────────────────────────────────────────────┘
```

**🔴 중요**: Mock 데이터 상태에서는 거래사례를 입력해도 M1 Lock이 차단됩니다!

---

## 🚀 M2 감정평가 연계

### M1 Lock 후 자동 실행

```
1. [토지 사실 확정 (M1 Lock)] 클릭
   ↓
2. Context Freeze (Step 8)
   ↓
3. Parcel ID 생성 (예: test123)
   ↓
4. M2-M6 Pipeline 자동 실행
   ↓
5. M2 감정평가 결과 표시
```

### M2 결과 예시

```
┌────────────────────────────────────────────────┐
│ 📊 M2: 토지 감정평가 결과                       │
│ ────────────────────────────────────────────── │
│                                                 │
│ 감정평가액:   6,081,933,538 원                 │
│ 단위가격:     12,163,867 원/㎡                  │
│ 평가방법:     거래사례비교법 (4-Factor Enhanced)│
│ 신뢰도:       0.78 (HIGH) ⭐⭐⭐                │
│                                                 │
│ 💰 사용된 거래사례:                             │
│   #1: 서울특별시 강남구 역삼동 736-3 (120m)    │
│   #2: 서울특별시 강남구 역삼동 819-10 (250m)   │
│   #3: 서울특별시 강남구 역삼동 647-22 (450m)   │
│                                                 │
└────────────────────────────────────────────────┘
```

---

## 📚 기술 구현 세부사항

### React Component

**TransactionEditor Component**
- 파일: `frontend/src/components/m1/TransactionEditor.tsx`
- 기능: 거래사례 추가/수정/삭제, 통계 자동 계산
- 상태 관리: React `useState`, `onChange` callback

### Data Type

```typescript
interface Transaction {
  date: string;          // YYYY-MM-DD
  area: number;          // 토지면적 (㎡)
  amount: number;        // 거래금액 (원)
  distance: number;      // 거리 (m)
  address: string;       // 주소
}
```

### 저장 위치

```typescript
LandDataBundle {
  market: {
    official_land_price: number;
    official_land_price_date: string;
    transactions: Transaction[];  // ← 여기에 저장
    api_result: { ... }
  }
}
```

---

## 🔗 관련 문서

1. **Quick Start Guide** (3단계 빠른 시작)
   - `/docs/QUICK_START_TRANSACTION_INPUT.md`
   - ASCII 다이어그램 포함 시각적 가이드

2. **Comprehensive Guide** (완전 상세 가이드)
   - `/docs/TRANSACTION_MANUAL_INPUT_GUIDE_2025-12-18.md`
   - 10개 섹션, 474줄, 18KB
   - FAQ, 기술 구현, 사용 시나리오 포함

3. **Critical Fix Documentation**
   - `/docs/CRITICAL_ROOT_CAUSE_FIX_2025-12-18.md`
   - Mock 데이터 검증 로직 상세 설명

4. **API Failure Analysis**
   - `/docs/API_FAILURE_ROOT_CAUSE_ANALYSIS_2025-12-18.md`
   - API 실패 시 대안 (PDF/수동입력) 가이드

---

## 📞 접속 정보

### Frontend
```
URL: https://3001-iytptjlm3wjktifqay52f-2b54fc91.sandbox.novita.ai
```

### Backend Health Check
```
URL: https://8005-iytptjlm3wjktifqay52f-2b54fc91.sandbox.novita.ai/api/m1/health
```

---

## 📋 Quick Reference Card

### 체크리스트

```
☐ Step 1: Review Screen 진입
☐ Step 2: [+ 거래사례 추가] 클릭
☐ Step 3: 거래일자 입력 (YYYY-MM-DD)
☐ Step 4: 토지면적 입력 (㎡)
☐ Step 5: 거래금액 입력 (원)
☐ Step 6: 거리 입력 (m)
☐ Step 7: 주소 입력
☐ Step 8: 단가 자동 계산 확인
☐ Step 9: 최소 3건 입력 (권장)
☐ Step 10: [토지 사실 확정] 클릭
☐ Step 11: M2 감정평가 결과 확인
```

### 권장 사항

```
✅ 최소 3건 이상
✅ 500m 이내
✅ 1년 이내
✅ 유사 면적
✅ 동일 용도지역
```

---

## ✅ 최종 답변

**거래사례는 M1 Review Screen의 "💰 시장 정보" 섹션에서 [+ 거래사례 추가] 버튼을 클릭하여 직접 입력할 수 있습니다.**

**입력 필드:**
1. 거래일자 (날짜 선택기)
2. 토지면적 (숫자 입력, ㎡)
3. 거래금액 (숫자 입력, 원)
4. 단가 (자동 계산, 입력 불가)
5. 거리 (숫자 입력, m)
6. 주소 (텍스트 입력)

**권장:** 최소 3건 이상 입력하면 M2 감정평가 정확도가 크게 향상됩니다.

**주의:** Mock 데이터 사용 시 M1 Lock이 차단되므로 PDF 업로드 또는 전체 수동 입력이 필요합니다.

---

**작성일**: 2025-12-18  
**작성자**: ZeroSite Development Team  
**문서 버전**: v1.0  
**커밋**: `521c965`, `c42c900`  

**관련 파일:**
- `frontend/src/components/m1/TransactionEditor.tsx` (252 lines)
- `frontend/src/components/m1/TransactionEditor.css` (262 lines)
- `frontend/src/components/m1/ReviewScreen.tsx` (lines 652-666)
- `frontend/src/types/m1.types.ts` (Transaction interface)
