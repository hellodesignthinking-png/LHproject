# 거래사례 직접입력 가이드 📝

## 📋 목차
1. [거래사례 입력 화면 접근 방법](#1-거래사례-입력-화면-접근-방법)
2. [거래사례 입력 방법](#2-거래사례-입력-방법)
3. [입력 필드 상세 설명](#3-입력-필드-상세-설명)
4. [사용 예시 (실제 데이터)](#4-사용-예시-실제-데이터)
5. [주의사항 및 팁](#5-주의사항-및-팁)
6. [M1 Lock 및 M2 감정평가로 진행](#6-m1-lock-및-m2-감정평가로-진행)

---

## 1. 거래사례 입력 화면 접근 방법

### 1.1 M1 Landing Page → Review Screen 진입
```
Step 0: API 키 설정 (선택)
   ↓
Step 1: 주소 검색 (서울특별시 강남구 테헤란로 521)
   ↓
Step 2: 좌표 확인
   ↓
Step 3: 데이터 수집 (API 또는 PDF 업로드 또는 Manual)
   ↓
Step 3.5: Review Screen 🎯 ← 여기서 거래사례 입력!
```

### 1.2 Review Screen 내 위치
Review Screen 스크롤 다운 → **💰 시장 정보** 섹션 → **💰 거래사례** 영역

---

## 2. 거래사례 입력 방법

### 2.1 거래사례 추가 버튼 클릭

#### 📭 거래사례가 없는 경우:
```
┌─────────────────────────────────────┐
│ 💰 거래사례 (0건)                    │
│ ─────────────────────────────────  │
│                                     │
│  📭 등록된 거래사례가 없습니다.      │
│                                     │
│  [+ 첫 거래사례 추가하기]  ← 클릭   │
│                                     │
└─────────────────────────────────────┘
```

#### ✅ 거래사례가 있는 경우:
```
┌─────────────────────────────────────┐
│ 💰 거래사례 (3건)     [+ 거래사례 추가] ← 클릭
└─────────────────────────────────────┘
```

### 2.2 거래사례 입력 폼 작성

버튼을 클릭하면 다음과 같은 입력 폼이 나타납니다:

```
┌─────────────────────────────────────────────────────┐
│ #1                                  [🗑️ 삭제]        │
│ ─────────────────────────────────────────────────   │
│                                                      │
│ 거래일자:        [2025-12-15]  (날짜 선택기)         │
│ 토지면적 (㎡):   [500.00]      (숫자 입력)           │
│ 거래금액 (원):   [600000000]   (숫자 입력)           │
│ 단가 (원/㎡):    1,200,000 원/㎡ (자동 계산 ✨)      │
│ 거리 (m):        [150]          (숫자 입력)          │
│ 주소:            [서울특별시 강남구 역삼동 123-45]  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 3. 입력 필드 상세 설명

### 3.1 필드별 입력 가이드

| 필드명 | 설명 | 입력 형식 | 예시 | 필수 여부 |
|--------|------|-----------|------|-----------|
| **거래일자** | 해당 토지 거래가 발생한 날짜 | YYYY-MM-DD | 2025-12-15 | ✅ 필수 |
| **토지면적 (㎡)** | 거래된 토지의 면적 | 숫자 (소수점 2자리) | 500.00 | ✅ 필수 |
| **거래금액 (원)** | 해당 토지의 거래 총액 | 숫자 (정수) | 600,000,000 | ✅ 필수 |
| **단가 (원/㎡)** | 자동 계산 (거래금액 ÷ 면적) | 자동 계산 | 1,200,000 | 🔒 자동 |
| **거리 (m)** | 대상 토지와의 직선 거리 | 숫자 (정수) | 150 | ✅ 필수 |
| **주소** | 거래 토지의 도로명 또는 지번 주소 | 텍스트 | 서울특별시 강남구 역삼동 123-45 | ✅ 필수 |

### 3.2 필드별 제약사항

```typescript
{
  date: {
    type: 'date',
    max: new Date(), // 오늘 이후 날짜 입력 불가
    format: 'YYYY-MM-DD'
  },
  area: {
    type: 'number',
    min: 0,
    step: 0.01,
    unit: '㎡'
  },
  amount: {
    type: 'number',
    min: 0,
    step: 1000000, // 100만원 단위 추천
    unit: '원'
  },
  distance: {
    type: 'number',
    min: 0,
    step: 10, // 10m 단위 추천
    unit: 'm'
  },
  address: {
    type: 'string',
    placeholder: '서울특별시 강남구 역삼동 123-45'
  }
}
```

---

## 4. 사용 예시 (실제 데이터)

### 4.1 예시 1: 강남구 테헤란로 인근 거래사례

#### 거래사례 #1
```
거래일자:      2025-11-20
토지면적:      450.00 ㎡
거래금액:      540,000,000 원
단가:          1,200,000 원/㎡  (자동 계산)
거리:          120 m
주소:          서울특별시 강남구 역삼동 736-3
```

#### 거래사례 #2
```
거래일자:      2025-10-15
토지면적:      520.50 ㎡
거래금액:      650,625,000 원
단가:          1,250,000 원/㎡  (자동 계산)
거리:          250 m
주소:          서울특별시 강남구 역삼동 819-10
```

#### 거래사례 #3
```
거래일자:      2025-09-10
토지면적:      380.00 ㎡
거래금액:      437,400,000 원
단가:          1,151,053 원/㎡  (자동 계산)
거리:          450 m
주소:          서울특별시 강남구 역삼동 647-22
```

### 4.2 입력 후 통계 자동 계산

입력이 완료되면 하단에 **📊 통계 요약**이 자동 표시됩니다:

```
┌──────────────────────────────────────────────────┐
│ 📊 통계 요약                                      │
│ ──────────────────────────────────────────────   │
│                                                   │
│  총 거래건수:  3건                                │
│  평균 단가:    1,200,351 원/㎡                    │
│  최고가:       1,250,000 원/㎡                    │
│  최저가:       1,151,053 원/㎡                    │
│                                                   │
└──────────────────────────────────────────────────┘
```

---

## 5. 주의사항 및 팁

### 5.1 ⚠️ 주의사항

1. **거래일자**: 오늘 날짜보다 미래의 거래일자는 입력할 수 없습니다
2. **토지면적**: 0 이하 값은 입력할 수 없습니다 (최소 0.01 ㎡)
3. **거래금액**: 음수 값은 입력할 수 없습니다
4. **거리**: 음수 값은 입력할 수 없습니다
5. **단가**: 자동 계산되므로 직접 입력할 수 없습니다

### 5.2 💡 입력 팁

#### Tip 1: 최소 거래사례 개수
```
✅ 권장: 최소 3건 이상의 거래사례 입력
   → M2 감정평가 정확도가 크게 향상됩니다
```

#### Tip 2: 거래사례 선정 기준
```
✅ 우선순위:
   1. 대상 토지와 가까운 거래사례 (거리 500m 이내)
   2. 최근 1년 이내의 거래 (유효성 최대)
   3. 유사한 토지 면적 (대상 토지 면적 ±30% 이내)
   4. 동일한 용도지역/지목
```

#### Tip 3: 단가 자동 계산 활용
```
거래금액과 면적만 정확히 입력하면
→ 단가(원/㎡)는 자동으로 계산되어 표시됩니다
→ 소수점 이하는 자동으로 반올림됩니다
```

#### Tip 4: 여러 건 일괄 입력
```
1. [+ 거래사례 추가] 버튼을 여러 번 클릭
2. 각 거래사례 폼에 데이터 입력
3. 모든 입력 후 한 번에 저장
```

### 5.3 🗑️ 거래사례 삭제

잘못 입력한 거래사례는 언제든지 삭제 가능합니다:

```
┌─────────────────────────────────────────────┐
│ #2                          [🗑️ 삭제] ← 클릭 │
│ ───────────────────────────────────────────  │
│ 거래일자: 2025-10-15                         │
│ ...                                          │
└─────────────────────────────────────────────┘
```

---

## 6. M1 Lock 및 M2 감정평가로 진행

### 6.1 거래사례 입력 후 데이터 검증

거래사례를 입력한 후, Review Screen 하단의 **필수 필드 체크**를 확인하세요:

```
┌───────────────────────────────────────────────────┐
│ ✅ 지적 정보 (2/2 필드 완료)                       │
│ ✅ 법적 정보 (3/3 필드 완료)                       │
│ ✅ 도로 정보 (2/2 필드 완료)                       │
│ ✅ 시장 정보 (1/1 필드 완료)                       │
│ ✅ 거래사례 (3건 입력됨) ✨ NEW                    │
│                                                    │
│ [뒤로 가기]       [토지 사실 확정 (M1 Lock)]      │
│                                                    │
└───────────────────────────────────────────────────┘
```

### 6.2 Mock 데이터 사용 시 경고 메시지

만약 API 데이터 수집이 실패하여 Mock 데이터를 사용 중이라면:

```
┌───────────────────────────────────────────────────┐
│ ⚠️ Mock 데이터 사용 중                             │
│ ──────────────────────────────────────────────    │
│ 현재 일부 데이터가 Mock 데이터입니다.              │
│ M1 Lock은 실제 API 데이터 또는 수동 입력된 데이터│
│ 만 허용합니다.                                     │
│                                                    │
│ 다음 중 하나를 선택하세요:                         │
│ • 📄 PDF 업로드: 지적도, 토지이용계획확인서 등을  │
│   업로드하여 자동 추출                             │
│ • ✏️ 수동 입력: 각 필드를 직접 수정하여 정확한    │
│   값 입력                                          │
│ • 🔑 API 키 설정: Step 0에서 Kakao, VWorld,       │
│   Data.go.kr API 키 입력                          │
└───────────────────────────────────────────────────┘
```

**🔴 중요: Mock 데이터 상태에서는 M1 Lock이 불가능합니다!**
- 모든 필드를 **수동으로 입력**하거나
- **PDF 업로드**를 통해 실제 데이터를 확보해야 합니다

### 6.3 M1 Lock 실행

모든 필드가 정상적으로 입력되고, Mock 데이터가 아닌 경우:

```
1. [토지 사실 확정 (M1 Lock)] 버튼 클릭
2. Context Freeze 실행 (Step 8)
3. Parcel ID 생성 (예: test123)
4. M2-M6 Pipeline 자동 실행
```

### 6.4 M2 감정평가 결과 확인

M1 Lock 이후 자동으로 M2 감정평가가 실행됩니다:

```
┌───────────────────────────────────────────────────┐
│ 📊 M2: 토지 감정평가 결과                          │
│ ──────────────────────────────────────────────    │
│                                                    │
│ • 감정평가액: 6,081,933,538 원                     │
│ • 단위가격: 12,163,867 원/㎡                       │
│ • 평가방법: 거래사례비교법 (4-Factor Enhanced)    │
│ • 신뢰도: 0.78 (HIGH)                              │
│                                                    │
│ 💰 사용된 거래사례:                                │
│   #1: 서울특별시 강남구 역삼동 736-3 (120m)       │
│   #2: 서울특별시 강남구 역삼동 819-10 (250m)      │
│   #3: 서울특별시 강남구 역삼동 647-22 (450m)      │
│                                                    │
└───────────────────────────────────────────────────┘
```

---

## 7. 실제 사용 시나리오

### 시나리오 1: 완전 수동 입력 (API 없이)

```
1. Step 1: 주소 검색 (Kakao API 사용 가능)
2. Step 2: 좌표 확인 (자동)
3. Step 3: [수동 입력 모드 선택]
4. Step 3.5: Review Screen 진입
   
   → 지적 정보 수동 입력
      - 면적: 500 ㎡
      - 지목: 대지
   
   → 법적 정보 수동 입력
      - 용도지역: 제2종일반주거지역
      - 용적률: 200%
      - 건폐율: 60%
   
   → 도로 정보 수동 입력
      - 도로접면: 남측
      - 도로폭: 8 m
   
   → 시장 정보 수동 입력
      - 공시지가: 10,000,000 원/㎡
      - 공시지가 기준일: 2025-01-01
      
      💰 거래사례 입력 (최소 3건):
         [+ 거래사례 추가] 클릭
         → 거래사례 #1, #2, #3 입력
   
5. [토지 사실 확정 (M1 Lock)] 클릭
6. M2-M6 Pipeline 자동 실행
```

### 시나리오 2: PDF 업로드 + 거래사례 보완

```
1. Step 1-2: 주소/좌표 확인
2. Step 3: [PDF 업로드] 선택
   - 토지대장.pdf 업로드
   - 토지이용계획확인서.pdf 업로드
   
3. Step 3.5: Review Screen 진입
   - 지적/법적/도로 정보 자동 추출 ✅
   - 시장 정보: 공시지가 자동 추출 ✅
   
   💰 거래사례만 수동 입력 필요:
      → [+ 거래사례 추가] 클릭
      → 거래사례 #1, #2, #3 입력
   
4. [토지 사실 확정 (M1 Lock)] 클릭
5. M2-M6 Pipeline 자동 실행
```

---

## 8. 기술 구현 세부사항

### 8.1 React Component 구조

```typescript
<TransactionEditor
  transactions={editedData.market.transactions || []}
  onChange={(transactions) => {
    setEditedData(prev => ({
      ...prev!,
      market: {
        ...prev!.market,
        transactions: transactions
      }
    }));
  }}
  readonly={false}
/>
```

### 8.2 Transaction Data Type

```typescript
interface Transaction {
  date: string;          // YYYY-MM-DD
  area: number;          // 토지면적 (㎡)
  amount: number;        // 거래금액 (원)
  distance: number;      // 거리 (m)
  address: string;       // 주소
}
```

### 8.3 데이터 저장 위치

```typescript
LandDataBundle {
  market: {
    official_land_price: number;
    official_land_price_date: string;
    transactions: Transaction[];  // ← 여기에 저장됨
    api_result: {
      success: boolean;
      api_name: string;
      ...
    }
  }
}
```

---

## 9. FAQ

### Q1: 거래사례를 몇 건 입력해야 하나요?
**A**: 최소 3건 이상 권장합니다. M2 감정평가의 정확도가 크게 향상됩니다.

### Q2: 거래사례 없이 M1 Lock이 가능한가요?
**A**: 네, 가능합니다. 하지만 M2 감정평가 시 공시지가만을 기준으로 평가되므로 정확도가 낮을 수 있습니다.

### Q3: 단가를 직접 입력할 수 있나요?
**A**: 아니요. 단가는 `거래금액 ÷ 면적`으로 자동 계산됩니다. 거래금액과 면적만 정확히 입력하세요.

### Q4: Mock 데이터 상태에서 거래사례만 입력하면 M1 Lock이 되나요?
**A**: 아니요. Mock 데이터가 하나라도 있으면 M1 Lock이 불가능합니다. 모든 필드를 수동 입력하거나 PDF 업로드로 실제 데이터를 확보해야 합니다.

### Q5: 입력한 거래사례를 나중에 수정할 수 있나요?
**A**: M1 Lock 이전까지는 자유롭게 수정/삭제 가능합니다. M1 Lock 이후에는 Immutable Context가 생성되어 수정할 수 없습니다.

---

## 10. 마무리

### ✅ 거래사례 직접입력 요약

1. **진입 경로**: M1 Landing Page → Step 3.5 Review Screen → 💰 시장 정보 섹션
2. **추가 방법**: `[+ 거래사례 추가]` 버튼 클릭
3. **입력 필드**: 거래일자, 토지면적, 거래금액, 거리, 주소 (단가는 자동 계산)
4. **권장 개수**: 최소 3건 이상
5. **통계 요약**: 총 거래건수, 평균 단가, 최고가, 최저가 자동 표시
6. **M2 연계**: M1 Lock 후 M2 감정평가에서 거래사례비교법 적용

### 🎯 핵심 포인트

```
📍 위치: Review Screen → 시장 정보 → 거래사례
✏️  입력: 날짜, 면적, 금액, 거리, 주소
🧮 계산: 단가 = 금액 ÷ 면적 (자동)
📊 통계: 평균/최고/최저 단가 (자동)
🔒 제약: Mock 데이터 상태에서는 M1 Lock 불가
✅ 추천: 최소 3건 이상, 1년 이내, 500m 이내
```

---

**작성일**: 2025-12-18  
**작성자**: ZeroSite Development Team  
**버전**: v1.0  
**관련 파일**:
- `frontend/src/components/m1/TransactionEditor.tsx`
- `frontend/src/components/m1/TransactionEditor.css`
- `frontend/src/components/m1/ReviewScreen.tsx`
- `frontend/src/types/m1.types.ts`
