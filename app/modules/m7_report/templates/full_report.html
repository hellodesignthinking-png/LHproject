{% extends "base_report.html" %}

{% block content %}

<!-- 1. Executive Summary -->
<h1>1. ê²½ì˜ì§„ ìš”ì•½ (Executive Summary)</h1>

<div class="score-card">
    <div class="score-label">LH ì¢…í•© í‰ê°€ ì ìˆ˜</div>
    <div class="score-value">{{ executive_summary.key_metrics.total_score }}</div>
    <div class="score-label">íŒì •: {{ executive_summary.key_metrics.judgement }} | ë“±ê¸‰: {{ executive_summary.key_metrics.grade }}</div>
</div>

<h2>í•µì‹¬ ì§€í‘œ</h2>
<div class="section-grid">
    <div class="section-item">
        <h4>ì§€ì—­</h4>
        <div class="value">{{ executive_summary.key_metrics.region }}</div>
    </div>
    <div class="section-item">
        <h4>í† ì§€ê°€</h4>
        <div class="value">{{ executive_summary.key_metrics.land_value }}</div>
    </div>
    <div class="section-item">
        <h4>ì´ ì„¸ëŒ€ìˆ˜</h4>
        <div class="value">{{ executive_summary.key_metrics.total_units }}ì„¸ëŒ€</div>
    </div>
    <div class="section-item">
        <h4>NPV</h4>
        <div class="value">{{ executive_summary.key_metrics.npv }}</div>
    </div>
    <div class="section-item">
        <h4>IRR</h4>
        <div class="value">{{ executive_summary.key_metrics.irr }}</div>
    </div>
    <div class="section-item">
        <h4>íŒì •</h4>
        <div class="value">
            {% if executive_summary.key_metrics.judgement == "GO" %}
                <span class="badge badge-success">GO</span>
            {% elif executive_summary.key_metrics.judgement == "CONDITIONAL" %}
                <span class="badge badge-warning">CONDITIONAL</span>
            {% else %}
                <span class="badge badge-danger">NO_GO</span>
            {% endif %}
        </div>
    </div>
</div>

<h2>í•µì‹¬ ê°•ì </h2>
<div class="info-box success">
    <ul>
    {% for strength in executive_summary.strengths %}
        <li>âœ“ {{ strength }}</li>
    {% endfor %}
    </ul>
</div>

<h2>í•µì‹¬ ì•½ì </h2>
<div class="info-box warning">
    <ul>
    {% for weakness in executive_summary.weaknesses %}
        <li>âš  {{ weakness }}</li>
    {% endfor %}
    </ul>
</div>

<h2>ì¦‰ì‹œ ëŒ€ì‘ í•„ìš” í•­ëª©</h2>
<div class="info-box danger">
    <ul>
    {% for action in executive_summary.immediate_actions %}
        <li>ğŸš¨ {{ action }}</li>
    {% endfor %}
    </ul>
</div>

<h2>ìµœì¢… ê¶Œê³ ì‚¬í•­</h2>
<div class="info-box">
    <p><strong>{{ executive_summary.recommendation }}</strong></p>
</div>

<div class="page-break"></div>

<!-- 2. LH Scorecard -->
<h1>2. LH 100ì  í‰ê°€í‘œ (Comprehensive Scorecard)</h1>

<table>
    <thead>
        <tr>
            <th>ì„¹ì…˜</th>
            <th>ì›ì ìˆ˜</th>
            <th>ê°€ì¤‘ ì ìˆ˜</th>
            <th>ë§Œì </th>
            <th>ë¹„ìœ¨</th>
            <th>ìƒíƒœ</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>[A] ì •ì±…Â·ìœ í˜• ì í•©ì„±</strong></td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.policy.raw_score) }}</td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.policy.weighted_score) }}</td>
            <td>{{ lh_scorecard.sections.policy.max_score }}</td>
            <td>{{ "%.0f"|format(lh_scorecard.sections.policy.percentage) }}%</td>
            <td>
                {% if lh_scorecard.sections.policy.status == "ìš°ìˆ˜" %}
                    <span class="badge badge-success">{{ lh_scorecard.sections.policy.status }}</span>
                {% elif lh_scorecard.sections.policy.status == "ì–‘í˜¸" %}
                    <span class="badge badge-info">{{ lh_scorecard.sections.policy.status }}</span>
                {% elif lh_scorecard.sections.policy.status == "ë³´í†µ" %}
                    <span class="badge badge-warning">{{ lh_scorecard.sections.policy.status }}</span>
                {% else %}
                    <span class="badge badge-danger">{{ lh_scorecard.sections.policy.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>[B] ì…ì§€Â·í™˜ê²½ í‰ê°€</strong></td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.location.raw_score) }}</td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.location.weighted_score) }}</td>
            <td>{{ lh_scorecard.sections.location.max_score }}</td>
            <td>{{ "%.0f"|format(lh_scorecard.sections.location.percentage) }}%</td>
            <td>
                {% if lh_scorecard.sections.location.status == "ìš°ìˆ˜" %}
                    <span class="badge badge-success">{{ lh_scorecard.sections.location.status }}</span>
                {% elif lh_scorecard.sections.location.status == "ì–‘í˜¸" %}
                    <span class="badge badge-info">{{ lh_scorecard.sections.location.status }}</span>
                {% elif lh_scorecard.sections.location.status == "ë³´í†µ" %}
                    <span class="badge badge-warning">{{ lh_scorecard.sections.location.status }}</span>
                {% else %}
                    <span class="badge badge-danger">{{ lh_scorecard.sections.location.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>[C] ê±´ì¶• ê°€ëŠ¥ì„±</strong></td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.construction.raw_score) }}</td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.construction.weighted_score) }}</td>
            <td>{{ lh_scorecard.sections.construction.max_score }}</td>
            <td>{{ "%.0f"|format(lh_scorecard.sections.construction.percentage) }}%</td>
            <td>
                {% if lh_scorecard.sections.construction.status == "ìš°ìˆ˜" %}
                    <span class="badge badge-success">{{ lh_scorecard.sections.construction.status }}</span>
                {% elif lh_scorecard.sections.construction.status == "ì–‘í˜¸" %}
                    <span class="badge badge-info">{{ lh_scorecard.sections.construction.status }}</span>
                {% elif lh_scorecard.sections.construction.status == "ë³´í†µ" %}
                    <span class="badge badge-warning">{{ lh_scorecard.sections.construction.status }}</span>
                {% else %}
                    <span class="badge badge-danger">{{ lh_scorecard.sections.construction.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>[D] ê°€ê²©Â·ë§¤ì… ì ì •ì„±</strong></td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.price.raw_score) }}</td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.price.weighted_score) }}</td>
            <td>{{ lh_scorecard.sections.price.max_score }}</td>
            <td>{{ "%.0f"|format(lh_scorecard.sections.price.percentage) }}%</td>
            <td>
                {% if lh_scorecard.sections.price.status == "ìš°ìˆ˜" %}
                    <span class="badge badge-success">{{ lh_scorecard.sections.price.status }}</span>
                {% elif lh_scorecard.sections.price.status == "ì–‘í˜¸" %}
                    <span class="badge badge-info">{{ lh_scorecard.sections.price.status }}</span>
                {% elif lh_scorecard.sections.price.status == "ë³´í†µ" %}
                    <span class="badge badge-warning">{{ lh_scorecard.sections.price.status }}</span>
                {% else %}
                    <span class="badge badge-danger">{{ lh_scorecard.sections.price.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>[E] ì‚¬ì—…ì„±</strong></td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.business.raw_score) }}</td>
            <td>{{ "%.1f"|format(lh_scorecard.sections.business.weighted_score) }}</td>
            <td>{{ lh_scorecard.sections.business.max_score }}</td>
            <td>{{ "%.0f"|format(lh_scorecard.sections.business.percentage) }}%</td>
            <td>
                {% if lh_scorecard.sections.business.status == "ìš°ìˆ˜" %}
                    <span class="badge badge-success">{{ lh_scorecard.sections.business.status }}</span>
                {% elif lh_scorecard.sections.business.status == "ì–‘í˜¸" %}
                    <span class="badge badge-info">{{ lh_scorecard.sections.business.status }}</span>
                {% elif lh_scorecard.sections.business.status == "ë³´í†µ" %}
                    <span class="badge badge-warning">{{ lh_scorecard.sections.business.status }}</span>
                {% else %}
                    <span class="badge badge-danger">{{ lh_scorecard.sections.business.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr style="background-color: #f0f0f0; font-weight: bold;">
            <td><strong>í•©ê³„</strong></td>
            <td><strong>{{ "%.1f"|format(lh_scorecard.total_score) }}</strong></td>
            <td>-</td>
            <td><strong>100</strong></td>
            <td><strong>{{ "%.0f"|format(lh_scorecard.total_score) }}%</strong></td>
            <td><strong>{{ lh_scorecard.grade }}</strong></td>
        </tr>
    </tbody>
</table>

<h2>ì§€ì ë³„ ê°€ì¤‘ì¹˜ ({{ lh_scorecard.region_weight }})</h2>
<table>
    <thead>
        <tr>
            <th>í•­ëª©</th>
            <th>ê°€ì¤‘ì¹˜</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ì •ì±…Â·ìœ í˜•</td>
            <td>Ã—{{ lh_scorecard.applied_weights.policy }}</td>
        </tr>
        <tr>
            <td>ì…ì§€Â·í™˜ê²½</td>
            <td>Ã—{{ lh_scorecard.applied_weights.location }}</td>
        </tr>
        <tr>
            <td>ê±´ì¶•</td>
            <td>Ã—{{ lh_scorecard.applied_weights.construction }}</td>
        </tr>
        <tr>
            <td>ê°€ê²©</td>
            <td>Ã—{{ lh_scorecard.applied_weights.price }}</td>
        </tr>
        <tr>
            <td>ì‚¬ì—…ì„±</td>
            <td>Ã—{{ lh_scorecard.applied_weights.business }}</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<!-- 3. Section Analysis -->
<h1>3. ì„¹ì…˜ë³„ ìƒì„¸ ë¶„ì„ (Section Analysis)</h1>

{% for section in section_analysis.sections %}
<h2>[{{ section.id }}] {{ section.name }} ({{ "%.0f"|format((section.score / section.max) * 100) }}%)</h2>

<div class="progress">
    <div class="progress-bar 
        {% if (section.score / section.max) >= 0.8 %}progress-bar-success
        {% elif (section.score / section.max) >= 0.6 %}progress-bar-warning
        {% else %}progress-bar-danger{% endif %}"
        style="width: {{ "%.0f"|format((section.score / section.max) * 100) }}%">
        {{ "%.1f"|format(section.score) }}/{{ section.max }}
    </div>
</div>

<h3>ì„¸ë¶€ í•­ëª©</h3>
<table>
    <thead>
        <tr>
            <th>í•­ëª©</th>
            <th>ì ìˆ˜</th>
        </tr>
    </thead>
    <tbody>
    {% for item_name, item_score in section.score_items.items() %}
        <tr>
            <td>{{ item_name }}</td>
            <td>{{ "%.1f"|format(item_score) }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h3>ì „ë¬¸ê°€ ë¶„ì„</h3>
<div class="info-box">
    <p>{{ section.analysis }}</p>
</div>
{% endfor %}

<div class="page-break"></div>

<!-- 4. Improvement Roadmap -->
<h1>4. ê°œì„  ë¡œë“œë§µ (Improvement Roadmap)</h1>

{% if improvement_roadmap.reject_reasons %}
<h2>ì¦‰ì‹œ íƒˆë½ ì‚¬ìœ </h2>
<div class="info-box danger">
    <ul>
    {% for reason in improvement_roadmap.reject_reasons %}
        <li>âŒ {{ reason }}</li>
    {% endfor %}
    </ul>
</div>
{% endif %}

{% if improvement_roadmap.deduction_reasons %}
<h2>ê°ì  ì‚¬ìœ </h2>
<div class="info-box warning">
    <ul>
    {% for reason in improvement_roadmap.deduction_reasons %}
        <li>âš  {{ reason }}</li>
    {% endfor %}
    </ul>
</div>
{% endif %}

<h2>ê°œì„  ë°©ì•ˆ</h2>
<div class="info-box success">
    <ul>
    {% for point in improvement_roadmap.improvement_points %}
        <li>âœ“ {{ point }}</li>
    {% endfor %}
    </ul>
</div>

<h2>ìš°ì„ ìˆœìœ„ ì•¡ì…˜</h2>
<table>
    <thead>
        <tr>
            <th>ìš°ì„ ìˆœìœ„</th>
            <th>ì•¡ì…˜</th>
            <th>íƒ€ì„ë¼ì¸</th>
        </tr>
    </thead>
    <tbody>
    {% for action in improvement_roadmap.priority_actions %}
        <tr>
            <td>
                {% if action.priority == "Critical" %}
                    <span class="badge badge-danger">{{ action.priority }}</span>
                {% elif action.priority == "High" %}
                    <span class="badge badge-warning">{{ action.priority }}</span>
                {% else %}
                    <span class="badge badge-info">{{ action.priority }}</span>
                {% endif %}
            </td>
            <td>{{ action.action }}</td>
            <td>{{ action.timeline }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h2>ê°œì„  íƒ€ì„ë¼ì¸</h2>
<div class="section-grid">
    {% for phase, description in improvement_roadmap.timeline.items() %}
    <div class="section-item">
        <h4>{{ phase|upper|replace("_", " ") }}</h4>
        <div class="value" style="font-size: 12pt;">{{ description }}</div>
    </div>
    {% endfor %}
</div>

<div class="page-break"></div>

<!-- 5. Financial Analysis -->
<h1>5. ì¬ë¬´ ë¶„ì„ (Financial Analysis)</h1>

<h2>í† ì§€ ë§¤ì…</h2>
<table>
    <tbody>
        <tr>
            <td>ì´ í† ì§€ê°€</td>
            <td><strong>â‚©{{ "{:,.0f}".format(financial_analysis.land_acquisition.total_land_value) }}</strong></td>
        </tr>
        <tr>
            <td>ã¡ë‹¹ ë‹¨ê°€</td>
            <td>â‚©{{ "{:,.0f}".format(financial_analysis.land_acquisition.unit_price_sqm) }}</td>
        </tr>
        <tr>
            <td>í‰ë‹¹ ë‹¨ê°€</td>
            <td>â‚©{{ "{:,.0f}".format(financial_analysis.land_acquisition.unit_price_pyeong) }}</td>
        </tr>
        <tr>
            <td>ì‹ ë¢°ë„</td>
            <td>{{ "%.0f"|format(financial_analysis.land_acquisition.confidence * 100) }}%</td>
        </tr>
    </tbody>
</table>

<h2>ê°œë°œ ê·œëª¨</h2>
<table>
    <tbody>
        <tr>
            <td>ì´ ì„¸ëŒ€ìˆ˜</td>
            <td><strong>{{ financial_analysis.development_scale.total_units }}ì„¸ëŒ€</strong></td>
        </tr>
        <tr>
            <td>ì—°ë©´ì </td>
            <td>{{ "{:,.1f}".format(financial_analysis.development_scale.total_gfa_sqm) }}ã¡</td>
        </tr>
        <tr>
            <td>ì ìš© ìš©ì ë¥ </td>
            <td>{{ financial_analysis.development_scale.far_applied }}%</td>
        </tr>
        <tr>
            <td>ì ìš© ê±´íìœ¨</td>
            <td>{{ financial_analysis.development_scale.bcr_applied }}%</td>
        </tr>
    </tbody>
</table>

<h2>ë¹„ìš© êµ¬ì¡°</h2>
<table>
    <tbody>
        <tr>
            <td>ì´ ì‚¬ì—…ë¹„</td>
            <td><strong>â‚©{{ "{:,.0f}".format(financial_analysis.cost_structure.total_cost) }}</strong></td>
        </tr>
        <tr>
            <td>í† ì§€ë¹„</td>
            <td>â‚©{{ "{:,.0f}".format(financial_analysis.cost_structure.land_cost) }} ({{ "%.1f"|format((financial_analysis.cost_structure.land_cost / financial_analysis.cost_structure.total_cost) * 100) }}%)</td>
        </tr>
        <tr>
            <td>ê³µì‚¬ë¹„</td>
            <td>â‚©{{ "{:,.0f}".format(financial_analysis.cost_structure.construction_cost) }} ({{ "%.1f"|format((financial_analysis.cost_structure.construction_cost / financial_analysis.cost_structure.total_cost) * 100) }}%)</td>
        </tr>
        <tr>
            <td>ì„¸ëŒ€ë‹¹ ë¹„ìš©</td>
            <td>â‚©{{ "{:,.0f}".format(financial_analysis.cost_structure.cost_per_unit) }}</td>
        </tr>
    </tbody>
</table>

<h2>ìˆ˜ìµì„±</h2>
<table>
    <tbody>
        <tr>
            <td>ì´ ìˆ˜ìµ</td>
            <td><strong>â‚©{{ "{:,.0f}".format(financial_analysis.revenue_projection.total_revenue) }}</strong></td>
        </tr>
        <tr>
            <td>NPV (ê³µê³µ)</td>
            <td>
                {% if financial_analysis.profitability.npv_public >= 0 %}
                    <span style="color: green;">â‚©{{ "{:,.0f}".format(financial_analysis.profitability.npv_public) }}</span>
                {% else %}
                    <span style="color: red;">â‚©{{ "{:,.0f}".format(financial_analysis.profitability.npv_public) }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>IRR (ê³µê³µ)</td>
            <td>
                {% if financial_analysis.profitability.irr_public >= 12 %}
                    <span style="color: green;">{{ "%.2f"|format(financial_analysis.profitability.irr_public) }}%</span>
                {% else %}
                    <span style="color: red;">{{ "%.2f"|format(financial_analysis.profitability.irr_public) }}%</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>ìˆ˜ìµì„± ë“±ê¸‰</td>
            <td><span class="badge 
                {% if financial_analysis.profitability.grade in ['S', 'A'] %}badge-success
                {% elif financial_analysis.profitability.grade in ['B', 'C'] %}badge-warning
                {% else %}badge-danger{% endif %}">{{ financial_analysis.profitability.grade }}</span></td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<!-- 6. Conclusion -->
<h1>6. ê²°ë¡  (Conclusion)</h1>

<div class="score-card">
    <div class="score-label">ìµœì¢… íŒì •</div>
    <div class="score-value" style="font-size: 36pt;">{{ conclusion.final_judgement }}</div>
    <div class="score-label">ì´ì : {{ conclusion.total_score }} | ë“±ê¸‰: {{ conclusion.grade }} | ì‹ ë¢°ë„: {{ conclusion.confidence_level }}</div>
</div>

<h2>ìµœì¢… ê¶Œê³ ì‚¬í•­</h2>
<div class="info-box 
    {% if conclusion.final_judgement == 'GO' %}success
    {% elif conclusion.final_judgement == 'CONDITIONAL' %}warning
    {% else %}danger{% endif %}">
    <p><strong>{{ conclusion.recommendation }}</strong></p>
</div>

<h2>ë‹¤ìŒ ë‹¨ê³„ (Next Steps)</h2>
<ol>
{% for step in conclusion.next_steps %}
    <li>{{ step }}</li>
{% endfor %}
</ol>

{% endblock %}
