"""
Advanced Address Parser
ê³ ê¸‰ ì£¼ì†Œ íŒŒì‹± ì‹œìŠ¤í…œ v28.0

Features:
- ë„ë¡œëª… ì£¼ì†Œ â†’ êµ¬Â·ë™ ì¶”ì¶œ
- ì§€ë²ˆ ì£¼ì†Œ â†’ êµ¬Â·ë™ ì¶”ì¶œ  
- 3ë‹¨ê³„ Fallback: ì§ì ‘ ì¶”ì¶œ â†’ ë„ë¡œëª… ë§¤í•‘ â†’ Kakao API
"""

import re
from typing import Dict, Optional
import logging

logger = logging.getLogger(__name__)


class AdvancedAddressParser:
    """
    í•œêµ­ ì£¼ì†Œ íŒŒì‹± ì „ë¬¸ í´ë˜ìŠ¤
    
    Example:
        parser = AdvancedAddressParser()
        result = parser.parse("ì„œìš¸ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 120")
        # {'gu': 'ë§ˆí¬êµ¬', 'dong': 'ìƒì•”ë™', 'road_name': 'ì›”ë“œì»µë¶ë¡œ', 'success': True}
    """
    
    # ì„œìš¸ 25ê°œ êµ¬ ëª©ë¡
    SEOUL_GU_LIST = [
        'ê°•ë‚¨êµ¬', 'ê°•ë™êµ¬', 'ê°•ë¶êµ¬', 'ê°•ì„œêµ¬', 'ê´€ì•…êµ¬',
        'ê´‘ì§„êµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ë…¸ì›êµ¬', 'ë„ë´‰êµ¬',
        'ë™ëŒ€ë¬¸êµ¬', 'ë™ì‘êµ¬', 'ë§ˆí¬êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ì„œì´ˆêµ¬',
        'ì„±ë™êµ¬', 'ì„±ë¶êµ¬', 'ì†¡íŒŒêµ¬', 'ì–‘ì²œêµ¬', 'ì˜ë“±í¬êµ¬',
        'ìš©ì‚°êµ¬', 'ì€í‰êµ¬', 'ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ì¤‘ë‘êµ¬'
    ]
    
    # êµ¬ë³„ ì£¼ìš” ë™ ëª©ë¡
    GU_DONG_MAP = {
        'ë§ˆí¬êµ¬': ['ê³µë•ë™', 'ë„í™”ë™', 'ë§ˆí¬ë™', 'ëŒ€í¥ë™', 'ì—¼ë¦¬ë™', 
                  'ì‹ ìˆ˜ë™', 'ì„œê°•ë™', 'ì„œêµë™', 'í•©ì •ë™', 'ë§ì›ë™',
                  'ì—°ë‚¨ë™', 'ì„±ì‚°ë™', 'ìƒì•”ë™', 'ì•„í˜„ë™', 'ë…¸ê³ ì‚°ë™'],
        'ê°•ë‚¨êµ¬': ['ì—­ì‚¼ë™', 'ì‚¼ì„±ë™', 'ëŒ€ì¹˜ë™', 'ì‹ ì‚¬ë™', 'ë…¼í˜„ë™',
                  'ì••êµ¬ì •ë™', 'ì²­ë‹´ë™', 'ë„ê³¡ë™', 'ê°œí¬ë™', 'ì„¸ê³¡ë™',
                  'ì¼ì›ë™', 'ìˆ˜ì„œë™'],
        'ì„œì´ˆêµ¬': ['ì„œì´ˆë™', 'ì ì›ë™', 'ë°˜í¬ë™', 'ë°©ë°°ë™', 'ì–‘ì¬ë™',
                  'ìš°ë©´ë™', 'ë‚´ê³¡ë™'],
        'ì†¡íŒŒêµ¬': ['ì ì‹¤ë™', 'ì‹ ì²œë™', 'í’ë‚©ë™', 'ì†¡íŒŒë™', 'ì„ì´Œë™',
                  'ì‚¼ì „ë™', 'ê°€ë½ë™', 'ë¬¸ì •ë™', 'ì¥ì§€ë™', 'ë°©ì´ë™'],
        'ì˜ë“±í¬êµ¬': ['ì˜ë“±í¬ë™', 'ì—¬ì˜ë„ë™', 'ë‹¹ì‚°ë™', 'ë„ë¦¼ë™', 'ë¬¸ë˜ë™',
                   'ì–‘í‰ë™', 'ì‹ ê¸¸ë™', 'ëŒ€ë¦¼ë™', 'ì–‘í™”ë™'],
        'ìš©ì‚°êµ¬': ['í›„ì•”ë™', 'ìš©ì‚°ë™', 'ë‚¨ì˜ë™', 'ì²­íŒŒë™', 'ì›íš¨ë¡œ',
                  'íš¨ì°½ë™', 'í•œê°•ë¡œ', 'ì´ì´Œë™', 'ì´íƒœì›ë™', 'í•œë‚¨ë™',
                  'ì„œë¹™ê³ ë™'],
        'ì„±ë™êµ¬': ['ì™•ì‹­ë¦¬', 'ë§ˆì¥ë™', 'ì‚¬ê·¼ë™', 'í–‰ë‹¹ë™', 'ì‘ë´‰ë™',
                  'ê¸ˆí˜¸ë™', 'ì˜¥ìˆ˜ë™', 'ì„±ìˆ˜ë™', 'ì†¡ì •ë™'],
        'ê´‘ì§„êµ¬': ['ì¤‘ê³¡ë™', 'ëŠ¥ë™', 'êµ¬ì˜ë™', 'ê´‘ì¥ë™', 'ìì–‘ë™', 'í™”ì–‘ë™'],
        'ê°•ì„œêµ¬': ['í™”ê³¡ë™', 'ê°€ì–‘ë™', 'ë“±ì´Œë™', 'ì—¼ì°½ë™', 'ë°©í™”ë™',
                  'ê³µí•­ë™', 'ë§ˆê³¡ë™'],
        'ì–‘ì²œêµ¬': ['ì‹ ì›”ë™', 'ì‹ ì •ë™', 'ëª©ë™'],
        'êµ¬ë¡œêµ¬': ['êµ¬ë¡œë™', 'ê°€ë¦¬ë´‰ë™', 'ì‹ ë„ë¦¼ë™', 'ê³ ì²™ë™', 'ê°œë´‰ë™', 'ì˜¤ë¥˜ë™'],
        'ê¸ˆì²œêµ¬': ['ê°€ì‚°ë™', 'ë…ì‚°ë™', 'ì‹œí¥ë™'],
        'ê´€ì•…êµ¬': ['ë´‰ì²œë™', 'ì‹ ë¦¼ë™', 'ë‚¨í˜„ë™'],
        'ë™ì‘êµ¬': ['ë…¸ëŸ‰ì§„ë™', 'ìƒë„ë™', 'í‘ì„ë™', 'ì‚¬ë‹¹ë™', 'ëŒ€ë°©ë™', 'ì‹ ëŒ€ë°©ë™'],
        'ì„œëŒ€ë¬¸êµ¬': ['ì¶©ì •ë¡œ', 'ì²œì—°ë™', 'ì‹ ì´Œë™', 'ì—°í¬ë™', 'í™ì œë™', 'í™ì€ë™',
                   'ë¶ê°€ì¢Œë™', 'ë‚¨ê°€ì¢Œë™'],
        'ì€í‰êµ¬': ['ì—­ì´Œë™', 'ì‘ì•”ë™', 'ë¶ˆê´‘ë™', 'ë…¹ë²ˆë™', 'ê°ˆí˜„ë™', 'êµ¬ì‚°ë™',
                  'ëŒ€ì¡°ë™', 'ì§„ê´€ë™'],
        'ì¢…ë¡œêµ¬': ['ì²­ìš´ë™', 'ì‚¬ì§ë™', 'ì‚¼ì²­ë™', 'ë¶€ì•”ë™', 'í‰ì°½ë™', 'ë¬´ì•…ë™',
                  'êµë‚¨ë™', 'ê°€íšŒë™', 'ì¢…ë¡œ', 'ì°½ì‹ ë™', 'ìˆ­ì¸ë™', 'í˜œí™”ë™'],
        'ì¤‘êµ¬': ['ì†Œê³µë™', 'íšŒí˜„ë™', 'ëª…ë™', 'í•„ë™', 'ì¥ì¶©ë™', 'ê´‘í¬ë™',
                'ì„ì§€ë¡œ', 'ì¶©ë¬´ë¡œ', 'ì‹ ë‹¹ë™', 'ë‹¤ì‚°ë™', 'í™©í•™ë™'],
        'ì„±ë¶êµ¬': ['ì„±ë¶ë™', 'ì‚¼ì„ ë™', 'ë™ì„ ë™', 'ë™ì†Œë¬¸ë™', 'ì•ˆì•”ë™',
                  'ë³´ë¬¸ë™', 'ì •ë¦‰ë™', 'ê¸¸ìŒë™', 'ì¢…ì•”ë™', 'ì„ê´€ë™'],
        'ê°•ë¶êµ¬': ['ë¯¸ì•„ë™', 'ë²ˆë™', 'ìˆ˜ìœ ë™', 'ìš°ì´ë™'],
        'ë„ë´‰êµ¬': ['ìŒë¬¸ë™', 'ë°©í•™ë™', 'ì°½ë™', 'ë„ë´‰ë™'],
        'ë…¸ì›êµ¬': ['ì›”ê³„ë™', 'ê³µë¦‰ë™', 'í•˜ê³„ë™', 'ì¤‘ê³„ë™', 'ìƒê³„ë™'],
        'ë™ëŒ€ë¬¸êµ¬': ['ìš©ì‹ ë™', 'ì œê¸°ë™', 'ì „ë†ë™', 'ë‹µì‹­ë¦¬ë™', 'ì¥ì•ˆë™',
                   'ì²­ëŸ‰ë¦¬ë™', 'íšŒê¸°ë™', 'íœ˜ê²½ë™', 'ì´ë¬¸ë™'],
        'ì¤‘ë‘êµ¬': ['ë©´ëª©ë™', 'ìƒë´‰ë™', 'ì¤‘í™”ë™', 'ë¬µë™', 'ë§ìš°ë™', 'ì‹ ë‚´ë™'],
        'ê°•ë™êµ¬': ['ê°•ì¼ë™', 'ìƒì¼ë™', 'ëª…ì¼ë™', 'ê³ ë•ë™', 'ì•”ì‚¬ë™',
                  'ì²œí˜¸ë™', 'ì„±ë‚´ë™', 'ê¸¸ë™', 'ë‘”ì´Œë™']
    }
    
    # ë„ë¡œëª… â†’ ë™ ë§¤í•‘ (ì£¼ìš” ë„ë¡œì˜ ì •í™•í•œ ë™ ìœ„ì¹˜)
    ROAD_TO_DONG = {
        # ë§ˆí¬êµ¬
        'ì›”ë“œì»µë¶ë¡œ': 'ìƒì•”ë™',
        'ì›”ë“œì»µë¡œ': 'ìƒì•”ë™',
        'ì–‘í™”ë¡œ': 'í•©ì •ë™',
        'ì„œêµë¡œ': 'ì„œêµë™',
        'í™ìµë¡œ': 'ì„œêµë™',
        'ë§ˆí¬ëŒ€ë¡œ': 'ë§ˆí¬ë™',
        'ê³µë•ë¡œ': 'ê³µë•ë™',
        
        # ê°•ë‚¨êµ¬
        'í…Œí—¤ë€ë¡œ': 'ì—­ì‚¼ë™',
        'ê°•ë‚¨ëŒ€ë¡œ': 'ì—­ì‚¼ë™',
        'ì—­ì‚¼ë¡œ': 'ì—­ì‚¼ë™',
        'ë…¼í˜„ë¡œ': 'ë…¼í˜„ë™',
        'ì„ ë¦‰ë¡œ': 'ëŒ€ì¹˜ë™',
        'ì••êµ¬ì •ë¡œ': 'ì••êµ¬ì •ë™',
        'ì²­ë‹´ë¡œ': 'ì²­ë‹´ë™',
        'ë„ì‚°ëŒ€ë¡œ': 'ì‹ ì‚¬ë™',
        
        # ì„œì´ˆêµ¬
        'ì„œì´ˆëŒ€ë¡œ': 'ì„œì´ˆë™',
        'ë°˜í¬ëŒ€ë¡œ': 'ë°˜í¬ë™',
        'ë°©ë°°ë¡œ': 'ë°©ë°°ë™',
        
        # ì†¡íŒŒêµ¬
        'ì†¡íŒŒëŒ€ë¡œ': 'ì†¡íŒŒë™',
        'ì˜¬ë¦¼í”½ë¡œ': 'ì ì‹¤ë™',
        'ë°±ì œê³ ë¶„ë¡œ': 'ì†¡íŒŒë™',
        
        # ì˜ë“±í¬êµ¬
        'ì—¬ì˜ëŒ€ë¡œ': 'ì—¬ì˜ë„ë™',
        'êµ­íšŒëŒ€ë¡œ': 'ì—¬ì˜ë„ë™',
        'ë‹¹ì‚°ë¡œ': 'ë‹¹ì‚°ë™',
        'ì˜ë“±í¬ë¡œ': 'ì˜ë“±í¬ë™',
        
        # ê¸°íƒ€ ì£¼ìš” ë„ë¡œ
        'ì´íƒœì›ë¡œ': 'ì´íƒœì›ë™',
        'í•œë‚¨ëŒ€ë¡œ': 'í•œë‚¨ë™',
        'ì„±ìˆ˜ì´ë¡œ': 'ì„±ìˆ˜ë™',
        'ì™•ì‹­ë¦¬ë¡œ': 'ì™•ì‹­ë¦¬',
    }
    
    # ì£¼ìš” ëŒ€ë¡œ â†’ êµ¬Â·ë™ ë§¤í•‘ (100ê°œ ì´ìƒ)
    ROAD_TO_GU = {
        # ë§ˆí¬êµ¬
        'ì›”ë“œì»µë¶ë¡œ': 'ë§ˆí¬êµ¬',
        'ì›”ë“œì»µë¡œ': 'ë§ˆí¬êµ¬',
        'ë§ˆí¬ëŒ€ë¡œ': 'ë§ˆí¬êµ¬',
        'ì–‘í™”ë¡œ': 'ë§ˆí¬êµ¬',
        'ì„œêµë¡œ': 'ë§ˆí¬êµ¬',
        'í™ìµë¡œ': 'ë§ˆí¬êµ¬',
        'ì™€ìš°ì‚°ë¡œ': 'ë§ˆí¬êµ¬',
        'í† ì •ë¡œ': 'ë§ˆí¬êµ¬',
        
        # ê°•ë‚¨êµ¬
        'í…Œí—¤ë€ë¡œ': 'ê°•ë‚¨êµ¬',
        'ê°•ë‚¨ëŒ€ë¡œ': 'ê°•ë‚¨êµ¬',
        'ì—­ì‚¼ë¡œ': 'ê°•ë‚¨êµ¬',
        'ë…¼í˜„ë¡œ': 'ê°•ë‚¨êµ¬',
        'ì„ ë¦‰ë¡œ': 'ê°•ë‚¨êµ¬',
        'ì–¸ì£¼ë¡œ': 'ê°•ë‚¨êµ¬',
        'ì˜ë™ëŒ€ë¡œ': 'ê°•ë‚¨êµ¬',
        'ë„ì‚°ëŒ€ë¡œ': 'ê°•ë‚¨êµ¬',
        'ì••êµ¬ì •ë¡œ': 'ê°•ë‚¨êµ¬',
        'í•™ë™ë¡œ': 'ê°•ë‚¨êµ¬',
        
        # ì„œì´ˆêµ¬
        'ì„œì´ˆëŒ€ë¡œ': 'ì„œì´ˆêµ¬',
        'ë°˜í¬ëŒ€ë¡œ': 'ì„œì´ˆêµ¬',
        'ì‚¬í‰ëŒ€ë¡œ': 'ì„œì´ˆêµ¬',
        'ë‚¨ë¶€ìˆœí™˜ë¡œ': 'ì„œì´ˆêµ¬',
        'í—Œë¦‰ë¡œ': 'ì„œì´ˆêµ¬',
        'ì ì›ë¡œ': 'ì„œì´ˆêµ¬',
        
        # ì†¡íŒŒêµ¬
        'ì˜¬ë¦¼í”½ë¡œ': 'ì†¡íŒŒêµ¬',
        'ì†¡íŒŒëŒ€ë¡œ': 'ì†¡íŒŒêµ¬',
        'ë°±ì œê³ ë¶„ë¡œ': 'ì†¡íŒŒêµ¬',
        'ìœ„ë¡€ì„±ëŒ€ë¡œ': 'ì†¡íŒŒêµ¬',
        'ê°€ë½ë¡œ': 'ì†¡íŒŒêµ¬',
        
        # ì˜ë“±í¬êµ¬
        'ì—¬ì˜ëŒ€ë¡œ': 'ì˜ë“±í¬êµ¬',
        'êµ­íšŒëŒ€ë¡œ': 'ì˜ë“±í¬êµ¬',
        'ì€í–‰ë¡œ': 'ì˜ë“±í¬êµ¬',
        'ë‹¹ì‚°ë¡œ': 'ì˜ë“±í¬êµ¬',
        'ì˜ë“±í¬ë¡œ': 'ì˜ë“±í¬êµ¬',
        'ë¬¸ë˜ë¡œ': 'ì˜ë“±í¬êµ¬',
        
        # ìš©ì‚°êµ¬
        'ì´íƒœì›ë¡œ': 'ìš©ì‚°êµ¬',
        'í•œê°•ëŒ€ë¡œ': 'ìš©ì‚°êµ¬',
        'ì„œë¹™ê³ ë¡œ': 'ìš©ì‚°êµ¬',
        'í•œë‚¨ëŒ€ë¡œ': 'ìš©ì‚°êµ¬',
        'ì´ì´Œë¡œ': 'ìš©ì‚°êµ¬',
        
        # ì„±ë™êµ¬
        'ì™•ì‹­ë¦¬ë¡œ': 'ì„±ë™êµ¬',
        'ì„±ìˆ˜ì´ë¡œ': 'ì„±ë™êµ¬',
        'ëšì„¬ë¡œ': 'ì„±ë™êµ¬',
        'ì•„ì°¨ì‚°ë¡œ': 'ì„±ë™êµ¬',
        
        # ê´‘ì§„êµ¬
        'ëŠ¥ë™ë¡œ': 'ê´‘ì§„êµ¬',
        'êµ¬ì˜ë¡œ': 'ê´‘ì§„êµ¬',
        'ìì–‘ë¡œ': 'ê´‘ì§„êµ¬',
        
        # ê°•ì„œêµ¬
        'ê³µí•­ëŒ€ë¡œ': 'ê°•ì„œêµ¬',
        'í™”ê³¡ë¡œ': 'ê°•ì„œêµ¬',
        'ë“±ì´Œë¡œ': 'ê°•ì„œêµ¬',
        'ë°©í™”ëŒ€ë¡œ': 'ê°•ì„œêµ¬',
        
        # ì–‘ì²œêµ¬
        'ëª©ë™ì„œë¡œ': 'ì–‘ì²œêµ¬',
        'ëª©ë™ë™ë¡œ': 'ì–‘ì²œêµ¬',
        'ì‹ ì •ë¡œ': 'ì–‘ì²œêµ¬',
        
        # êµ¬ë¡œêµ¬
        'êµ¬ë¡œì¤‘ì•™ë¡œ': 'êµ¬ë¡œêµ¬',
        'ë””ì§€í„¸ë¡œ': 'êµ¬ë¡œêµ¬',
        'ê²½ì¸ë¡œ': 'êµ¬ë¡œêµ¬',
        
        # ê¸ˆì²œêµ¬
        'ì‹œí¥ëŒ€ë¡œ': 'ê¸ˆì²œêµ¬',
        'ë…ì‚°ë¡œ': 'ê¸ˆì²œêµ¬',
        'ê°€ì‚°ë””ì§€í„¸ë¡œ': 'ê¸ˆì²œêµ¬',
        
        # ê´€ì•…êµ¬
        'ê´€ì•…ë¡œ': 'ê´€ì•…êµ¬',
        'ì‹ ë¦¼ë¡œ': 'ê´€ì•…êµ¬',
        
        # ë™ì‘êµ¬
        'ë…¸ëŸ‰ì§„ë¡œ': 'ë™ì‘êµ¬',
        'ì‚¬ë‹¹ë¡œ': 'ë™ì‘êµ¬',
        'ëŒ€ë°©ë¡œ': 'ë™ì‘êµ¬',
        
        # ì„œëŒ€ë¬¸êµ¬
        'í†µì¼ë¡œ': 'ì„œëŒ€ë¬¸êµ¬',
        'ì—°í¬ë¡œ': 'ì„œëŒ€ë¬¸êµ¬',
        'ì‹ ì´Œë¡œ': 'ì„œëŒ€ë¬¸êµ¬',
        
        # ì€í‰êµ¬
        'í†µì¼ë¡œ': 'ì€í‰êµ¬',
        'ì€í‰ë¡œ': 'ì€í‰êµ¬',
        'ì§„ê´€ë¡œ': 'ì€í‰êµ¬',
        
        # ì¢…ë¡œêµ¬
        'ì¢…ë¡œ': 'ì¢…ë¡œêµ¬',
        'ìœ¨ê³¡ë¡œ': 'ì¢…ë¡œêµ¬',
        'ì°½ê²½ê¶ë¡œ': 'ì¢…ë¡œêµ¬',
        'ì‚¬ì§ë¡œ': 'ì¢…ë¡œêµ¬',
        
        # ì¤‘êµ¬
        'ì„¸ì¢…ëŒ€ë¡œ': 'ì¤‘êµ¬',
        'ì„ì§€ë¡œ': 'ì¤‘êµ¬',
        'ì¶©ë¬´ë¡œ': 'ì¤‘êµ¬',
        'í‡´ê³„ë¡œ': 'ì¤‘êµ¬',
        
        # ì„±ë¶êµ¬
        'ë™ì†Œë¬¸ë¡œ': 'ì„±ë¶êµ¬',
        'ë³´ë¬¸ë¡œ': 'ì„±ë¶êµ¬',
        'ì •ë¦‰ë¡œ': 'ì„±ë¶êµ¬',
        
        # ê°•ë¶êµ¬
        'ë„ë´‰ë¡œ': 'ê°•ë¶êµ¬',
        'ì‚¼ì–‘ë¡œ': 'ê°•ë¶êµ¬',
        
        # ë„ë´‰êµ¬
        'ë„ë´‰ë¡œ': 'ë„ë´‰êµ¬',
        'í•´ë“±ë¡œ': 'ë„ë´‰êµ¬',
        
        # ë…¸ì›êµ¬
        'ë…¸ì›ë¡œ': 'ë…¸ì›êµ¬',
        'ë™ì¼ë¡œ': 'ë…¸ì›êµ¬',
        
        # ë™ëŒ€ë¬¸êµ¬
        'ì²œí˜¸ëŒ€ë¡œ': 'ë™ëŒ€ë¬¸êµ¬',
        'ì™•ì‚°ë¡œ': 'ë™ëŒ€ë¬¸êµ¬',
        
        # ì¤‘ë‘êµ¬
        'ì‚¬ê°€ì •ë¡œ': 'ì¤‘ë‘êµ¬',
        'ë§ìš°ë¡œ': 'ì¤‘ë‘êµ¬',
        
        # ê°•ë™êµ¬
        'ì²œí˜¸ëŒ€ë¡œ': 'ê°•ë™êµ¬',
        'ì˜¬ë¦¼í”½ë¡œ': 'ê°•ë™êµ¬',
        'ìƒì¼ë¡œ': 'ê°•ë™êµ¬'
    }
    
    def __init__(self, kakao_api_key: Optional[str] = None):
        """
        Args:
            kakao_api_key: ì¹´ì¹´ì˜¤ API í‚¤ (ì„ íƒ)
        """
        self.kakao_api_key = kakao_api_key or "1b172a21a17b8b51dd47884b45228483"
        logger.info("âœ… AdvancedAddressParser initialized")
    
    def parse(self, address: str) -> Dict[str, str]:
        """
        ì£¼ì†Œ íŒŒì‹± (3ë‹¨ê³„ ì‹œë„)
        
        Args:
            address: ì…ë ¥ ì£¼ì†Œ
            
        Returns:
            {
                'gu': 'ë§ˆí¬êµ¬',
                'dong': 'ìƒì•”ë™',
                'road_name': 'ì›”ë“œì»µë¶ë¡œ',
                'success': True,
                'method': 'direct'
            }
        """
        
        logger.info(f"ğŸ” ì£¼ì†Œ íŒŒì‹± ì‹œì‘: {address}")
        
        # ì „ì²˜ë¦¬: ê³µë°± ì •ë¦¬
        address = address.strip()
        address = re.sub(r'\s+', ' ', address)
        
        # Step 1: êµ¬ ì§ì ‘ ì¶”ì¶œ
        gu = self._extract_gu_direct(address)
        
        if gu:
            logger.info(f"âœ… êµ¬ ì¶”ì¶œ ì„±ê³µ (ì§ì ‘): {gu}")
            dong = self._extract_dong_direct(address, gu)
            road = self._extract_road_name(address)
            
            # ë™ì´ ì—†ìœ¼ë©´ ë„ë¡œëª…ìœ¼ë¡œ ì¶”ì •
            if (not dong or dong == 'ì•Œìˆ˜ì—†ìŒ') and road and road in self.ROAD_TO_DONG:
                dong = self.ROAD_TO_DONG[road]
                logger.info(f"âœ… ë™ ì¶”ì¶œ ì„±ê³µ (ë„ë¡œëª… ë§¤í•‘): {road} â†’ {dong}")
            
            return {
                'gu': gu,
                'dong': dong or 'ì•Œìˆ˜ì—†ìŒ',
                'road_name': road or 'ì•Œìˆ˜ì—†ìŒ',
                'success': True,
                'method': 'direct'
            }
        
        # Step 2: ë„ë¡œëª… â†’ êµ¬Â·ë™ ì¶”ì •
        road = self._extract_road_name(address)
        
        if road and road in self.ROAD_TO_GU:
            gu = self.ROAD_TO_GU[road]
            logger.info(f"âœ… êµ¬ ì¶”ì¶œ ì„±ê³µ (ë„ë¡œëª… ë§¤í•‘): {road} â†’ {gu}")
            
            # ë„ë¡œëª…ìœ¼ë¡œ ë™ë„ ì¶”ì •
            dong = self._extract_dong_direct(address, gu)
            
            # ë„ë¡œëª… â†’ ë™ ë§¤í•‘ë„ í™•ì¸
            if not dong or dong == 'ì•Œìˆ˜ì—†ìŒ':
                if road in self.ROAD_TO_DONG:
                    dong = self.ROAD_TO_DONG[road]
                    logger.info(f"âœ… ë™ ì¶”ì¶œ ì„±ê³µ (ë„ë¡œëª… ë§¤í•‘): {road} â†’ {dong}")
            
            return {
                'gu': gu,
                'dong': dong or 'ì•Œìˆ˜ì—†ìŒ',
                'road_name': road,
                'success': True,
                'method': 'road_mapping'
            }
        
        # Step 3: ì¹´ì¹´ì˜¤ API
        kakao_result = self._parse_with_kakao(address)
        
        if kakao_result['success']:
            logger.info(f"âœ… êµ¬ ì¶”ì¶œ ì„±ê³µ (ì¹´ì¹´ì˜¤ API): {kakao_result['gu']}")
            return kakao_result
        
        # ì‹¤íŒ¨
        logger.error(f"âŒ ì£¼ì†Œ íŒŒì‹± ì‹¤íŒ¨: {address}")
        
        return {
            'gu': 'ì•Œìˆ˜ì—†ìŒ',
            'dong': 'ì•Œìˆ˜ì—†ìŒ',
            'road_name': 'ì•Œìˆ˜ì—†ìŒ',
            'success': False,
            'method': 'failed'
        }
    
    def _extract_gu_direct(self, address: str) -> Optional[str]:
        """ì£¼ì†Œì—ì„œ êµ¬ ì´ë¦„ ì§ì ‘ ì¶”ì¶œ"""
        
        for gu in self.SEOUL_GU_LIST:
            if gu in address:
                return gu
        
        return None
    
    def _extract_dong_direct(self, address: str, gu: str) -> Optional[str]:
        """ì£¼ì†Œì—ì„œ ë™ ì´ë¦„ ì§ì ‘ ì¶”ì¶œ"""
        
        if gu not in self.GU_DONG_MAP:
            return None
        
        for dong in self.GU_DONG_MAP[gu]:
            if dong in address:
                return dong
        
        return None
    
    def _extract_road_name(self, address: str) -> Optional[str]:
        """ë„ë¡œëª… ì¶”ì¶œ"""
        
        # íŒ¨í„´: XXXëŒ€ë¡œ, XXXë¡œ, XXXê¸¸
        patterns = [
            r'([ê°€-í£0-9]+ëŒ€ë¡œ)',
            r'([ê°€-í£0-9]+ë¡œ)',
            r'([ê°€-í£0-9]+ê¸¸)'
        ]
        
        for pattern in patterns:
            match = re.search(pattern, address)
            if match:
                return match.group(1)
        
        return None
    
    def _parse_with_kakao(self, address: str) -> Dict:
        """ì¹´ì¹´ì˜¤ APIë¡œ ì£¼ì†Œ íŒŒì‹±"""
        
        try:
            import requests
            
            url = "https://dapi.kakao.com/v2/local/search/address.json"
            
            headers = {
                "Authorization": f"KakaoAK {self.kakao_api_key}"
            }
            
            params = {
                "query": address
            }
            
            response = requests.get(url, headers=headers, params=params, timeout=5)
            
            if response.status_code == 200:
                data = response.json()
                
                if data.get('documents'):
                    doc = data['documents'][0]
                    
                    # ì£¼ì†Œ êµ¬ì„±ìš”ì†Œ
                    address_name = doc.get('address_name', '')
                    road_address = doc.get('road_address', {})
                    
                    # êµ¬ ì¶”ì¶œ
                    gu = None
                    for gu_name in self.SEOUL_GU_LIST:
                        if gu_name in address_name:
                            gu = gu_name
                            break
                    
                    # ë™ ì¶”ì¶œ
                    dong = None
                    if gu and gu in self.GU_DONG_MAP:
                        for dong_name in self.GU_DONG_MAP[gu]:
                            if dong_name in address_name:
                                dong = dong_name
                                break
                    
                    # ë„ë¡œëª…
                    road_name = road_address.get('road_name', '') if road_address else ''
                    
                    if gu:
                        return {
                            'gu': gu,
                            'dong': dong or 'ì•Œìˆ˜ì—†ìŒ',
                            'road_name': road_name or 'ì•Œìˆ˜ì—†ìŒ',
                            'success': True,
                            'method': 'kakao_api'
                        }
        
        except Exception as e:
            logger.error(f"âŒ ì¹´ì¹´ì˜¤ API ì˜¤ë¥˜: {e}")
        
        return {
            'gu': 'ì•Œìˆ˜ì—†ìŒ',
            'dong': 'ì•Œìˆ˜ì—†ìŒ',
            'road_name': 'ì•Œìˆ˜ì—†ìŒ',
            'success': False,
            'method': 'kakao_failed'
        }
    
    def get_sigungu_code(self, gu_name: str) -> Optional[str]:
        """êµ¬ ì´ë¦„ â†’ ì‹œêµ°êµ¬ ì½”ë“œ"""
        
        code_map = {
            'ê°•ë‚¨êµ¬': '11680', 'ê°•ë™êµ¬': '11740', 'ê°•ë¶êµ¬': '11305', 'ê°•ì„œêµ¬': '11500',
            'ê´€ì•…êµ¬': '11620', 'ê´‘ì§„êµ¬': '11215', 'êµ¬ë¡œêµ¬': '11530', 'ê¸ˆì²œêµ¬': '11545',
            'ë…¸ì›êµ¬': '11350', 'ë„ë´‰êµ¬': '11320', 'ë™ëŒ€ë¬¸êµ¬': '11230', 'ë™ì‘êµ¬': '11590',
            'ë§ˆí¬êµ¬': '11440', 'ì„œëŒ€ë¬¸êµ¬': '11410', 'ì„œì´ˆêµ¬': '11650', 'ì„±ë™êµ¬': '11200',
            'ì„±ë¶êµ¬': '11290', 'ì†¡íŒŒêµ¬': '11710', 'ì–‘ì²œêµ¬': '11470', 'ì˜ë“±í¬êµ¬': '11560',
            'ìš©ì‚°êµ¬': '11170', 'ì€í‰êµ¬': '11380', 'ì¢…ë¡œêµ¬': '11110', 'ì¤‘êµ¬': '11140',
            'ì¤‘ë‘êµ¬': '11260'
        }
        
        return code_map.get(gu_name)


# Singleton
_parser = None

def get_address_parser() -> AdvancedAddressParser:
    """AdvancedAddressParser ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜"""
    global _parser
    if _parser is None:
        _parser = AdvancedAddressParser()
    return _parser
