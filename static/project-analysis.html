<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ì¢…í•© ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 11pt; /* ë…¼ë¬¸ í‘œì¤€ í¬ê¸° */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            color: #666;
            font-size: 0.95em;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
            font-size: 0.85em;
        }

        .step:not(:last-child)::after {
            content: 'â†’';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #ddd;
        }

        .step.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #667eea;
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label {
            color: #333;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 0.9em;
            display: block;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9em;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group small {
            color: #666;
            margin-top: 3px;
            font-size: 0.8em;
            display: block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 15px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 0 auto;
            min-width: 250px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .loading-detail {
            color: #ccc;
            font-size: 0.9em;
        }

        #results {
            display: none;
        }

        /* ë…¼ë¬¸ ìŠ¤íƒ€ì¼ ë³´ê³ ì„œ ì„¹ì…˜ */
        .report-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        .report-section h2 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }

        .report-section h3 {
            color: #34495e;
            font-size: 1.1em;
            margin: 15px 0 10px 0;
            padding-left: 12px;
            border-left: 3px solid #667eea;
            font-weight: 600;
        }

        .report-section h4 {
            color: #555;
            font-size: 1em;
            margin: 12px 0 8px 0;
            font-weight: 600;
        }

        .report-section p {
            color: #333;
            font-size: 0.95em;
            line-height: 1.8;
            margin-bottom: 10px;
            text-align: justify;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stat-box .label {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .stat-box .value {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: 600;
        }

        .stat-box .unit {
            color: #666;
            font-size: 0.8em;
            margin-top: 3px;
        }

        .rating-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1em;
            margin: 10px 0;
        }

        .rating-excellent { background: #10b981; color: white; }
        .rating-good { background: #3b82f6; color: white; }
        .rating-fair { background: #f59e0b; color: white; }
        .rating-poor { background: #ef4444; color: white; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        table th {
            background: #f8f9fa;
            color: #2c3e50;
            padding: 10px;
            text-align: left;
            border: 1px solid #dee2e6;
            font-weight: 600;
            font-size: 0.9em;
        }

        table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            color: #333;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .ai-insight {
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-size: 0.9em;
            line-height: 1.7;
        }

        .ai-insight .ai-icon {
            color: #3b82f6;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-insight p {
            color: #1e40af;
            margin: 5px 0;
        }

        .improvement-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .improvement-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .priority-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .priority-high { background: #fee2e2; color: #dc2626; }
        .priority-medium { background: #fef3c7; color: #d97706; }
        .priority-low { background: #d1fae5; color: #059669; }

        .category-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
            background: #e0e7ff;
            color: #4f46e5;
        }

        .improvement-card h4 {
            color: #1f2937;
            font-size: 1em;
            margin: 8px 0;
        }

        .improvement-card p {
            color: #4b5563;
            font-size: 0.88em;
            margin: 5px 0;
        }

        .chart-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .conclusion-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .conclusion-box h3 {
            color: #92400e;
            font-size: 1.2em;
            margin-bottom: 15px;
            border: none;
            padding: 0;
        }

        .conclusion-box p {
            color: #78350f;
            font-size: 0.95em;
            line-height: 1.8;
            text-align: justify;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        ul, ol {
            margin: 10px 0 10px 25px;
        }

        li {
            margin: 6px 0;
            color: #333;
            font-size: 0.9em;
            line-height: 1.6;
        }

        /* ì¸ì‡„ìš© CSS */
        @media print {
            body {
                background: white;
                padding: 0;
                font-size: 10pt;
            }

            .container {
                max-width: 100%;
            }

            .header, .step-indicator, .card, .loading-overlay {
                box-shadow: none !important;
                page-break-inside: avoid;
            }

            .header {
                background: white;
                border: 1px solid #ddd;
            }

            .step-indicator, .action-buttons, .btn-primary, .btn-secondary {
                display: none !important;
            }

            .report-section {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
                margin-bottom: 15px;
                padding: 20px;
            }

            .report-section h2 {
                font-size: 1.2em;
                color: #000;
                page-break-after: avoid;
            }

            .report-section h3 {
                font-size: 1em;
                color: #000;
                page-break-after: avoid;
            }

            .ai-insight {
                border: 1px solid #3b82f6;
                page-break-inside: avoid;
            }

            .improvement-card {
                border: 1px solid #e5e7eb;
                page-break-inside: avoid;
            }

            .chart-container {
                page-break-inside: avoid;
            }

            table {
                font-size: 9pt;
                page-break-inside: avoid;
            }

            .stat-box {
                border: 1px solid #ddd;
            }

            /* í˜ì´ì§€ ë²ˆí˜¸ ì¶”ê°€ */
            @page {
                margin: 2cm;
                @bottom-right {
                    content: counter(page);
                }
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .step .step-title {
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ¢ LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ í”„ë¡œì íŠ¸ ì¢…í•© ë¶„ì„ ì‹œìŠ¤í…œ</h1>
            <p>AI ê¸°ë°˜ ì‚¬ì—…ì„± ë¶„ì„ ë° ê°œì„  ë°©ì•ˆ ìë™ ìƒì„±</p>
        </div>

        <!-- ë‹¨ê³„ í‘œì‹œê¸° -->
        <div class="step-indicator">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-title">í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥</div>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-title">ë°ì´í„° ë¶„ì„</div>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-title">AI í•´ì„¤ ìƒì„±</div>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-title">ê²°ê³¼ í™•ì¸</div>
            </div>
        </div>

        <!-- ì…ë ¥ í¼ -->
        <div class="card">
            <h2>ğŸ“ í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥</h2>
            <form id="projectForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.1em;">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>í”„ë¡œì íŠ¸ëª… *</label>
                        <input type="text" name="project_name" required placeholder="ì˜ˆ: ê°•ë‚¨êµ¬ ì²­ë…„ì£¼íƒ">
                    </div>
                    <div class="form-group">
                        <label>ì£¼ì†Œ *</label>
                        <input type="text" name="address" required placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45">
                    </div>
                    <div class="form-group">
                        <label>ì„¸ëŒ€ ìœ í˜• *</label>
                        <select name="unit_type" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì²­ë…„í˜•">ì²­ë…„í˜• (60ã¡ ì´í•˜)</option>
                            <option value="ì‹ í˜¼ë¶€ë¶€í˜•">ì‹ í˜¼ë¶€ë¶€í˜• (85ã¡ ì´í•˜)</option>
                            <option value="ê³ ë ¹ìí˜•">ê³ ë ¹ìí˜• (60ã¡ ì´í•˜)</option>
                        </select>
                    </div>
                </div>

                <!-- í† ì§€ ì •ë³´ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.1em;">ğŸ—ºï¸ í† ì§€ ì •ë³´</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>í† ì§€ ë©´ì  (ã¡) *</label>
                        <input type="number" name="land_area" required placeholder="500" min="100" step="0.01">
                        <small>ë‹¨ìœ„: ì œê³±ë¯¸í„° (ã¡)</small>
                    </div>
                    <div class="form-group">
                        <label>í‰ë‹¹ í† ì§€ ê°€ê²© (ì›) *</label>
                        <input type="number" name="land_price_per_pyeong" required placeholder="15000000" min="0" step="10000">
                        <small>1í‰ë‹¹ í† ì§€ ê°€ê²© (ì›/í‰)</small>
                    </div>
                    <div class="form-group">
                        <label>ì§€ì—­ *</label>
                        <select name="region" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì„œìš¸">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                            <option value="ê²½ê¸°">ê²½ê¸°ë„</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€ ì§€ì—­</option>
                        </select>
                    </div>
                </div>

                <!-- ê±´ë¬¼ ì •ë³´ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.1em;">ğŸ—ï¸ ê±´ë¬¼ ì •ë³´</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ì—°ë©´ì  (ã¡) *</label>
                        <input type="number" name="gross_area" required placeholder="1200" min="100" step="0.01">
                        <small>ê±´ë¬¼ ì „ì²´ ì—°ë©´ì </small>
                    </div>
                    <div class="form-group">
                        <label>ì„¸ëŒ€ìˆ˜ *</label>
                        <input type="number" name="num_units" required placeholder="40" min="30" step="1">
                        <small>ìµœì†Œ 30ì„¸ëŒ€ ì´ìƒ</small>
                    </div>
                    <div class="form-group">
                        <label>ì¸µìˆ˜ *</label>
                        <input type="number" name="num_floors" required placeholder="8" min="1" step="1">
                    </div>
                </div>

                <!-- ì‚¬ì—… ì¼ì • -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.1em;">ğŸ“… ì‚¬ì—… ì¼ì •</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ê³µì‚¬ ê¸°ê°„ (ë…„) *</label>
                        <input type="number" name="construction_duration_years" required placeholder="2" min="1" max="5" step="0.5">
                        <small>í† ì§€ ì·¨ë“ë¶€í„° ì¤€ê³µê¹Œì§€</small>
                    </div>
                    <div class="form-group">
                        <label>ê¸°íƒ€ ë¹„ìš© (ì›) *</label>
                        <input type="number" name="other_costs" required placeholder="200000000" min="0" step="1000000">
                        <small>ì„¤ê³„ë¹„, ì¸í—ˆê°€ë¹„, ê¸ˆìœµë¹„ìš© ë“±</small>
                    </div>
                </div>

                <!-- ì¶”ê°€ ì •ë³´ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.1em;">ğŸ’¬ ì¶”ê°€ ì •ë³´</h3>
                <div class="form-group">
                    <label>í”„ë¡œì íŠ¸ ì„¤ëª… (ì„ íƒ)</label>
                    <textarea name="description" placeholder="í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì¶”ê°€ ì„¤ëª…ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
                    <button type="button" class="btn-secondary" onclick="fillSampleData()" style="background: #10b981;">
                        ğŸ“ ìƒ˜í”Œ ë°ì´í„°ë¡œ ì±„ìš°ê¸°
                    </button>
                    <button type="submit" class="btn-primary">
                        ğŸš€ í”„ë¡œì íŠ¸ ë¶„ì„ ì‹œì‘
                    </button>
                </div>
            </form>
        </div>

        <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <div class="loading-text" id="loadingText">ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...</div>
                <div class="loading-detail" id="loadingDetail">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div id="results"></div>
    </div>

    <script>
        // ì•ˆì „í•œ ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
        function formatNumber(value) {
            if (value === null || value === undefined || isNaN(value)) {
                return '0';
            }
            return Number(value).toLocaleString();
        }

        // ìƒ˜í”Œ ë°ì´í„°ë¡œ ì±„ìš°ê¸°
        function fillSampleData() {
            const form = document.getElementById('projectForm');
            
            // ìƒ˜í”Œ ë°ì´í„°
            const sampleData = {
                project_name: 'ê°•ë‚¨êµ¬ ì²­ë…„ì£¼íƒ í”„ë¡œì íŠ¸',
                address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45',
                unit_type: 'ì²­ë…„í˜•',
                land_area: 500,
                land_price_per_pyeong: 15000000,
                region: 'ì„œìš¸',
                gross_area: 1200,
                num_units: 40,
                num_floors: 8,
                construction_duration_years: 2,
                other_costs: 200000000,
                description: 'ì—­ì‚¼ì—­ ë„ë³´ 5ë¶„ ê±°ë¦¬, ëŒ€ì¤‘êµí†µ ì ‘ê·¼ì„± ìš°ìˆ˜'
            };

            // í¼ í•„ë“œì— ê°’ ì±„ìš°ê¸°
            for (let [key, value] of Object.entries(sampleData)) {
                const field = form.querySelector(`[name="${key}"]`);
                if (field) {
                    field.value = value;
                }
            }

            // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            alert('âœ… ìƒ˜í”Œ ë°ì´í„°ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ "í”„ë¡œì íŠ¸ ë¶„ì„ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¶„ì„ì„ ì§„í–‰í•˜ì„¸ìš”.');
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('projectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = new FormData(e.target);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (value && value !== '') {
                    data[key] = isNaN(value) ? value : Number(value);
                }
            }

            // ë¶„ì„ ì‹œì‘
            await analyzeProject(data);
        });

        // í”„ë¡œì íŠ¸ ë¶„ì„ í•¨ìˆ˜
        async function analyzeProject(data) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            const loadingDetail = document.getElementById('loadingDetail');
            const resultsDiv = document.getElementById('results');

            try {
                // ë¡œë”© í‘œì‹œ
                loadingOverlay.classList.add('active');
                updateStep(2);

                // Step 1: ì¢…í•© ì‚¬ì—…ì„± ë¶„ì„
                loadingText.textContent = 'ì¢…í•© ì‚¬ì—…ì„± ë¶„ì„ ì¤‘...';
                loadingDetail.textContent = 'ê±´ì¶•ë¹„, LH ë§¤ì…ê°€, ì‚¬ì—…ì„± í‰ê°€ (1/4)';

                // í‰ë‹¹ ê°€ê²©ì„ ã¡ë‹¹ ê°€ê²©ìœ¼ë¡œ ë³€í™˜
                const landPricePerSqm = data.land_price_per_pyeong / 3.3058;
                const landPyeong = data.land_area / 3.3058;
                const landCost = landPyeong * data.land_price_per_pyeong;

                // ì„¸ëŒ€ ìœ í˜• í•œê¸€ â†’ ì˜ë¬¸ ë³€í™˜
                const unitTypeMap = {
                    'ì²­ë…„í˜•': 'YOUTH',
                    'ì‹ í˜¼ë¶€ë¶€í˜•': 'NEWLYWED',
                    'ê³ ë ¹ìí˜•': 'PUBLIC_RENTAL'
                };
                const unitTypeEn = unitTypeMap[data.unit_type] || 'YOUTH';

                const comprehensiveRequest = {
                    project_name: data.project_name,
                    address: data.address,
                    land_area: data.land_area,
                    gross_area: data.gross_area,
                    num_units: data.num_units,
                    num_floors: data.num_floors,
                    unit_type: unitTypeEn,  // ì˜ë¬¸ enum ê°’ ì‚¬ìš©
                    region: data.region,
                    land_price_per_sqm: landPricePerSqm,  // ã¡ë‹¹ ê°€ê²©ìœ¼ë¡œ ë³€í™˜
                    construction_duration_years: data.construction_duration_years
                };

                const comprehensiveResponse = await fetch('/api/business/analyze-comprehensive', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(comprehensiveRequest)
                });

                if (!comprehensiveResponse.ok) {
                    throw new Error('ì¢…í•© ë¶„ì„ API ì˜¤ë¥˜');
                }

                const comprehensiveResult = await comprehensiveResponse.json();

                // Step 2: ROI/IRR ìƒì„¸ ë¶„ì„
                loadingText.textContent = 'ROI/IRR ìƒì„¸ ë¶„ì„ ì¤‘...';
                loadingDetail.textContent = 'íˆ¬ììˆ˜ìµë¥ , ë‚´ë¶€ìˆ˜ìµë¥ , í˜„ê¸ˆíë¦„ (2/4)';

                const roiRequest = {
                    project_name: data.project_name,
                    land_acquisition_cost: landCost,
                    construction_cost: comprehensiveResult.construction_analysis.grand_total,
                    other_costs: data.other_costs,
                    lh_purchase_price: comprehensiveResult.purchase_analysis.total_purchase_price,
                    construction_duration_years: data.construction_duration_years
                };

                const roiResponse = await fetch('/api/business/analyze-roi', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(roiRequest)
                });

                if (!roiResponse.ok) {
                    throw new Error('ROI ë¶„ì„ API ì˜¤ë¥˜');
                }

                const roiResult = await roiResponse.json();

                // Step 3: AI í•´ì„¤ ìƒì„±
                loadingText.textContent = 'AI í•´ì„¤ ìƒì„± ì¤‘...';
                loadingDetail.textContent = 'Gemini AIê°€ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤ (3/4)';

                const aiInsights = await generateAIInsights(data, comprehensiveResult, roiResult);

                // Step 4: ê°œì„  ë°©ì•ˆ ìƒì„±
                loadingText.textContent = 'ë³´ê³ ì„œ ìƒì„± ì¤‘...';
                loadingDetail.textContent = 'ê°œì„  ë°©ì•ˆ ë° ìµœì¢… ë³´ê³ ì„œ ì‘ì„± (4/4)';

                const improvements = generateImprovements(comprehensiveResult, roiResult);

                // ë³´ê³ ì„œ ìƒì„±
                generateReport(data, comprehensiveResult, roiResult, improvements, aiInsights);

                // ì™„ë£Œ
                updateStep(4);
                loadingOverlay.classList.remove('active');

                // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                loadingOverlay.classList.remove('active');
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // AI í•´ì„¤ ìƒì„± í•¨ìˆ˜ (Gemini AI ì‹œë®¬ë ˆì´ì…˜)
        async function generateAIInsights(inputData, comprehensive, roi) {
            // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Gemini APIë¥¼ í˜¸ì¶œ
            // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ êµ¬í˜„

            const insights = {
                overall: generateOverallInsight(comprehensive, roi),
                construction: generateConstructionInsight(comprehensive),
                lh_purchase: generateLHInsight(comprehensive),
                roi: generateROIInsight(roi),
                cashflow: generateCashflowInsight(roi),
                improvements: generateImprovementInsight(comprehensive, roi),
                final: generateFinalInsight(comprehensive, roi)
            };

            return insights;
        }

        // ì¢…í•© í‰ê°€ AI í•´ì„¤
        function generateOverallInsight(comprehensive, roi) {
            const rating = comprehensive.overall_rating;
            const roiValue = roi.roi_percentage;
            const irrValue = roi.irr_percentage;

            let insight = '';

            if (rating === 'excellent') {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” íˆ¬ììˆ˜ìµë¥ (ROI) ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥ (IRR) ${irrValue.toFixed(2)}%ë¡œ "ìš°ìˆ˜" ë“±ê¸‰ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. `;
                insight += `ì´ëŠ” LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ì‚¬ì—…ì˜ í‰ê·  ìˆ˜ìµë¥ ì„ í¬ê²Œ ìƒíšŒí•˜ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ, ë†’ì€ ì‚¬ì—…ì„±ì„ ê°–ì¶˜ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. `;
                insight += `íŠ¹íˆ IRRì´ ${irrValue.toFixed(2)}%ë¡œ ì‹œì¥ ì´ììœ¨ì„ ì¶©ë¶„íˆ ì´ˆê³¼í•˜ì—¬ íˆ¬ì ë§¤ë ¥ë„ê°€ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. `;
                insight += `ì•ˆì •ì ì¸ LH ë§¤ì…ì´ ë³´ì¥ë˜ë¯€ë¡œ ë¦¬ìŠ¤í¬ê°€ ë‚®ìœ¼ë©°, ì¶”ì²œí•  ë§Œí•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.`;
            } else if (rating === 'good') {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” íˆ¬ììˆ˜ìµë¥ (ROI) ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥ (IRR) ${irrValue.toFixed(2)}%ë¡œ "ì–‘í˜¸" ë“±ê¸‰ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. `;
                insight += `LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ì‚¬ì—…ìœ¼ë¡œì„œ ì ì • ìˆ˜ì¤€ì˜ ìˆ˜ìµì„±ì„ í™•ë³´í•˜ê³  ìˆìœ¼ë©°, ì•ˆì •ì ì¸ ì‚¬ì—… ì¶”ì§„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. `;
                insight += `ë‹¤ë§Œ, ê±´ì¶•ë¹„ ìµœì í™”ë‚˜ í† ì§€ë¹„ ì ˆê° ë“±ì˜ ê°œì„  ë°©ì•ˆì„ í†µí•´ ìˆ˜ìµì„±ì„ ë”ìš± í–¥ìƒì‹œí‚¬ ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤. `;
                insight += `ì „ë°˜ì ìœ¼ë¡œ ê¸ì •ì ì¸ ì‚¬ì—…ì„±ì„ ë³´ìœ í•˜ê³  ìˆì–´ ì¶”ì§„ì„ ê³ ë ¤í•  ë§Œí•©ë‹ˆë‹¤.`;
            } else if (rating === 'fair') {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” íˆ¬ììˆ˜ìµë¥ (ROI) ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥ (IRR) ${irrValue.toFixed(2)}%ë¡œ "ë³´í†µ" ë“±ê¸‰ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. `;
                insight += `ìµœì†Œí•œì˜ ìˆ˜ìµì„±ì€ í™•ë³´ë˜ì–´ ìˆìœ¼ë‚˜, ì‹œì¥ í‰ê·  ëŒ€ë¹„ ë‹¤ì†Œ ë‚®ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤. `;
                insight += `í† ì§€ë¹„ ë¶€ë‹´ì´ í¬ê±°ë‚˜ ê±´ì¶•ë¹„ê°€ ë†’ì€ ê²ƒìœ¼ë¡œ ë³´ì´ë©°, ì‚¬ì—… êµ¬ì¡° ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤. `;
                insight += `ì œì‹œëœ ê°œì„  ë°©ì•ˆë“¤ì„ ì ê·¹ì ìœ¼ë¡œ ê²€í† í•˜ì—¬ ì‚¬ì—…ì„±ì„ ì œê³ í•œ í›„ ì¶”ì§„í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” íˆ¬ììˆ˜ìµë¥ (ROI) ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥ (IRR) ${irrValue.toFixed(2)}%ë¡œ "ë¯¸í¡" ë“±ê¸‰ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. `;
                insight += `í˜„ì¬ êµ¬ì¡°ë¡œëŠ” ì¶©ë¶„í•œ ìˆ˜ìµì„±ì„ í™•ë³´í•˜ê¸° ì–´ë ¤ìš°ë©°, ì‚¬ì—… ì¶”ì§„ì— ì‹ ì¤‘ì„ ê¸°í•´ì•¼ í•©ë‹ˆë‹¤. `;
                insight += `í† ì§€ë¹„, ê±´ì¶•ë¹„, ì‚¬ì—… ê¸°ê°„ ë“± ì£¼ìš” ë³€ìˆ˜ë“¤ì— ëŒ€í•œ ì „ë©´ì ì¸ ì¬ê²€í† ê°€ í•„ìš”í•˜ë©°, `;
                insight += `ê·¼ë³¸ì ì¸ ì‚¬ì—… êµ¬ì¡° ê°œì„  ì—†ì´ëŠ” ì¶”ì§„ì„ ë³´ë¥˜í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤.`;
            }

            return insight;
        }

        // ê±´ì¶•ë¹„ ë¶„ì„ AI í•´ì„¤
        function generateConstructionInsight(comprehensive) {
            const costPerPyeong = comprehensive.construction_analysis.cost_per_pyeong;
            const region = comprehensive.construction_analysis.region;
            const multiplier = comprehensive.construction_analysis.regional_multiplier;

            let insight = `ê±´ì¶•ë¹„ëŠ” í‰ë‹¹ ${costPerPyeong.toLocaleString()}ì›ìœ¼ë¡œ ì‚°ì •ë˜ì—ˆìŠµë‹ˆë‹¤. `;
            
            if (region === 'ì„œìš¸') {
                insight += `ì„œìš¸ ì§€ì—­ì˜ ê²½ìš° ì§€ì—­ ê°€ì¤‘ì¹˜ ${multiplier}ë°°ê°€ ì ìš©ë˜ì–´ ë‹¤ë¥¸ ì§€ì—­ ëŒ€ë¹„ 20% ë†’ì€ ê±´ì¶•ë¹„ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. `;
                insight += `ì´ëŠ” ì„œìš¸ ì§€ì—­ì˜ ë†’ì€ ì¸ê±´ë¹„, ìì¬ë¹„, ì¥ë¹„ ì„ëŒ€ë£Œ ë“±ì„ ê³ ë ¤í•œ ê²ƒì…ë‹ˆë‹¤. `;
            } else if (region === 'ê²½ê¸°') {
                insight += `ê²½ê¸° ì§€ì—­ì˜ ê²½ìš° ì§€ì—­ ê°€ì¤‘ì¹˜ ${multiplier}ë°°ê°€ ì ìš©ë˜ì–´ ìˆ˜ë„ê¶Œ íŠ¹ì„±ì´ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. `;
                insight += `ì„œìš¸ ëŒ€ë¹„ ì•½ê°„ ë‚®ìœ¼ë‚˜ ì—¬ì „íˆ ì „êµ­ í‰ê· ë³´ë‹¤ëŠ” ë†’ì€ ìˆ˜ì¤€ì…ë‹ˆë‹¤. `;
            } else {
                insight += `ê¸°íƒ€ ì§€ì—­ì˜ ê²½ìš° í‘œì¤€ ê±´ì¶•ë¹„ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. `;
            }

            if (costPerPyeong > 1500000) {
                insight += `í‰ë‹¹ ê±´ì¶•ë¹„ê°€ 150ë§Œì›ì„ ì´ˆê³¼í•˜ì—¬ ë‹¤ì†Œ ë†’ì€ í¸ì´ë¯€ë¡œ, VE(Value Engineering) ê¸°ë²•ì„ í™œìš©í•œ ë¹„ìš© ì ˆê°ì„ ê²€í† í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`;
            } else if (costPerPyeong > 1300000) {
                insight += `í‰ë‹¹ ê±´ì¶•ë¹„ê°€ ì ì • ë²”ìœ„ ë‚´ì— ìˆìœ¼ë‚˜, ì„¤ê³„ ìµœì í™”ë¥¼ í†µí•œ ì¶”ê°€ ì ˆê° ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.`;
            } else {
                insight += `í‰ë‹¹ ê±´ì¶•ë¹„ê°€ í•©ë¦¬ì ì¸ ìˆ˜ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.`;
            }

            return insight;
        }

        // LH ë§¤ì… ë¶„ì„ AI í•´ì„¤
        function generateLHInsight(comprehensive) {
            const lhAnalysis = comprehensive.purchase_analysis;
            const isEligible = lhAnalysis.is_eligible;
            const purchasePrice = lhAnalysis.estimated_purchase_price;

            let insight = '';

            if (isEligible) {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ ë§¤ì… ìê²©ì„ ì¶©ì¡±í•©ë‹ˆë‹¤. `;
                insight += `ì˜ˆìƒ ë§¤ì…ê°€ëŠ” ${(purchasePrice / 100000000).toFixed(1)}ì–µì›ìœ¼ë¡œ ì‚°ì •ë˜ì—ˆìœ¼ë©°, `;
                insight += `ì´ëŠ” ê°ì •í‰ê°€ì•¡ ëŒ€ë¹„ LH ê¸°ì¤€ ë§¤ì…ê°€ë¥¼ ì ìš©í•œ ê²°ê³¼ì…ë‹ˆë‹¤. `;
                insight += `ì„¸ëŒ€ ê·œëª¨, ì„¸ëŒ€ìˆ˜, ìš©ë„ ë“±ì´ ëª¨ë‘ LH ê¸°ì¤€ì„ ì¶©ì¡±í•˜ë¯€ë¡œ ì•ˆì •ì ì¸ ë§¤ì…ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤. `;
                insight += `ë‹¤ë§Œ, ìµœì¢… ë§¤ì…ê°€ëŠ” ì¤€ê³µ í›„ ê°ì •í‰ê°€ë¥¼ í†µí•´ ê²°ì •ë˜ë¯€ë¡œ, `;
                insight += `ì‹œê³µ í’ˆì§ˆ ê´€ë¦¬ì™€ ë§ˆê°ì¬ ì„ ì •ì— ìœ ì˜í•˜ì—¬ ê°ì •ê°€ë¥¼ ìµœëŒ€í™”í•˜ëŠ” ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.`;
            } else {
                insight = `ë³¸ í”„ë¡œì íŠ¸ëŠ” LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ ë§¤ì… ìê²© ìš”ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í•©ë‹ˆë‹¤. `;
                insight += `${lhAnalysis.eligibility_notes}. `;
                insight += `LH ë§¤ì…ì„ ë°›ê¸° ìœ„í•´ì„œëŠ” ìê²© ìš”ê±´ì„ ì¶©ì¡±í•˜ë„ë¡ ì‚¬ì—… ê³„íšì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤. `;
                insight += `ì„¸ëŒ€ ë©´ì , ì„¸ëŒ€ìˆ˜, ìš©ë„ ë“±ì„ ì¬ê²€í† í•˜ì—¬ LH ê¸°ì¤€ì— ë§ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. `;
                insight += `ìê²© ìš”ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í•  ê²½ìš° ì¼ë°˜ ë¶„ì–‘ìœ¼ë¡œ ì „í™˜í•´ì•¼ í•˜ë¯€ë¡œ íŒë§¤ ë¦¬ìŠ¤í¬ê°€ ì¦ê°€í•©ë‹ˆë‹¤.`;
            }

            return insight;
        }

        // ROI ë¶„ì„ AI í•´ì„¤
        function generateROIInsight(roi) {
            const roiValue = roi.roi_percentage;
            const irrValue = roi.irr_percentage;
            const npv = roi.npv;
            const payback = roi.payback_period_years;

            let insight = `íˆ¬ììˆ˜ìµë¥ (ROI)ì€ ${roiValue.toFixed(2)}%ë¡œ, `;
            
            if (roiValue >= 12) {
                insight += `ë§¤ìš° ìš°ìˆ˜í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ì´ëŠ” íˆ¬ì ì›ê¸ˆ ëŒ€ë¹„ ${roiValue.toFixed(0)}% ì´ìƒì˜ ìˆ˜ìµì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•˜ë©°, `;
                insight += `ë¶€ë™ì‚° ê°œë°œ ì‚¬ì—…ìœ¼ë¡œì„œ ë†’ì€ íˆ¬ì ë§¤ë ¥ë„ë¥¼ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤. `;
            } else if (roiValue >= 8) {
                insight += `ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ì‚¬ì—…ì˜ í‰ê· ì ì¸ ìˆ˜ìµë¥  ë²”ìœ„ì— í•´ë‹¹í•˜ë©°, `;
                insight += `ì•ˆì •ì ì¸ ìˆ˜ìµ ì°½ì¶œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. `;
            } else if (roiValue >= 5) {
                insight += `ìµœì†Œ ìˆ˜ìµ ê¸°ì¤€ì€ ì¶©ì¡±í•˜ë‚˜ ë‹¤ì†Œ ë‚®ì€ í¸ì…ë‹ˆë‹¤. `;
                insight += `ê°œì„  ë°©ì•ˆì„ í†µí•´ ìˆ˜ìµì„±ì„ ë†’ì¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. `;
            } else {
                insight += `ë‚®ì€ ìˆ˜ì¤€ìœ¼ë¡œ, ì‚¬ì—… ì¶”ì§„ì— ì‹ ì¤‘ì„ ê¸°í•´ì•¼ í•©ë‹ˆë‹¤. `;
            }

            insight += `\n\në‚´ë¶€ìˆ˜ìµë¥ (IRR)ì€ ${irrValue.toFixed(2)}%ë¡œ, `;
            
            if (irrValue >= 10) {
                insight += `ì‹œì¥ ì´ììœ¨ì„ í¬ê²Œ ìƒíšŒí•˜ëŠ” ìš°ìˆ˜í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤. `;
                insight += `ì‹œê°„ê°€ì¹˜ë¥¼ ê³ ë ¤í•  ë•Œ ë§¤ìš° ë§¤ë ¥ì ì¸ íˆ¬ì ê¸°íšŒì…ë‹ˆë‹¤. `;
            } else if (irrValue >= 7) {
                insight += `ì ì • ìˆ˜ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤. ê¸°íšŒë¹„ìš©ì„ ê°ì•ˆí•  ë•Œ íˆ¬ì ê°€ì¹˜ê°€ ìˆìŠµë‹ˆë‹¤. `;
            } else {
                insight += `ë‚®ì€ í¸ìœ¼ë¡œ, ë‹¤ë¥¸ íˆ¬ì ëŒ€ì•ˆ ëŒ€ë¹„ ë§¤ë ¥ë„ê°€ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `;
            }

            insight += `\n\nìˆœí˜„ì¬ê°€ì¹˜(NPV)ëŠ” ${(npv / 100000000).toFixed(2)}ì–µì›ìœ¼ë¡œ, `;
            insight += npv > 0 ? 
                `ê¸ì •ì ì¸ ê°’ì„ ë‚˜íƒ€ë‚´ì–´ íˆ¬ì ê°€ì¹˜ê°€ ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ` :
                `ë¶€ì •ì ì¸ ê°’ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ íˆ¬ì ê°€ì¹˜ì— ëŒ€í•œ ì¬ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤. `;

            insight += `íšŒìˆ˜ ê¸°ê°„ì€ ì•½ ${payback.toFixed(1)}ë…„ìœ¼ë¡œ, `;
            insight += payback <= 3 ? 
                `ë¹ ë¥¸ ìê¸ˆ íšŒìˆ˜ê°€ ê°€ëŠ¥í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.` :
                `ë‹¤ì†Œ ê¸´ í¸ì´ë¯€ë¡œ ìê¸ˆ ì¡°ë‹¬ ê³„íšì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.`;

            return insight;
        }

        // í˜„ê¸ˆíë¦„ ë¶„ì„ AI í•´ì„¤
        function generateCashflowInsight(roi) {
            const cashFlows = roi.cash_flows;
            const totalInvestment = roi.total_investment;
            const netProfit = roi.net_profit;

            let insight = `í˜„ê¸ˆíë¦„ ë¶„ì„ ê²°ê³¼, ì‚¬ì—… ê¸°ê°„ ë™ì•ˆ ì´ ${(totalInvestment / 100000000).toFixed(1)}ì–µì›ì˜ íˆ¬ìê°€ í•„ìš”í•©ë‹ˆë‹¤. `;
            insight += `ì´ˆê¸°ì—ëŠ” í† ì§€ ë§¤ì…ë¹„ì™€ ê¸°íƒ€ ë¹„ìš©ìœ¼ë¡œ í° ìœ ì¶œì´ ë°œìƒí•˜ë©°, `;
            insight += `ê³µì‚¬ ê¸°ê°„ ë™ì•ˆ ê±´ì¶•ë¹„ê°€ ë‹¨ê³„ì ìœ¼ë¡œ íˆ¬ì…ë©ë‹ˆë‹¤. `;
            insight += `ì¤€ê³µ ë° LH ë§¤ì… ì‹œì ì— ë§¤ì…ëŒ€ê¸ˆì´ ì¼ì‹œì— ìœ ì…ë˜ì–´ ëˆ„ì  í˜„ê¸ˆíë¦„ì´ ì–‘(+)ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.\n\n`;

            const maxNegativeCashflow = Math.min(...cashFlows.map(cf => cf.cumulative));
            insight += `ì‚¬ì—… ê¸°ê°„ ì¤‘ ìµœëŒ€ ëˆ„ì  ìœ ì¶œì•¡ì€ ì•½ ${(Math.abs(maxNegativeCashflow) / 100000000).toFixed(1)}ì–µì›ìœ¼ë¡œ, `;
            insight += `ì´ëŠ” ìê¸°ìë³¸ê³¼ ëŒ€ì¶œì„ í†µí•´ ì¡°ë‹¬í•´ì•¼ í•˜ëŠ” ìµœëŒ€ ì†Œìš” ìê¸ˆì…ë‹ˆë‹¤. `;
            insight += `ê¸ˆìœµ ë¹„ìš© ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•´ í† ì§€ ë§¤ì… ì‹œ LH í† ì§€ì„ëŒ€ë¶€ ë°©ì‹ì´ë‚˜ PF(Project Financing) í™œìš©ì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n`;

            insight += `ìµœì¢…ì ìœ¼ë¡œ ì•½ ${(netProfit / 100000000).toFixed(1)}ì–µì›ì˜ ìˆœì´ìµì´ ì˜ˆìƒë˜ë©°, `;
            insight += `ì´ëŠ” ì´ íˆ¬ì ëŒ€ë¹„ ${roi.roi_percentage.toFixed(2)}%ì˜ ìˆ˜ìµë¥ ì— í•´ë‹¹í•©ë‹ˆë‹¤. `;
            insight += `ì•ˆì •ì ì¸ í˜„ê¸ˆíë¦„ ê´€ë¦¬ë¥¼ ìœ„í•´ ê° ë‹¨ê³„ë³„ ìê¸ˆ ì¡°ë‹¬ ê³„íšì„ ë©´ë°€íˆ ìˆ˜ë¦½í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`;

            return insight;
        }

        // ê°œì„  ë°©ì•ˆ AI í•´ì„¤
        function generateImprovementInsight(comprehensive, roi) {
            let insight = `ì‚¬ì—…ì„±ì„ ë”ìš± í–¥ìƒì‹œí‚¤ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ê°œì„  ë°©ì•ˆì´ ë„ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n`;

            if (roi.roi_percentage < 8) {
                insight += `**ìˆ˜ìµì„± ê°œì„ ì´ ìš°ì„ ì ìœ¼ë¡œ í•„ìš”í•©ë‹ˆë‹¤.** `;
                insight += `í† ì§€ë¹„ ë¶€ë‹´ì´ í° ê²½ìš° ê³µê³µ í† ì§€ í™œìš©, ì§€ë¶„ ì°¸ì—¬ êµ¬ì¡°, ë˜ëŠ” í† ì§€ì„ëŒ€ë¶€ ë°©ì‹ì„ ê²€í† í•˜ì—¬ `;
                insight += `ì´ˆê¸° íˆ¬ì ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `;
            }

            if (roi.irr_percentage < 7) {
                insight += `**ê³µì‚¬ ê¸°ê°„ ë‹¨ì¶•**ì„ í†µí•´ IRRì„ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `;
                insight += `PC(Precast Concrete) ê³µë²•ì´ë‚˜ ëª¨ë“ˆëŸ¬ ê³µë²• ë“± ê³µê¸° ë‹¨ì¶• ê³µë²•ì„ ì ìš©í•˜ë©´ `;
                insight += `ê¸ˆìœµ ë¹„ìš© ì ˆê°ê³¼ í•¨ê»˜ IRR 0.5~1% ê°œì„ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. `;
            }

            const costPerPyeong = comprehensive.construction_analysis.cost_per_pyeong;
            if (costPerPyeong > 1400000) {
                insight += `**ê±´ì¶•ë¹„ ìµœì í™”**ë„ ì¤‘ìš”í•œ ê³¼ì œì…ë‹ˆë‹¤. `;
                insight += `VE(Value Engineering) ê¸°ë²•ì„ í™œìš©í•œ ì„¤ê³„ ìµœì í™”, ìì¬ ëŒ€ì²´, ê³µë²• ê°œì„  ë“±ì„ í†µí•´ `;
                insight += `í’ˆì§ˆ ì €í•˜ ì—†ì´ ì´ ì‚¬ì—…ë¹„ì˜ 5~10%ë¥¼ ì ˆê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `;
            }

            insight += `\n\në˜í•œ **ì„¸ëŒ€ìˆ˜ ìµœì í™”, ì„¤ê³„ íš¨ìœ¨í™”, ì¬ë¬´ êµ¬ì¡° ê°œì„ ** ë“± ë‹¤ê°ë„ì˜ ì ‘ê·¼ì´ í•„ìš”í•˜ë©°, `;
            insight += `ê° ê°œì„  ë°©ì•ˆì˜ ìš°ì„ ìˆœìœ„ì™€ ê¸°ëŒ€ íš¨ê³¼ë¥¼ ê³ ë ¤í•˜ì—¬ ë‹¨ê³„ì ìœ¼ë¡œ ì ìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. `;
            insight += `íŠ¹íˆ ì •ì±… ê¸ˆìœµ í™œìš©, ì›ê°€ ì ˆê°, ì¸í—ˆê°€ ê¸°ê°„ ë‹¨ì¶• ë“±ì€ ì‚¬ì—…ì„±ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ `;
            insight += `ì´ˆê¸° ê¸°íš ë‹¨ê³„ë¶€í„° ì „ë¬¸ê°€ì™€ í˜‘ë ¥í•˜ì—¬ ì¶”ì§„í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì…ë‹ˆë‹¤.`;

            return insight;
        }

        // ìµœì¢… ê²°ë¡  AI í•´ì„¤
        function generateFinalInsight(comprehensive, roi) {
            const rating = comprehensive.overall_rating;
            const roiValue = roi.roi_percentage;
            const irrValue = roi.irr_percentage;
            const isEligible = comprehensive.purchase_analysis.is_eligible;
            const payback = roi.payback_period_years;

            let conclusion = `ë³¸ LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ì‚¬ì—… íƒ€ë‹¹ì„± ë¶„ì„ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ë©´, `;

            if (rating === 'excellent') {
                conclusion += `ë³¸ í”„ë¡œì íŠ¸ëŠ” **"ìš°ìˆ˜"** ë“±ê¸‰ìœ¼ë¡œ í‰ê°€ë˜ì–´ **ì ê·¹ ì¶”ì§„ì„ ê¶Œì¥**í•©ë‹ˆë‹¤. `;
                conclusion += `íˆ¬ììˆ˜ìµë¥  ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥  ${irrValue.toFixed(2)}%ì˜ ë†’ì€ ìˆ˜ìµì„±ê³¼ `;
                conclusion += `ì•ˆì •ì ì¸ LH ë§¤ì… ë³´ì¥ìœ¼ë¡œ ë¦¬ìŠ¤í¬ê°€ ë‚®ì€ ìš°ëŸ‰ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. `;
                conclusion += `ì œì‹œëœ ê°œì„  ë°©ì•ˆì„ ì ìš©í•˜ë©´ ë”ìš± ë†’ì€ ìˆ˜ìµì„± ë‹¬ì„±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
            } else if (rating === 'good') {
                conclusion += `ë³¸ í”„ë¡œì íŠ¸ëŠ” **"ì–‘í˜¸"** ë“±ê¸‰ìœ¼ë¡œ í‰ê°€ë˜ì–´ **ì¶”ì§„ì„ ê³ ë ¤í•  ë§Œ**í•©ë‹ˆë‹¤. `;
                conclusion += `íˆ¬ììˆ˜ìµë¥  ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥  ${irrValue.toFixed(2)}%ë¡œ ì ì • ìˆ˜ìµì„±ì„ í™•ë³´í•˜ê³  ìˆìœ¼ë©°, `;
                conclusion += `${isEligible ? 'LH ë§¤ì… ìê²©ì„ ì¶©ì¡±í•˜ì—¬' : 'LH ê¸°ì¤€ ì¶©ì¡± ì‹œ'} ì•ˆì •ì ì¸ ì‚¬ì—… ì¶”ì§„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. `;
                conclusion += `ì œì‹œëœ ê°œì„  ë°©ì•ˆì„ ê²€í† í•˜ì—¬ ìˆ˜ìµì„±ì„ ë”ìš± í–¥ìƒì‹œí‚¤ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.`;
            } else if (rating === 'fair') {
                conclusion += `ë³¸ í”„ë¡œì íŠ¸ëŠ” **"ë³´í†µ"** ë“±ê¸‰ìœ¼ë¡œ í‰ê°€ë˜ì–´ **ì‹ ì¤‘í•œ ê²€í† ê°€ í•„ìš”**í•©ë‹ˆë‹¤. `;
                conclusion += `íˆ¬ììˆ˜ìµë¥  ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥  ${irrValue.toFixed(2)}%ë¡œ ìµœì†Œ ìˆ˜ìµì„±ì€ í™•ë³´ë˜ë‚˜, `;
                conclusion += `ê°œì„  ì—¬ì§€ê°€ í½ë‹ˆë‹¤. í† ì§€ë¹„, ê±´ì¶•ë¹„, ê³µì‚¬ ê¸°ê°„ ë“± í•µì‹¬ ë³€ìˆ˜ë“¤ì— ëŒ€í•œ ê°œì„ ì•ˆì„ ì ìš©í•œ í›„ `;
                conclusion += `ì¬ë¶„ì„ì„ í†µí•´ ì‚¬ì—…ì„±ì„ ì¬í™•ì¸í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤.`;
            } else {
                conclusion += `ë³¸ í”„ë¡œì íŠ¸ëŠ” **"ë¯¸í¡"** ë“±ê¸‰ìœ¼ë¡œ í‰ê°€ë˜ì–´ **í˜„ êµ¬ì¡°ë¡œì˜ ì¶”ì§„ì€ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. `;
                conclusion += `íˆ¬ììˆ˜ìµë¥  ${roiValue.toFixed(2)}%, ë‚´ë¶€ìˆ˜ìµë¥  ${irrValue.toFixed(2)}%ë¡œ ì¶©ë¶„í•œ ìˆ˜ìµì„±ì„ í™•ë³´í•˜ê¸° ì–´ë ¤ìš°ë©°, `;
                conclusion += `ì‚¬ì—… êµ¬ì¡° ì „ë°˜ì— ëŒ€í•œ ê·¼ë³¸ì ì¸ ì¬ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤. `;
                conclusion += `í† ì§€ë¹„ ì ˆê°, ê±´ì¶•ë¹„ ìµœì í™”, ì‚¬ì—… ê¸°ê°„ ë‹¨ì¶• ë“± í•µì‹¬ ê°œì„  ë°©ì•ˆì„ ì „ë©´ ì ìš©í•œ í›„ `;
                conclusion += `ì‚¬ì—…ì„±ì„ ì¬í‰ê°€í•˜ì—¬ ì¶”ì§„ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.`;
            }

            conclusion += `\n\n**ì£¼ìš” ì¬ë¬´ ì§€í‘œ:**\n`;
            conclusion += `â€¢ ROI: ${roiValue.toFixed(2)}%\n`;
            conclusion += `â€¢ IRR: ${irrValue.toFixed(2)}%\n`;
            conclusion += `â€¢ NPV: ${(roi.npv / 100000000).toFixed(2)}ì–µì›\n`;
            conclusion += `â€¢ íšŒìˆ˜ ê¸°ê°„: ${payback.toFixed(1)}ë…„\n`;
            conclusion += `â€¢ LH ë§¤ì… ìê²©: ${isEligible ? 'ì¶©ì¡± âœ…' : 'ë¯¸ì¶©ì¡± âŒ'}\n\n`;

            conclusion += `ìƒê¸° ë¶„ì„ì€ ì…ë ¥ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ì´ë©°, `;
            conclusion += `ì‹¤ì œ ì‚¬ì—… ì¶”ì§„ ì‹œì—ëŠ” ì‹œì¥ ìƒí™©, ê¸ˆë¦¬ ë³€ë™, ì •ì±… ë³€í™” ë“± ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ê³ ë ¤í•˜ì—¬ `;
            conclusion += `ì „ë¬¸ê°€ì˜ ìƒì„¸í•œ ê²€í† ë¥¼ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.`;

            return conclusion;
        }

        // ê°œì„  ë°©ì•ˆ ìƒì„± í•¨ìˆ˜
        function generateImprovements(comprehensive, roi) {
            const improvements = [];
            const roiValue = roi.roi_percentage;
            const irrValue = roi.irr_percentage;
            const costPerPyeong = comprehensive.construction_analysis.cost_per_pyeong;

            // í† ì§€ë¹„ ì ˆê° (ROIê°€ 8% ë¯¸ë§Œì¸ ê²½ìš°)
            if (roiValue < 8) {
                improvements.push({
                    priority: 'high',
                    category: 'ìˆ˜ìµì„± ê°œì„ ',
                    title: 'í† ì§€ë¹„ ì ˆê° ë°©ì•ˆ',
                    description: 'ê³µê³µ í† ì§€ í™œìš©, LH í† ì§€ì„ëŒ€ë¶€ ë°©ì‹, ë˜ëŠ” ì§€ë¶„ ì°¸ì—¬ êµ¬ì¡°ë¥¼ ê²€í† í•˜ì—¬ ì´ˆê¸° í† ì§€ íˆ¬ì ë¶€ë‹´ì„ ì¤„ì…ë‹ˆë‹¤. í˜‘ìƒ ì „ëµì„ í†µí•´ í† ì§€ ë§¤ì…ê°€ë¥¼ 5~10% ì¸í•˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    expected_impact: 'ROI 1~2% ì¦ê°€ ì˜ˆìƒ',
                    considerations: ['ì •ì±… ê¸ˆìœµ', 'ì›ê°€ ì ˆê°']
                });
            }

            // IRR ê°œì„  (IRRì´ 7% ë¯¸ë§Œì¸ ê²½ìš°)
            if (irrValue < 7) {
                improvements.push({
                    priority: 'high',
                    category: 'ì¼ì • ê´€ë¦¬',
                    title: 'ê³µì‚¬ ê¸°ê°„ ë‹¨ì¶•',
                    description: 'PC(Precast Concrete) ê³µë²•, ëª¨ë“ˆëŸ¬ ê³µë²• ë“± ê³µê¸° ë‹¨ì¶• ê³µë²•ì„ ì ìš©í•˜ì—¬ ê±´ì„¤ ê¸°ê°„ì„ 6~12ê°œì›” ë‹¨ì¶•í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê¸ˆìœµ ë¹„ìš©ì„ ì ˆê°í•˜ê³  IRRì„ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    expected_impact: 'IRR 0.5~1% ê°œì„  ì˜ˆìƒ',
                    considerations: ['ì›ê°€ ì ˆê°', 'ì¸í—ˆê°€ ë‹¨ì¶•']
                });
            }

            // ê±´ì¶•ë¹„ ìµœì í™” (í‰ë‹¹ 140ë§Œì› ì´ˆê³¼ ì‹œ)
            if (costPerPyeong > 1400000) {
                improvements.push({
                    priority: 'medium',
                    category: 'ë¹„ìš© ìµœì í™”',
                    title: 'ê±´ì¶•ë¹„ ìµœì í™”',
                    description: 'VE(Value Engineering) ê¸°ë²•ì„ í™œìš©í•˜ì—¬ ì„¤ê³„ë¥¼ ìµœì í™”í•˜ê³ , ìì¬ ì„ íƒê³¼ ì‹œê³µì‚¬ ì„ ì •ì„ í†µí•´ ê±´ì¶•ë¹„ë¥¼ ì ˆê°í•©ë‹ˆë‹¤. í’ˆì§ˆ ì €í•˜ ì—†ì´ 5~10% ë¹„ìš© ì ˆê°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    expected_impact: 'ì´ ì‚¬ì—…ë¹„ 5~10% ì ˆê° ê°€ëŠ¥',
                    considerations: ['ì›ê°€ ì ˆê°', 'ì„¸ë¬´ ìµœì í™”']
                });
            }

            // ê¸°ë³¸ ê°œì„  ë°©ì•ˆ (í•­ìƒ í¬í•¨)
            improvements.push({
                priority: 'medium',
                category: 'ê·œëª¨ ìµœì í™”',
                title: 'ì„¸ëŒ€ìˆ˜ ìµœì í™”',
                description: 'ì„¸ëŒ€ë‹¹ ë©´ì ê³¼ ì „ì²´ ì„¸ëŒ€ìˆ˜ì˜ ìµœì  ì¡°í•©ì„ ì°¾ì•„ ê±´ì¶•ë¹„ ëŒ€ë¹„ LH ë§¤ì…ê°€ë¥¼ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤. ì „ìš©ë©´ì  í™œìš©ë¥ ì„ ë†’ì´ê³  ê³µìš©ë©´ì  ë¹„ìœ¨ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.',
                expected_impact: 'ì‚¬ì—…ì„± ê· í˜• ê°œì„ ',
                considerations: ['ì¸í—ˆê°€ ë‹¨ì¶•', 'ë§ˆì¼€íŒ…']
            });

            improvements.push({
                priority: 'low',
                category: 'ì„¤ê³„ ìµœì í™”',
                title: 'ì„¤ê³„ íš¨ìœ¨í™”',
                description: 'í‰ë©´ ê³„íš ìµœì í™”, êµ¬ì¡° ì‹œìŠ¤í…œ í•©ë¦¬í™”, ì„¤ë¹„ ì‹œìŠ¤í…œ í†µí•© ë“±ì„ í†µí•´ ê±´ì¶• íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤. íŠ¹íˆ ì½”ì–´ ë°°ì¹˜ì™€ ë™ì„  ê³„íšì„ ê°œì„ í•˜ì—¬ ê³µìš©ë©´ì ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.',
                expected_impact: 'ê±´ì¶•ë¹„ 3~5% ì ˆê°',
                considerations: ['ì›ê°€ ì ˆê°', 'ì¸í—ˆê°€ ë‹¨ì¶•']
            });

            improvements.push({
                priority: 'low',
                category: 'ê¸ˆìœµ ì „ëµ',
                title: 'ì¬ë¬´ êµ¬ì¡° ìµœì í™”',
                description: 'HUG ë³´ì¦, ì£¼íƒë„ì‹œê¸°ê¸ˆ ë“± ì •ì±… ê¸ˆìœµì„ ì ê·¹ í™œìš©í•˜ì—¬ ê¸ˆìœµ ë¹„ìš©ì„ ì ˆê°í•©ë‹ˆë‹¤. ì ì • LTV(ë‹´ë³´ì¸ì •ë¹„ìœ¨)ë¥¼ ìœ ì§€í•˜ë©´ì„œ ìê¸°ìë³¸ ë¶€ë‹´ì„ ìµœì†Œí™”í•˜ëŠ” ìë³¸ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤.',
                expected_impact: 'ê¸ˆìœµë¹„ìš© 10~20% ì ˆê°, ìê¸°ìë³¸ ë¶€ë‹´ ê²½ê°',
                considerations: ['ì •ì±… ê¸ˆìœµ', 'ì„¸ë¬´ ìµœì í™”']
            });

            return improvements;
        }

        // ë³´ê³ ì„œ ìƒì„± í•¨ìˆ˜
        function generateReport(inputData, comprehensive, roi, improvements, aiInsights) {
            const resultsDiv = document.getElementById('results');
            
            // í•„ìš”í•œ ê°’ë“¤ ê³„ì‚° (ROI APIì—ì„œ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ê°’ë“¤)
            const landPyeong = inputData.land_area / 3.3058;
            const landCost = landPyeong * inputData.land_price_per_pyeong;
            const constructionCost = comprehensive.construction_analysis.grand_total;
            const otherCosts = inputData.other_costs || 0;
            const lhPurchasePrice = comprehensive.purchase_analysis.total_purchase_price;
            
            // í˜„ê¸ˆíë¦„ ë°ì´í„° ë³€í™˜ (API í˜•ì‹ â†’ ë³´ê³ ì„œ í˜•ì‹)
            const cashFlows = [];
            let cumulative = 0;
            for (const cf of roi.cash_flows) {
                const inflow = cf.amount > 0 ? cf.amount : 0;
                const outflow = cf.amount < 0 ? Math.abs(cf.amount) : 0;
                const net = cf.amount;
                cumulative += net;
                
                cashFlows.push({
                    year: cf.year,
                    inflow,
                    outflow,
                    net,
                    cumulative,
                    description: cf.description
                });
            }
            
            const html = `
                <!-- 1. í”„ë¡œì íŠ¸ ê°œìš” -->
                <div class="report-section">
                    <h2>ğŸ“‹ 1. í”„ë¡œì íŠ¸ ê°œìš”</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="label">í”„ë¡œì íŠ¸ëª…</div>
                            <div class="value" style="font-size: 1.1em;">${inputData.project_name}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ìœ„ì¹˜</div>
                            <div class="value" style="font-size: 0.95em;">${inputData.address}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì„¸ëŒ€ ìœ í˜•</div>
                            <div class="value" style="font-size: 1.1em;">${inputData.unit_type}</div>
                        </div>
                    </div>
                    
                    <h3>ğŸ“Š ê·œëª¨</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="label">í† ì§€ ë©´ì </div>
                            <div class="value">${formatNumber(inputData.land_area)}</div>
                            <div class="unit">ã¡ (${(inputData.land_area / 3.3058).toFixed(1)}í‰)</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì—°ë©´ì </div>
                            <div class="value">${formatNumber(inputData.gross_area)}</div>
                            <div class="unit">ã¡ (${(inputData.gross_area / 3.3058).toFixed(1)}í‰)</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì„¸ëŒ€ìˆ˜</div>
                            <div class="value">${inputData.num_units}</div>
                            <div class="unit">ì„¸ëŒ€</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì¸µìˆ˜</div>
                            <div class="value">${inputData.num_floors}</div>
                            <div class="unit">ì¸µ</div>
                        </div>
                    </div>
                </div>

                <!-- 2. ì¢…í•© í‰ê°€ -->
                <div class="report-section">
                    <h2>â­ 2. ì¢…í•© í‰ê°€</h2>
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="rating-badge rating-${getRatingClass(comprehensive.overall_rating)}">
                            ${getRatingText(comprehensive.overall_rating)}
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="label">ROI (íˆ¬ììˆ˜ìµë¥ )</div>
                            <div class="value">${roi.roi_percentage.toFixed(2)}%</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">IRR (ë‚´ë¶€ìˆ˜ìµë¥ )</div>
                            <div class="value">${roi.irr_percentage.toFixed(2)}%</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">íšŒìˆ˜ ê¸°ê°„</div>
                            <div class="value">${roi.payback_period_years.toFixed(1)}</div>
                            <div class="unit">ë…„</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">LH ë§¤ì… ìê²©</div>
                            <div class="value" style="font-size: 1.5em;">${comprehensive.purchase_analysis.is_eligible ? 'âœ…' : 'âŒ'}</div>
                        </div>
                    </div>

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI ì¢…í•© ë¶„ì„</div>
                        <p>${aiInsights.overall}</p>
                    </div>

                    <!-- 5ê°í˜• ë ˆì´ë” ì°¨íŠ¸ -->
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ“Š ë ˆì´ë” ì°¨íŠ¸ í•´ì„¤</div>
                        <p>${generateRadarChartInsight(comprehensive, roi)}</p>
                    </div>
                </div>

                <!-- 3. ì¬ë¬´ ë¶„ì„ -->
                <div class="report-section">
                    <h2>ğŸ’° 3. ì¬ë¬´ ë¶„ì„</h2>
                    
                    <h3>ğŸ“¥ íˆ¬ì ë‚´ì—­</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>í•­ëª©</th>
                                <th style="text-align: right;">ê¸ˆì•¡ (ì›)</th>
                                <th style="text-align: right;">ë¹„ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>í† ì§€ë¹„</td>
                                <td style="text-align: right;">${formatNumber(landCost)}</td>
                                <td style="text-align: right;">${((landCost / roi.total_investment) * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td>ê±´ì¶•ë¹„</td>
                                <td style="text-align: right;">${formatNumber(constructionCost)}</td>
                                <td style="text-align: right;">${((constructionCost / roi.total_investment) * 100).toFixed(1)}%</td>
                            </tr>
                            <tr>
                                <td>ê¸°íƒ€ ë¹„ìš©</td>
                                <td style="text-align: right;">${formatNumber(otherCosts)}</td>
                                <td style="text-align: right;">${((otherCosts / roi.total_investment) * 100).toFixed(1)}%</td>
                            </tr>
                            <tr style="font-weight: 600; background: #f8f9fa;">
                                <td>ì´ íˆ¬ìì•¡</td>
                                <td style="text-align: right;">${formatNumber(roi.total_investment)}</td>
                                <td style="text-align: right;">100%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>ğŸ“¤ ìˆ˜ìµ êµ¬ì¡°</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>í•­ëª©</th>
                                <th style="text-align: right;">ê¸ˆì•¡ (ì›)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>LH ë§¤ì…ê°€</td>
                                <td style="text-align: right;">${formatNumber(lhPurchasePrice)}</td>
                            </tr>
                            <tr>
                                <td>ì´ ìˆ˜ìµ</td>
                                <td style="text-align: right;">${formatNumber(roi.total_revenue)}</td>
                            </tr>
                            <tr style="font-weight: 600; color: ${roi.net_profit >= 0 ? '#10b981' : '#ef4444'};">
                                <td>ìˆœì´ìµ</td>
                                <td style="text-align: right;">${formatNumber(roi.net_profit)}</td>
                            </tr>
                            <tr>
                                <td>NPV (ìˆœí˜„ì¬ê°€ì¹˜)</td>
                                <td style="text-align: right;">${formatNumber(roi.npv)}</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>ğŸ’µ ë‹¨ê°€ ë¶„ì„</h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="label">í‰ë‹¹ ë‹¨ê°€</div>
                            <div class="value">${formatNumber(comprehensive.construction_analysis.cost_per_pyeong)}</div>
                            <div class="unit">ì›/í‰</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ã¡ë‹¹ ë‹¨ê°€</div>
                            <div class="value">${formatNumber(comprehensive.construction_analysis.cost_per_sqm)}</div>
                            <div class="unit">ì›/ã¡</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì„¸ëŒ€ë‹¹ ë‹¨ê°€</div>
                            <div class="value">${formatNumber(comprehensive.construction_analysis.grand_total / inputData.num_units)}</div>
                            <div class="unit">ì›/ì„¸ëŒ€</div>
                        </div>
                    </div>

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI ì¬ë¬´ ë¶„ì„</div>
                        <p>${aiInsights.roi}</p>
                    </div>
                </div>

                <!-- 4. ê±´ì¶•ë¹„ ìƒì„¸ -->
                <div class="report-section">
                    <h2>ğŸ—ï¸ 4. ê±´ì¶•ë¹„ ìƒì„¸</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="label">ê¸°ë³¸ ê±´ì¶•ë¹„</div>
                            <div class="value">${formatNumber(comprehensive.construction_analysis.cost_per_sqm)}</div>
                            <div class="unit">ì›/ã¡</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì§€ì—­</div>
                            <div class="value">${comprehensive.construction_analysis.region}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì§€ì—­ ê°€ì¤‘ì¹˜</div>
                            <div class="value">${comprehensive.construction_analysis.regional_multiplier}</div>
                            <div class="unit">ë°°</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì´ ê±´ì¶•ë¹„</div>
                            <div class="value">${(comprehensive.construction_analysis.grand_total / 100000000).toFixed(1)}</div>
                            <div class="unit">ì–µì›</div>
                        </div>
                    </div>

                    <h3>ğŸ“Š í•­ëª©ë³„ ì„¸ë¶€ ë‚´ì—­</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>í•­ëª©</th>
                                <th style="text-align: right;">ë¹„ìœ¨</th>
                                <th style="text-align: right;">ê¸ˆì•¡ (ì›)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${generateConstructionBreakdown(comprehensive.construction_analysis.grand_total)}
                        </tbody>
                    </table>

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI ê±´ì¶•ë¹„ ë¶„ì„</div>
                        <p>${aiInsights.construction}</p>
                    </div>
                </div>

                <!-- 5. í˜„ê¸ˆíë¦„ ë¶„ì„ -->
                <div class="report-section">
                    <h2>ğŸ“Š 5. í˜„ê¸ˆíë¦„ ë¶„ì„</h2>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>ì—°ë„</th>
                                <th style="text-align: right;">ìœ ì… (ì›)</th>
                                <th style="text-align: right;">ìœ ì¶œ (ì›)</th>
                                <th style="text-align: right;">ìˆœí˜„ê¸ˆíë¦„ (ì›)</th>
                                <th style="text-align: right;">ëˆ„ì  (ì›)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cashFlows.map(cf => `
                                <tr>
                                    <td>${cf.year}ë…„</td>
                                    <td style="text-align: right; color: #10b981;">${formatNumber(cf.inflow)}</td>
                                    <td style="text-align: right; color: #ef4444;">${formatNumber(cf.outflow)}</td>
                                    <td style="text-align: right; font-weight: 600; color: ${cf.net >= 0 ? '#10b981' : '#ef4444'};">${formatNumber(cf.net)}</td>
                                    <td style="text-align: right; font-weight: 600; color: ${cf.cumulative >= 0 ? '#10b981' : '#ef4444'};">${formatNumber(cf.cumulative)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI í˜„ê¸ˆíë¦„ ë¶„ì„</div>
                        <p>${aiInsights.cashflow}</p>
                    </div>
                </div>

                <!-- 6. LH ë§¤ì… ìê²© ê²€ì¦ -->
                <div class="report-section">
                    <h2>âœ… 6. LH ë§¤ì… ìê²© ê²€ì¦</h2>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div class="stat-box" style="max-width: 400px; margin: 0 auto;">
                            <div class="label">ìê²© ìƒíƒœ</div>
                            <div class="value" style="font-size: 2em; color: ${comprehensive.purchase_analysis.is_eligible ? '#10b981' : '#ef4444'};">
                                ${comprehensive.purchase_analysis.is_eligible ? 'í†µê³¼ âœ…' : 'ë¶ˆí†µê³¼ âŒ'}
                            </div>
                        </div>
                    </div>

                    <h3>ğŸ“‹ ìƒì„¸ ì‚¬ìœ </h3>
                    <p style="padding: 15px; background: #f9fafb; border-radius: 8px; line-height: 1.8;">
                        ${comprehensive.purchase_analysis.eligibility_notes || 'ëª¨ë“  ìê²© ìš”ê±´ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.'}
                    </p>

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI LH ë§¤ì… ë¶„ì„</div>
                        <p>${aiInsights.lh_purchase}</p>
                    </div>
                </div>

                <!-- 7. ê¶Œì¥ ì‚¬í•­ -->
                <div class="report-section">
                    <h2>ğŸ“ 7. ê¶Œì¥ ì‚¬í•­</h2>
                    <ul>
                        ${comprehensive.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>

                <!-- 8. ë¦¬ìŠ¤í¬ ìš”ì¸ -->
                <div class="report-section">
                    <h2>âš ï¸ 8. ë¦¬ìŠ¤í¬ ìš”ì¸</h2>
                    <ul>
                        ${comprehensive.risk_factors.map(risk => `<li>${risk}</li>`).join('')}
                    </ul>
                </div>

                <!-- 9. ì‚¬ì—…ì„± ê°œì„  ë°©ì•ˆ -->
                <div class="report-section">
                    <h2>ğŸš€ 9. ì‚¬ì—…ì„± ê°œì„  ë°©ì•ˆ</h2>
                    
                    ${improvements.map(imp => `
                        <div class="improvement-card">
                            <div class="improvement-header">
                                <span class="priority-badge priority-${imp.priority}">
                                    ${imp.priority === 'high' ? 'ğŸ”´ ë†’ìŒ' : imp.priority === 'medium' ? 'ğŸŸ¡ ì¤‘ê°„' : 'ğŸŸ¢ ë‚®ìŒ'}
                                </span>
                                <span class="category-badge">${imp.category}</span>
                            </div>
                            <h4>${imp.title}</h4>
                            <p><strong>ì„¤ëª…:</strong> ${imp.description}</p>
                            <p><strong>ê¸°ëŒ€ íš¨ê³¼:</strong> ${imp.expected_impact}</p>
                            <p style="margin-top: 8px;">
                                <strong>ê³ ë ¤ì‚¬í•­:</strong> 
                                ${imp.considerations.map(c => {
                                    const icons = {
                                        'ì •ì±… ê¸ˆìœµ': 'ğŸ’°',
                                        'ì›ê°€ ì ˆê°': 'ğŸ’¸',
                                        'ì¸í—ˆê°€ ë‹¨ì¶•': 'ğŸ“‹',
                                        'ë§ˆì¼€íŒ…': 'ğŸ“¢',
                                        'ì„¸ë¬´ ìµœì í™”': 'ğŸ“Š'
                                    };
                                    return `${icons[c] || 'â€¢'} ${c}`;
                                }).join(' | ')}
                            </p>
                        </div>
                    `).join('')}

                    <div class="ai-insight">
                        <div class="ai-icon">ğŸ¤– AI ê°œì„  ë°©ì•ˆ ë¶„ì„</div>
                        <p>${aiInsights.improvements}</p>
                    </div>
                </div>

                <!-- 10. ìµœì¢… ê²°ë¡  -->
                <div class="report-section">
                    <h2>ğŸ“ 10. ìµœì¢… ê²°ë¡ </h2>
                    
                    <div class="conclusion-box">
                        <h3>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</h3>
                        <h3>ìµœì¢… ê²°ë¡ </h3>
                        <h3>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</h3>
                        <p style="white-space: pre-line; margin-top: 15px;">${aiInsights.final}</p>
                    </div>
                </div>

                <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="action-buttons">
                    <button class="btn-secondary" onclick="window.print()">
                        ğŸ“„ ë³´ê³ ì„œ ì¸ì‡„
                    </button>
                    <button class="btn-secondary" onclick="location.reload()">
                        ğŸ”„ ìƒˆ í”„ë¡œì íŠ¸ ë¶„ì„
                    </button>
                    <button class="btn-secondary" onclick="location.href='/dashboard'">
                        ğŸ“Š ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                    </button>
                </div>
            `;

            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';

            // ë ˆì´ë” ì°¨íŠ¸ ìƒì„±
            createRadarChart(comprehensive, roi);
        }

        // ë ˆì´ë” ì°¨íŠ¸ ìƒì„±
        function createRadarChart(comprehensive, roi) {
            const ctx = document.getElementById('radarChart');
            if (!ctx) return;

            // 5ê°€ì§€ í‰ê°€ ì§€í‘œ ê³„ì‚° (0-100 ìŠ¤ì¼€ì¼)
            const roiScore = Math.min(100, (roi.roi_percentage / 15) * 100); // 15%ë¥¼ 100ì ìœ¼ë¡œ
            const irrScore = Math.min(100, (roi.irr_percentage / 12) * 100); // 12%ë¥¼ 100ì ìœ¼ë¡œ
            const lhScore = comprehensive.purchase_analysis.is_eligible ? 100 : 30; // ìê²© í†µê³¼ ì‹œ 100ì 
            
            // ê±´ì¶•ë¹„ ì ìˆ˜ (í‰ë‹¹ 120ë§Œì› ì´í•˜ê°€ 100ì , 180ë§Œì› ì´ìƒì´ 0ì )
            const costPerPyeong = comprehensive.construction_analysis.cost_per_pyeong;
            const costScore = Math.max(0, Math.min(100, ((1800000 - costPerPyeong) / 600000) * 100));
            
            // íšŒìˆ˜ê¸°ê°„ ì ìˆ˜ (2ë…„ ì´í•˜ê°€ 100ì , 5ë…„ ì´ìƒì´ 0ì )
            const paybackScore = Math.max(0, Math.min(100, ((5 - roi.payback_period_years) / 3) * 100));

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ROI', 'IRR', 'LH ìê²©', 'ê±´ì¶•ë¹„', 'íšŒìˆ˜ê¸°ê°„'],
                    datasets: [{
                        label: 'ì‚¬ì—…ì„± í‰ê°€',
                        data: [roiScore, irrScore, lhScore, costScore, paybackScore],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: {
                                    size: 11
                                }
                            },
                            pointLabels: {
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'ì¢…í•© ì‚¬ì—…ì„± ë ˆì´ë” ì°¨íŠ¸',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    }
                }
            });
        }

        // ë ˆì´ë” ì°¨íŠ¸ AI í•´ì„¤ ìƒì„±
        function generateRadarChartInsight(comprehensive, roi) {
            let insight = 'ë ˆì´ë” ì°¨íŠ¸ëŠ” 5ê°€ì§€ í•µì‹¬ ì§€í‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ì—…ì„±ì„ ì‹œê°í™”í•œ ê²ƒì…ë‹ˆë‹¤.\n\n';
            
            const roiScore = Math.min(100, (roi.roi_percentage / 15) * 100);
            const irrScore = Math.min(100, (roi.irr_percentage / 12) * 100);
            const lhScore = comprehensive.purchase_analysis.is_eligible ? 100 : 30;
            const costPerPyeong = comprehensive.construction_analysis.cost_per_pyeong;
            const costScore = Math.max(0, Math.min(100, ((1800000 - costPerPyeong) / 600000) * 100));
            const paybackScore = Math.max(0, Math.min(100, ((5 - roi.payback_period_years) / 3) * 100));

            const scores = [
                { name: 'ROI', value: roiScore },
                { name: 'IRR', value: irrScore },
                { name: 'LH ìê²©', value: lhScore },
                { name: 'ê±´ì¶•ë¹„', value: costScore },
                { name: 'íšŒìˆ˜ê¸°ê°„', value: paybackScore }
            ];

            // ê°€ì¥ ë†’ì€ ì ìˆ˜ì™€ ë‚®ì€ ì ìˆ˜ ì°¾ê¸°
            const maxScore = scores.reduce((max, s) => s.value > max.value ? s : max);
            const minScore = scores.reduce((min, s) => s.value < min.value ? s : min);

            insight += `**ê°•ì :** ${maxScore.name} í•­ëª©ì´ ${maxScore.value.toFixed(0)}ì ìœ¼ë¡œ ê°€ì¥ ìš°ìˆ˜í•©ë‹ˆë‹¤. `;
            insight += `**ê°œì„  í•„ìš”:** ${minScore.name} í•­ëª©ì´ ${minScore.value.toFixed(0)}ì ìœ¼ë¡œ ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì•„ ì§‘ì¤‘ì ì¸ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\n`;

            insight += `ì°¨íŠ¸ì˜ ë©´ì ì´ ë„“ì„ìˆ˜ë¡ ì „ë°˜ì ì¸ ì‚¬ì—…ì„±ì´ ìš°ìˆ˜í•¨ì„ ì˜ë¯¸í•˜ë©°, `;
            insight += `ê· í˜• ì¡íŒ ì˜¤ê°í˜• ëª¨ì–‘ì¼ìˆ˜ë¡ ì•ˆì •ì ì¸ í”„ë¡œì íŠ¸ë¡œ í‰ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

            return insight;
        }

        // ê±´ì¶•ë¹„ ì„¸ë¶€ ë‚´ì—­ ìƒì„±
        function generateConstructionBreakdown(totalCost) {
            const breakdown = [
                { name: 'êµ¬ì¡°ë¹„', ratio: 30 },
                { name: 'ë§ˆê°ë¹„', ratio: 25 },
                { name: 'ì„¤ë¹„ë¹„', ratio: 20 },
                { name: 'ì „ê¸°/ì†Œë°©', ratio: 15 },
                { name: 'ê¸°íƒ€', ratio: 10 }
            ];

            return breakdown.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td style="text-align: right;">${item.ratio}%</td>
                    <td style="text-align: right;">${formatNumber(totalCost * item.ratio / 100)}</td>
                </tr>
            `).join('');
        }

        // ë“±ê¸‰ í´ë˜ìŠ¤ ë°˜í™˜
        function getRatingClass(rating) {
            const map = {
                'excellent': 'excellent',
                'good': 'good',
                'fair': 'fair',
                'poor': 'poor'
            };
            return map[rating] || 'fair';
        }

        // ë“±ê¸‰ í…ìŠ¤íŠ¸ ë°˜í™˜
        function getRatingText(rating) {
            const map = {
                'excellent': 'ìš°ìˆ˜',
                'good': 'ì–‘í˜¸',
                'fair': 'ë³´í†µ',
                'poor': 'ë¯¸í¡'
            };
            return map[rating] || 'ë³´í†µ';
        }

        // ë‹¨ê³„ ì—…ë°ì´íŠ¸
        function updateStep(step) {
            document.querySelectorAll('.step').forEach((el, idx) => {
                if (idx + 1 <= step) {
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            console.log('í”„ë¡œì íŠ¸ ì¢…í•© ë¶„ì„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        });
    </script>
</body>
</html>
