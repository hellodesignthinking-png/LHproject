<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ì±… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ - LH ì‹ ì¶•ë§¤ì…ì„ëŒ€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 200px;
            padding: 15px 25px;
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .filters h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .filter-button {
            padding: 10px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .summary-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .key-changes {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .key-changes h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .key-changes ul {
            list-style: none;
            padding-left: 0;
        }

        .key-changes li {
            padding: 8px 0;
            color: #555;
            position: relative;
            padding-left: 25px;
        }

        .key-changes li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .policy-list {
            display: grid;
            gap: 20px;
        }

        .policy-item {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .policy-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .policy-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .policy-title {
            flex: 1;
            min-width: 300px;
        }

        .policy-title h4 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .policy-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            font-size: 13px;
            color: #666;
        }

        .policy-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge.importance-high {
            background: #ff4757;
            color: white;
        }

        .badge.importance-medium {
            background: #ffa502;
            color: white;
        }

        .badge.category {
            background: #667eea;
            color: white;
        }

        .policy-content {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
            white-space: pre-wrap;
            font-size: 14px;
        }

        .policy-changes {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .policy-changes h5 {
            color: #333;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .change-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }

        .change-item:last-child {
            margin-bottom: 0;
        }

        .change-field {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .change-values {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .old-value {
            text-decoration: line-through;
            color: #999;
            text-align: right;
        }

        .arrow {
            color: #667eea;
            font-weight: bold;
        }

        .new-value {
            color: #27ae60;
            font-weight: bold;
        }

        .change-impact {
            font-size: 12px;
            color: #666;
            font-style: italic;
        }

        .impact-analysis {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }

        .impact-analysis h5 {
            color: #333;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .impact-section {
            margin-bottom: 15px;
        }

        .impact-section:last-child {
            margin-bottom: 0;
        }

        .impact-section h6 {
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .impact-section ul {
            list-style: none;
            padding-left: 0;
        }

        .impact-section li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
            font-size: 13px;
            color: #666;
        }

        .impact-section.positive li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .impact-section.negative li:before {
            content: "âœ—";
            position: absolute;
            left: 0;
            color: #e74c3c;
            font-weight: bold;
        }

        .impact-section.recommendations li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #3498db;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .report-button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 30px auto;
            padding: 15px 30px;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .report-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .tabs, .filters, .report-button, .back-button {
                display: none !important;
            }

            .policy-item {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-button">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

        <div class="header">
            <h1>ğŸ“Š ì •ì±… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h1>
            <p>LH ì‹ ì¶•ë§¤ì…ì„ëŒ€ ê´€ë ¨ ì •ì±… ë° ê·œì œ ë³€í™”ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤</p>
        </div>


        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
        <div style="background: white; padding: 15px 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
            <a href="/project-analysis" style="padding: 10px 20px; background: white; color: #667eea; text-decoration: none; border-radius: 8px; font-weight: bold; border: 2px solid #667eea; transition: all 0.3s;"
               onmouseover="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.color='white';"
               onmouseout="this.style.background='white'; this.style.color='#667eea';">
                ğŸ“Š í”„ë¡œì íŠ¸ ë¶„ì„
            </a>
            <a href="/policy-monitoring" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                ğŸ” ì •ì±… ëª¨ë‹ˆí„°ë§
            </a>
            <a href="/dashboard" style="padding: 10px 20px; background: white; color: #667eea; text-decoration: none; border-radius: 8px; font-weight: bold; border: 2px solid #667eea; transition: all 0.3s;"
               onmouseover="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.color='white';"
               onmouseout="this.style.background='white'; this.style.color='#667eea';">
                ğŸ“ˆ ëŒ€ì‹œë³´ë“œ
            </a>
        </div>
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('lh-announcements')">
                ğŸ¢ LH ì‚¬ì—…ê³µê³ 
            </button>
            <button class="tab-button" onclick="switchTab('policy-changes')">
                ğŸ“‹ ì •ì±… ë³€ê²½
            </button>
            <button class="tab-button" onclick="switchTab('building-regulations')">
                ğŸ—ï¸ ê±´ì¶•/ì œë„ ë³€ê²½
            </button>
            <button class="tab-button" onclick="switchTab('comprehensive-report')">
                ğŸ“„ ì¢…í•© ë¦¬í¬íŠ¸
            <button class="tab-button" onclick="switchTab('ai-strategy')">ğŸ¤– AI ì „ëµ ë¶„ì„</button>
            </button>
        </div>

        <!-- LH ì‚¬ì—…ê³µê³  íƒ­ -->
        <div id="lh-announcements" class="tab-content active">
            <div class="filters">
                <h3>ğŸ” ê²€ìƒ‰ í•„í„°</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>ê¸°ê°„</label>
                        <select id="lh-days">
                            <option value="7">ìµœê·¼ 7ì¼</option>
                            <option value="30" selected>ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>í‚¤ì›Œë“œ</label>
                        <input type="text" id="lh-keywords" placeholder="ì˜ˆ: ì²­ë…„í˜•, ì‹ í˜¼ë¶€ë¶€í˜•">
                    </div>
                    <button class="filter-button" onclick="loadLHAnnouncements()">ê²€ìƒ‰</button>
                </div>
            </div>

            <div id="lh-summary"></div>
            <div id="lh-list" class="policy-list"></div>
        </div>

        <!-- ì •ì±… ë³€ê²½ íƒ­ -->
        <div id="policy-changes" class="tab-content">
            <div class="filters">
                <h3>ğŸ” ê²€ìƒ‰ í•„í„°</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>ê¸°ê°„</label>
                        <select id="policy-days">
                            <option value="7">ìµœê·¼ 7ì¼</option>
                            <option value="30" selected>ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>í‚¤ì›Œë“œ</label>
                        <input type="text" id="policy-keywords" placeholder="ì˜ˆ: ì„¸ì œí˜œíƒ, ESG">
                    </div>
                    <button class="filter-button" onclick="loadPolicyChanges()">ê²€ìƒ‰</button>
                </div>
            </div>

            <div id="policy-summary"></div>
            <div id="policy-list" class="policy-list"></div>
        </div>

        <!-- ê±´ì¶•/ì œë„ ë³€ê²½ íƒ­ -->
        <div id="building-regulations" class="tab-content">
            <div class="filters">
                <h3>ğŸ” ê²€ìƒ‰ í•„í„°</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>ê¸°ê°„</label>
                        <select id="regulation-days">
                            <option value="7">ìµœê·¼ 7ì¼</option>
                            <option value="30" selected>ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>í‚¤ì›Œë“œ</label>
                        <input type="text" id="regulation-keywords" placeholder="ì˜ˆ: ì œë¡œì—ë„ˆì§€, ê±´ì¶•ë²•">
                    </div>
                    <button class="filter-button" onclick="loadBuildingRegulations()">ê²€ìƒ‰</button>
                </div>
            </div>

            <div id="regulation-summary"></div>
            <div id="regulation-list" class="policy-list"></div>
        </div>

        <!-- ì¢…í•© ë¦¬í¬íŠ¸ íƒ­ -->
        <div id="comprehensive-report" class="tab-content">
            <div class="filters">
                <h3>ğŸ“Š ë¦¬í¬íŠ¸ ìƒì„±</h3>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>ë¦¬í¬íŠ¸ ê¸°ê°„</label>
                        <select id="report-days">
                            <option value="7" selected>ìµœê·¼ 7ì¼</option>
                            <option value="30">ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    <button class="filter-button" onclick="generateComprehensiveReport()">ë¦¬í¬íŠ¸ ìƒì„±</button>
                </div>
            </div>

            <div id="comprehensive-report-content"></div>

        <!-- AI ì „ëµ ë¶„ì„ íƒ­ -->
        <div id="ai-strategy" class="tab-content">
            <div class="filters">
                <h3>ğŸ¤– AI ê¸°ë°˜ ì •ì±… ì˜í–¥ ë¶„ì„</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    AIê°€ ì •ì±… ëª¨ë‹ˆí„°ë§ ê²°ê³¼ë¥¼ ì¢…í•© ë¶„ì„í•˜ì—¬ êµ¬ì²´ì ì¸ ì‹¤í–‰ ì „ëµì„ ì œì‹œí•©ë‹ˆë‹¤.
                </p>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>ë¶„ì„ ê¸°ê°„</label>
                        <select id="ai-days">
                            <option value="7">ìµœê·¼ 7ì¼</option>
                            <option value="30" selected>ìµœê·¼ 30ì¼</option>
                            <option value="90">ìµœê·¼ 90ì¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ë¶„ì„ ì¹´í…Œê³ ë¦¬</label>
                        <select id="ai-category">
                            <option value="">ì „ì²´ ì¢…í•© ë¶„ì„</option>
                            <option value="lh">LH ê³µê³ ë§Œ</option>
                            <option value="policy">ì •ì±… ë³€ê²½ë§Œ</option>
                            <option value="regulation">ê±´ì¶•/ì œë„ë§Œ</option>
                        </select>
                    </div>
                    <button class="filter-button" onclick="generateAIStrategy()" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        ğŸ¤– AI ì „ëµ ìƒì„±
                    </button>
                </div>
            </div>

            <div id="ai-strategy-content"></div>
        </div>
        </div>
    </div>

    <script>
        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            // í•´ë‹¹ íƒ­ ë°ì´í„° ë¡œë“œ
            if (tabName === 'lh-announcements' && !document.getElementById('lh-list').innerHTML) {
                loadLHAnnouncements();
            } else if (tabName === 'policy-changes' && !document.getElementById('policy-list').innerHTML) {
                loadPolicyChanges();
            } else if (tabName === 'building-regulations' && !document.getElementById('regulation-list').innerHTML) {
                loadBuildingRegulations();
            }
        }

        // LH ì‚¬ì—…ê³µê³  ë¡œë“œ
        async function loadLHAnnouncements() {
            const days = document.getElementById('lh-days').value;
            const keywords = document.getElementById('lh-keywords').value;
            
            document.getElementById('lh-list').innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
            
            try {
                const url = `/api/policy/lh-announcements?days=${days}${keywords ? '&keywords=' + encodeURIComponent(keywords) : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // ìš”ì•½ ë Œë”ë§
                renderSummary('lh-summary', data.summary, data.category, data.period);
                
                // ê³µê³  ëª©ë¡ ë Œë”ë§
                renderAnnouncementList('lh-list', data.data);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('lh-list').innerHTML = '<div class="loading"><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        // ì •ì±… ë³€ê²½ ë¡œë“œ
        async function loadPolicyChanges() {
            const days = document.getElementById('policy-days').value;
            const keywords = document.getElementById('policy-keywords').value;
            
            document.getElementById('policy-list').innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
            
            try {
                const url = `/api/policy/policy-changes?days=${days}${keywords ? '&keywords=' + encodeURIComponent(keywords) : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // ìš”ì•½ ë Œë”ë§
                renderSummary('policy-summary', data.summary, data.category, data.period);
                
                // ì •ì±… ëª©ë¡ ë Œë”ë§
                renderPolicyList('policy-list', data.data);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('policy-list').innerHTML = '<div class="loading"><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        // ê±´ì¶•/ì œë„ ë³€ê²½ ë¡œë“œ
        async function loadBuildingRegulations() {
            const days = document.getElementById('regulation-days').value;
            const keywords = document.getElementById('regulation-keywords').value;
            
            document.getElementById('regulation-list').innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
            
            try {
                const url = `/api/policy/building-regulations?days=${days}${keywords ? '&keywords=' + encodeURIComponent(keywords) : ''}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // ìš”ì•½ ë Œë”ë§
                renderSummary('regulation-summary', data.summary, data.category, data.period);
                
                // ê·œì œ ëª©ë¡ ë Œë”ë§
                renderRegulationList('regulation-list', data.data);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('regulation-list').innerHTML = '<div class="loading"><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        // ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±
        async function generateComprehensiveReport() {
            const days = document.getElementById('report-days').value;
            
            document.getElementById('comprehensive-report-content').innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>ì¢…í•© ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...</p></div>';
            
            try {
                const url = `/api/policy/generate-report?days=${days}`;
                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();
                
                renderComprehensiveReport(data.report);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('comprehensive-report-content').innerHTML = '<div class="loading"><p>ë¦¬í¬íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p></div>';
            }
        }

        // ìš”ì•½ ë Œë”ë§
        function renderSummary(elementId, summary, category, period) {
            const html = `
                <div class="summary-card">
                    <h3>${category} ìš”ì•½ (${period})</h3>
                    <div class="summary-stats">
                        <div class="stat-box">
                            <div class="label">ì´ ì—…ë°ì´íŠ¸</div>
                            <div class="value">${summary.new_announcements + summary.revised_announcements || summary.new_policies + summary.revised_policies || summary.law_amendments + summary.certification_changes + summary.lh_standards + summary.safety_regulations}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì‹ ê·œ</div>
                            <div class="value">${summary.new_announcements || summary.new_policies || summary.law_amendments || 0}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ê°œì •/ë³€ê²½</div>
                            <div class="value">${summary.revised_announcements || summary.revised_policies || summary.certification_changes || 0}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ê³ ì¤‘ìš”ë„</div>
                            <div class="value">${summary.high_importance}</div>
                        </div>
                    </div>
                    <div class="key-changes">
                        <h4>ì£¼ìš” ë³€ê²½ì‚¬í•­</h4>
                        <ul>
                            ${summary.key_changes.map(change => `<li>${change}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            document.getElementById(elementId).innerHTML = html;
        }

        // ê³µê³  ëª©ë¡ ë Œë”ë§
        function renderAnnouncementList(elementId, announcements) {
            const html = announcements.map(ann => `
                <div class="policy-item">
                    <div class="policy-header">
                        <div class="policy-title">
                            <h4>${ann.title}</h4>
                            <div class="policy-meta">
                                <span>ğŸ“… ${new Date(ann.published_at).toLocaleDateString('ko-KR')}</span>
                                <span>ğŸ¢ ${ann.source.name}</span>
                            </div>
                        </div>
                        <div class="policy-badges">
                            <span class="badge importance-${ann.importance}">${ann.importance === 'high' ? 'ê¸´ê¸‰' : 'ì¼ë°˜'}</span>
                            <span class="badge category">${ann.category.sub || ann.category.main}</span>
                        </div>
                    </div>
                    
                    <div class="policy-content">${ann.content}</div>
                    
                    ${ann.changes && ann.changes.length > 0 ? `
                        <div class="policy-changes">
                            <h5>ğŸ“Š ì£¼ìš” ë³€ê²½ì‚¬í•­</h5>
                            ${ann.changes.map(change => `
                                <div class="change-item">
                                    <div class="change-field">${change.field.replace(/_/g, ' ')}</div>
                                    <div class="change-values">
                                        <div class="old-value">${change.old_value}</div>
                                        <div class="arrow">â†’</div>
                                        <div class="new-value">${change.new_value}</div>
                                    </div>
                                    <div class="change-impact">${change.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <small style="color: #999;">ğŸ”— <a href="${ann.url}" target="_blank" style="color: #667eea;">ìƒì„¸ ë‚´ìš© ë³´ê¸°</a></small>
                    </div>
                </div>
            `).join('');
            
            document.getElementById(elementId).innerHTML = html;
        }

        // ì •ì±… ëª©ë¡ ë Œë”ë§
        function renderPolicyList(elementId, policies) {
            const html = policies.map(policy => `
                <div class="policy-item">
                    <div class="policy-header">
                        <div class="policy-title">
                            <h4>${policy.title}</h4>
                            <div class="policy-meta">
                                <span>ğŸ“… ${new Date(policy.published_at).toLocaleDateString('ko-KR')}</span>
                                <span>ğŸ›ï¸ ${policy.source.name}</span>
                            </div>
                        </div>
                        <div class="policy-badges">
                            <span class="badge importance-${policy.importance}">${policy.importance === 'high' ? 'ê¸´ê¸‰' : 'ì¼ë°˜'}</span>
                            <span class="badge category">${policy.category.sub || policy.category.main}</span>
                        </div>
                    </div>
                    
                    <div class="policy-content">${policy.content}</div>
                    
                    ${policy.impact_analysis ? `
                        <div class="impact-analysis">
                            <h5>ğŸ’¡ ì˜í–¥ ë¶„ì„</h5>
                            
                            ${policy.impact_analysis.positive ? `
                                <div class="impact-section positive">
                                    <h6>ê¸ì •ì  ì˜í–¥</h6>
                                    <ul>
                                        ${policy.impact_analysis.positive.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${policy.impact_analysis.negative ? `
                                <div class="impact-section negative">
                                    <h6>ë¶€ì •ì  ì˜í–¥ / ê³ ë ¤ì‚¬í•­</h6>
                                    <ul>
                                        ${policy.impact_analysis.negative.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${policy.impact_analysis.recommendations ? `
                                <div class="impact-section recommendations">
                                    <h6>ê¶Œì¥ ì¡°ì¹˜ì‚¬í•­</h6>
                                    <ul>
                                        ${policy.impact_analysis.recommendations.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <small style="color: #999;">ğŸ”— <a href="${policy.url}" target="_blank" style="color: #667eea;">ìƒì„¸ ë‚´ìš© ë³´ê¸°</a></small>
                    </div>
                </div>
            `).join('');
            
            document.getElementById(elementId).innerHTML = html;
        }

        // ê·œì œ ëª©ë¡ ë Œë”ë§
        function renderRegulationList(elementId, regulations) {
            const html = regulations.map(reg => `
                <div class="policy-item">
                    <div class="policy-header">
                        <div class="policy-title">
                            <h4>${reg.title}</h4>
                            <div class="policy-meta">
                                <span>ğŸ“… ${new Date(reg.published_at).toLocaleDateString('ko-KR')}</span>
                                <span>âš–ï¸ ${reg.source.name}</span>
                            </div>
                        </div>
                        <div class="policy-badges">
                            <span class="badge importance-${reg.importance}">${reg.importance === 'high' ? 'ê¸´ê¸‰' : 'ì¼ë°˜'}</span>
                            <span class="badge category">${reg.category.sub || reg.category.main}</span>
                        </div>
                    </div>
                    
                    <div class="policy-content">${reg.content}</div>
                    
                    ${reg.impact_analysis ? `
                        <div class="impact-analysis">
                            <h5>ğŸ’¡ ì˜í–¥ ë¶„ì„</h5>
                            
                            ${reg.impact_analysis.opportunities ? `
                                <div class="impact-section positive">
                                    <h6>ê¸°íšŒ ìš”ì¸</h6>
                                    <ul>
                                        ${reg.impact_analysis.opportunities.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${reg.impact_analysis.challenges || reg.impact_analysis.considerations || reg.impact_analysis.risks ? `
                                <div class="impact-section negative">
                                    <h6>ìœ„í—˜ ìš”ì¸ / ê³ ë ¤ì‚¬í•­</h6>
                                    <ul>
                                        ${(reg.impact_analysis.challenges || reg.impact_analysis.considerations || reg.impact_analysis.risks || []).map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${reg.impact_analysis.action_items ? `
                                <div class="impact-section recommendations">
                                    <h6>ì‹¤í–‰ ê³¼ì œ</h6>
                                    <ul>
                                        ${reg.impact_analysis.action_items.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${reg.impact_analysis.cost_impact ? `
                                <div class="impact-section" style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                    <h6 style="color: #856404;">ğŸ’° ë¹„ìš© ì˜í–¥</h6>
                                    <ul style="list-style: none; padding-left: 0;">
                                        ${Object.entries(reg.impact_analysis.cost_impact).map(([key, value]) => `
                                            <li style="padding: 3px 0; color: #856404;">
                                                <strong>${key.replace(/_/g, ' ')}:</strong> ${value}
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <small style="color: #999;">ğŸ”— <a href="${reg.url}" target="_blank" style="color: #667eea;">ìƒì„¸ ë‚´ìš© ë³´ê¸°</a></small>
                    </div>
                </div>
            `).join('');
            
            document.getElementById(elementId).innerHTML = html;
        }

        // ì¢…í•© ë¦¬í¬íŠ¸ ë Œë”ë§
        function renderComprehensiveReport(report) {
            const html = `
                <div class="summary-card">
                    <h3>ğŸ“Š ì •ì±… ëª¨ë‹ˆí„°ë§ ì¢…í•© ë¦¬í¬íŠ¸</h3>
                    <p style="color: #666; margin-bottom: 20px;">
                        ìƒì„±ì¼ì‹œ: ${new Date(report.generated_at).toLocaleString('ko-KR')} | 
                        ë¶„ì„ ê¸°ê°„: ${report.period}
                    </p>
                    
                    <div class="summary-stats">
                        <div class="stat-box">
                            <div class="label">LH ê³µê³ </div>
                            <div class="value">${report.categories.lh_announcements.count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì •ì±… ë³€ê²½</div>
                            <div class="value">${report.categories.policy_changes.count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ê±´ì¶•/ì œë„</div>
                            <div class="value">${report.categories.building_regulations.count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì´ ì—…ë°ì´íŠ¸</div>
                            <div class="value">${report.overall_summary.total_updates}</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ¯ ì£¼ìš” ì •ì±… ë³€í™”</h3>
                    <div class="key-changes">
                        <ul>
                            ${report.overall_summary.high_priority_items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ’¼ ì‚¬ì—… ì˜í–¥ ë¶„ì„</h3>
                    
                    <div class="impact-analysis">
                        <div class="impact-section positive">
                            <h6>ğŸ“ˆ ê¸°íšŒ ìš”ì¸</h6>
                            <ul>
                                ${report.overall_summary.business_impact.opportunities.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="impact-section negative">
                            <h6>âš ï¸ ë„ì „ ê³¼ì œ</h6>
                            <ul>
                                ${report.overall_summary.business_impact.challenges.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h6 style="color: #856404; margin-bottom: 10px;">ğŸ’° ë¹„ìš© ì˜í–¥ ë¶„ì„</h6>
                            <ul style="list-style: none; padding-left: 0;">
                                ${Object.entries(report.overall_summary.business_impact.cost_breakdown).map(([key, value]) => `
                                    <li style="padding: 5px 0; color: #856404;">
                                        <strong>${key.replace(/_/g, ' ')}:</strong> ${value}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ¯ ì „ëµì  ê¶Œì¥ì‚¬í•­</h3>
                    <div class="impact-section recommendations">
                        <ul>
                            ${report.overall_summary.strategic_recommendations.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ“‹ ì‹¤í–‰ ê³„íš</h3>
                    
                    <div style="display: grid; gap: 15px;">
                        <div style="background: #ffe0e0; padding: 15px; border-radius: 8px;">
                            <h6 style="color: #c92a2a; margin-bottom: 10px;">ğŸš¨ ì¦‰ì‹œ ì‹¤í–‰ (Immediate)</h6>
                            <ul style="list-style: none; padding-left: 0;">
                                ${report.action_plan.immediate.map(item => `<li style="padding: 5px 0; color: #c92a2a;">â€¢ ${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #fff3bf; padding: 15px; border-radius: 8px;">
                            <h6 style="color: #e67700; margin-bottom: 10px;">âš¡ ë‹¨ê¸° (1ê°œì›” ì´ë‚´)</h6>
                            <ul style="list-style: none; padding-left: 0;">
                                ${report.action_plan.short_term_1month.map(item => `<li style="padding: 5px 0; color: #e67700;">â€¢ ${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #d0ebff; padding: 15px; border-radius: 8px;">
                            <h6 style="color: #1864ab; margin-bottom: 10px;">ğŸ“… ì¤‘ê¸° (3ê°œì›” ì´ë‚´)</h6>
                            <ul style="list-style: none; padding-left: 0;">
                                ${report.action_plan.medium_term_3months.map(item => `<li style="padding: 5px 0; color: #1864ab;">â€¢ ${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #d3f9d8; padding: 15px; border-radius: 8px;">
                            <h6 style="color: #2b8a3e; margin-bottom: 10px;">ğŸ¯ ì¥ê¸° (6ê°œì›” ì´ë‚´)</h6>
                            <ul style="list-style: none; padding-left: 0;">
                                ${report.action_plan.long_term_6months.map(item => `<li style="padding: 5px 0; color: #2b8a3e;">â€¢ ${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <button class="report-button" onclick="window.print()">ğŸ“„ ë¦¬í¬íŠ¸ ì¸ì‡„/PDF ì €ì¥</button>
            `;
            
            document.getElementById('comprehensive-report-content').innerHTML = html;
        }

        // ì´ˆê¸° ë¡œë“œ

        // AI ì „ëµ ìƒì„±
        async function generateAIStrategy() {
            const days = document.getElementById('ai-days').value;
            const category = document.getElementById('ai-category').value;
            
            document.getElementById('ai-strategy-content').innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>AIê°€ ì •ì±…ì„ ë¶„ì„í•˜ì—¬ ì „ëµì„ ìƒì„±í•˜ëŠ” ì¤‘... (30ì´ˆ~1ë¶„ ì†Œìš”)</p></div>';
            
            try {
                const url = `/api/policy/analyze-with-ai?days=${days}${category ? '&category=' + category : ''}`;
                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    renderAIStrategy(data);
                } else {
                    throw new Error('AI ë¶„ì„ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('ai-strategy-content').innerHTML = '<div class="loading"><p>AI ì „ëµ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p></div>';
            }
        }

        // AI ì „ëµ ë Œë”ë§
        function renderAIStrategy(data) {
            const ai = data.ai_analysis;
            
            const html = `
                <div class="summary-card">
                    <h3>ğŸ¤– AI ì •ì±… ì˜í–¥ ë¶„ì„ ê²°ê³¼</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        ë¶„ì„ ê¸°ê°„: ${data.period} | 
                        ë¶„ì„ ì •ì±… ìˆ˜: ${data.total_policies}ê±´ |
                        ìƒì„± ì‹œê°„: ${new Date(data.analysis_date).toLocaleString('ko-KR')}
                    </p>
                    <div style="background: #e7f5ff; padding: 15px; border-radius: 8px; border-left: 4px solid #1971c2;">
                        <h4 style="color: #1971c2; margin-bottom: 10px;">ğŸ“Œ í•µì‹¬ ìš”ì•½</h4>
                        <div style="white-space: pre-wrap; line-height: 1.8; color: #333;">${ai.summary || 'ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'}</div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>âœ… ê¸°íšŒ ìš”ì¸</h3>
                    <div class="impact-analysis">
                        <div class="impact-section positive">
                            <div style="white-space: pre-wrap; line-height: 1.8;">${ai.opportunities || 'ë¶„ì„ ì¤‘...'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>âš ï¸ ìœ„í—˜ ìš”ì¸</h3>
                    <div class="impact-analysis">
                        <div class="impact-section negative">
                            <div style="white-space: pre-wrap; line-height: 1.8;">${ai.risks || 'ë¶„ì„ ì¤‘...'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card" style="background: linear-gradient(135deg, #fff5f5 0%, #ffe3e3 100%);">
                    <h3>ğŸš¨ ì¦‰ì‹œ ì‹¤í–‰ ì „ëµ (ìš°ì„ ìˆœìœ„ ë†’ìŒ)</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #e03131;">
                        <div style="white-space: pre-wrap; line-height: 1.8; color: #333;">${ai.immediate_actions || 'ë¶„ì„ ì¤‘...'}</div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ“… ì¤‘ì¥ê¸° ì „ëµ (3-6ê°œì›”)</h3>
                    <div class="impact-analysis">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="white-space: pre-wrap; line-height: 1.8;">${ai.mid_term_strategy || 'ë¶„ì„ ì¤‘...'}</div>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h3>ğŸ’° ë¹„ìš© ì˜í–¥ ëŒ€ì‘</h3>
                    <div style="background: #fff3bf; padding: 15px; border-radius: 8px; border-left: 4px solid #fab005;">
                        <div style="white-space: pre-wrap; line-height: 1.8; color: #333;">${ai.cost_response || 'ë¶„ì„ ì¤‘...'}</div>
                    </div>
                </div>
                
                <div class="summary-card" style="background: linear-gradient(135deg, #f0f7ff 0%, #e0f2fe 100%);">
                    <h3>ğŸ¯ ìµœì¢… ê¶Œì¥ì‚¬í•­</h3>
                    <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #0c8599;">
                        <div style="white-space: pre-wrap; line-height: 1.8; color: #333; font-size: 15px;">${ai.recommendations || 'ë¶„ì„ ì¤‘...'}</div>
                    </div>
                </div>
                
                <div class="summary-card" style="background: #f8f9fa;">
                    <h3>ğŸ“Š ë¶„ì„ ë°ì´í„° ìš”ì•½</h3>
                    <div class="summary-stats">
                        <div class="stat-box">
                            <div class="label">LH ê³µê³ </div>
                            <div class="value">${data.raw_data_summary.lh_count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì •ì±… ë³€ê²½</div>
                            <div class="value">${data.raw_data_summary.policy_count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ê±´ì¶•/ì œë„</div>
                            <div class="value">${data.raw_data_summary.regulation_count}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">ì´ ë¶„ì„</div>
                            <div class="value">${data.total_policies}</div>
                        </div>
                    </div>
                </div>
                
                <button class="report-button" onclick="window.print()" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    ğŸ“„ AI ì „ëµ ë³´ê³ ì„œ ì¸ì‡„/PDF ì €ì¥
                </button>
            `;
            
            document.getElementById('ai-strategy-content').innerHTML = html;
        }
        loadLHAnnouncements();
    </script>
</body>
</html>
