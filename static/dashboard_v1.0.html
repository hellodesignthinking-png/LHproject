<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZeroSite v24 Dashboard UI 1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
        
        /* Multi-step wizard */
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .step-indicator { position: relative; }
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            z-index: -1;
        }
        .step-circle {
            width: 32px;
            height: 32px;
            background: #e5e7eb;
            color: #9ca3af;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        .step-circle.completed { background: #10b981; color: white; }
        .step-circle.active { background: #667eea; color: white; animation: pulse 2s infinite; }
        
        /* Auto-complete */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            background-color: white;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 99;
            border-radius: 8px;
            margin-top: 4px;
        }
        .autocomplete-item {
            padding: 10px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }
        .autocomplete-item:hover { background-color: #f3f4f6; }
        
        /* PDF Viewer */
        .pdf-viewer {
            width: 100%;
            height: 600px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* History */
        .history-item {
            padding: 12px 16px;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        .history-item:hover {
            border-left-color: #667eea;
            background-color: #f9fafb;
        }
        
        /* Error messages */
        .error-message {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 4px solid #dc2626;
            animation: slideIn 0.5s;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-1">
                        ğŸ¢ ZeroSite v24 Dashboard
                    </h1>
                    <p class="text-white/80">
                        LH ì„ëŒ€ì£¼íƒ ì‚¬ì—…ì„± ë¶„ì„ í”Œë«í¼ - UI 1.0
                    </p>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="historyBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        ğŸ“‹ History
                    </button>
                    <button id="helpBtn" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        â“ Help
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Left Sidebar: Analysis Input -->
            <div class="lg:col-span-1">
                <!-- Step Indicator -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-lg font-bold mb-4">ë¶„ì„ ë‹¨ê³„</h2>
                    <div class="step-indicator flex items-center justify-between mb-6">
                        <div class="flex flex-col items-center">
                            <div class="step-circle completed" id="step1Circle">1</div>
                            <span class="text-xs mt-2">ê¸°ë³¸ì •ë³´</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="step-circle" id="step2Circle">2</div>
                            <span class="text-xs mt-2">ê·œì œì •ë³´</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="step-circle" id="step3Circle">3</div>
                            <span class="text-xs mt-2">ê°œë°œê³„íš</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="step-circle" id="step4Circle">4</div>
                            <span class="text-xs mt-2">ê²°ê³¼</span>
                        </div>
                    </div>
                </div>

                <!-- Multi-Step Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-lg font-bold mb-4">ë¶„ì„ ì…ë ¥</h2>
                    
                    <!-- Step 1: Basic Info -->
                    <div id="step1" class="step active">
                        <h3 class="font-semibold mb-3">Step 1: ê¸°ë³¸ ì •ë³´</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">í† ì§€ ì£¼ì†Œ *</label>
                            <div class="relative" id="addressAutocomplete">
                                <input type="text" id="address" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬..."
                                    autocomplete="off">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">í† ì§€ ë©´ì  (ã¡) *</label>
                            <input type="number" id="landArea" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="1000">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ê³µì‹œì§€ê°€ (ì›/ã¡)</label>
                            <input type="number" id="landPrice" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="3000000">
                        </div>
                        
                        <button onclick="nextStep()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition">
                            ë‹¤ìŒ ë‹¨ê³„ â†’
                        </button>
                    </div>

                    <!-- Step 2: Regulation Info -->
                    <div id="step2" class="step">
                        <h3 class="font-semibold mb-3">Step 2: ê·œì œ ì •ë³´</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ìš©ë„ì§€ì—­ *</label>
                            <select id="zoning" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ2ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                                <option value="ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­">ì œ3ì¢…ì¼ë°˜ì£¼ê±°ì§€ì—­</option>
                                <option value="ì¤€ì£¼ê±°ì§€ì—­">ì¤€ì£¼ê±°ì§€ì—­</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ìš©ì ë¥  (%)</label>
                            <input type="number" id="far" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="250">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ê±´íìœ¨ (%)</label>
                            <input type="number" id="bcr" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="60">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="prevStep()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg transition">
                                â† ì´ì „
                            </button>
                            <button onclick="nextStep()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg transition">
                                ë‹¤ìŒ â†’
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Development Plan -->
                    <div id="step3" class="step">
                        <h3 class="font-semibold mb-3">Step 3: ê°œë°œ ê³„íš</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ì£¼íƒ ìœ í˜• *</label>
                            <select id="housingType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="í–‰ë³µì£¼íƒ">í–‰ë³µì£¼íƒ</option>
                                <option value="êµ­ë¯¼ì„ëŒ€">êµ­ë¯¼ì„ëŒ€</option>
                                <option value="ì˜êµ¬ì„ëŒ€">ì˜êµ¬ì„ëŒ€</option>
                                <option value="í†µí•©ê³µê³µì„ëŒ€">í†µí•©ê³µê³µì„ëŒ€</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ê±´ì¶• ì¸µìˆ˜</label>
                            <input type="number" id="floors" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="15">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">ì„¸ëŒ€ìˆ˜</label>
                            <input type="number" id="units" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                placeholder="200">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="prevStep()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg transition">
                                â† ì´ì „
                            </button>
                            <button onclick="analyzeProject()" id="analyzeBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition">
                                ğŸ“Š ë¶„ì„ ì‹œì‘
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Results (shown after analysis) -->
                    <div id="step4" class="step">
                        <h3 class="font-semibold mb-3">âœ… ë¶„ì„ ì™„ë£Œ</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ íŒ¨ë„ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                        </p>
                        <button onclick="resetForm()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg transition">
                            ğŸ”„ ìƒˆ ë¶„ì„ ì‹œì‘
                        </button>
                    </div>
                </div>

                <!-- Recent History -->
                <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
                    <h2 class="text-lg font-bold mb-4">ìµœê·¼ ë¶„ì„ (5ê±´)</h2>
                    <div id="historyList" class="space-y-2">
                        <!-- History items will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Right Content: Results -->
            <div class="lg:col-span-3">
                <!-- Error Messages -->
                <div id="errorContainer" class="mb-6"></div>
                
                <!-- Loading State -->
                <div id="loadingState" class="hidden bg-white rounded-xl shadow-lg p-12 text-center">
                    <div class="spinner mx-auto mb-4"></div>
                    <h3 class="text-xl font-bold text-gray-700">ë¶„ì„ ì¤‘...</h3>
                    <p class="text-gray-500 mt-2">í† ì§€ ì í•©ì„±, ê·œëª¨, ì‚¬ì—…ì„±ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="mt-6 bg-gray-100 rounded-lg p-4">
                        <div class="flex justify-between text-sm mb-2">
                            <span>ì§„í–‰ë¥ </span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-purple-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Results Panel -->
                <div id="resultsPanel" class="hidden">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-sm font-medium text-gray-500">ì‚¬ì—…ì„± í‰ê°€</h3>
                                <span class="text-2xl">ğŸ’°</span>
                            </div>
                            <p id="feasibilityScore" class="text-3xl font-bold text-green-600">-</p>
                            <p class="text-sm text-gray-500 mt-1">IRR / ROI</p>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-sm font-medium text-gray-500">ìµœëŒ€ ì„¸ëŒ€ìˆ˜</h3>
                                <span class="text-2xl">ğŸ </span>
                            </div>
                            <p id="maxUnits" class="text-3xl font-bold text-blue-600">-</p>
                            <p class="text-sm text-gray-500 mt-1">ì„¸ëŒ€</p>
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-sm font-medium text-gray-500">ê·œì œ ì í•©ì„±</h3>
                                <span class="text-2xl">ğŸ“‹</span>
                            </div>
                            <p id="complianceScore" class="text-3xl font-bold text-purple-600">-</p>
                            <p class="text-sm text-gray-500 mt-1">ì ìˆ˜</p>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
                        <div class="flex border-b">
                            <button onclick="showTab('chart')" id="chartTab" class="flex-1 px-6 py-4 font-medium text-purple-600 border-b-2 border-purple-600">
                                ğŸ“Š ì°¨íŠ¸
                            </button>
                            <button onclick="showTab('map')" id="mapTab" class="flex-1 px-6 py-4 font-medium text-gray-500 hover:text-purple-600">
                                ğŸ—ºï¸ ì§€ë„
                            </button>
                            <button onclick="showTab('report')" id="reportTab" class="flex-1 px-6 py-4 font-medium text-gray-500 hover:text-purple-600">
                                ğŸ“„ ë¦¬í¬íŠ¸
                            </button>
                        </div>

                        <!-- Chart Tab -->
                        <div id="chartContent" class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="font-bold mb-3">ìœ í˜•ë³„ ì í•©ë„</h3>
                                    <canvas id="radarChart" height="300"></canvas>
                                </div>
                                <div>
                                    <h3 class="font-bold mb-3">ì¬ë¬´ ì§€í‘œ</h3>
                                    <canvas id="barChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Map Tab -->
                        <div id="mapContent" class="hidden">
                            <div id="map" class="pdf-viewer"></div>
                        </div>

                        <!-- Report Tab (PDF Viewer) -->
                        <div id="reportContent" class="hidden p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold">ì‚¬ì—…ì„± ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                                <button onclick="downloadReport()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition">
                                    â¬‡ï¸ PDF ë‹¤ìš´ë¡œë“œ
                                </button>
                            </div>
                            <div class="pdf-viewer bg-gray-100 flex items-center justify-center">
                                <iframe id="pdfViewer" class="w-full h-full" style="border: none;"></iframe>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Analysis -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">ìƒì„¸ ë¶„ì„ ê²°ê³¼</h3>
                        <div id="detailedAnalysis" class="space-y-4">
                            <!-- Will be populated with analysis data -->
                        </div>
                    </div>
                </div>

                <!-- Welcome State (shown initially) -->
                <div id="welcomeState" class="bg-white rounded-xl shadow-lg p-12 text-center">
                    <div class="text-6xl mb-4">ğŸ¢</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ZeroSite v24ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h2>
                    <p class="text-gray-600 mb-6">
                        LH ì„ëŒ€ì£¼íƒ ì‚¬ì—…ì„± ë¶„ì„ì„ ì‹œì‘í•˜ë ¤ë©´<br>
                        ì™¼ìª½ íŒ¨ë„ì—ì„œ í† ì§€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                        <div class="p-4 bg-purple-50 rounded-lg">
                            <div class="text-3xl mb-2">âš¡</div>
                            <h3 class="font-semibold mb-1">ì´ˆê³ ì† ë¶„ì„</h3>
                            <p class="text-sm text-gray-600">1.2ì´ˆ ë§Œì— ì™„ë£Œ</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl mb-2">ğŸ“Š</div>
                            <h3 class="font-semibold mb-1">13ê°œ ì—”ì§„</h3>
                            <p class="text-sm text-gray-600">ì¢…í•© ë¶„ì„</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg">
                            <div class="text-3xl mb-2">âœ…</div>
                            <h3 class="font-semibold mb-1">97% ì •í™•ë„</h3>
                            <p class="text-sm text-gray-600">ì‹¤ì‚¬ë¡€ ê²€ì¦</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto m-4">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold">ë¶„ì„ ì´ë ¥</h2>
                <button onclick="closeHistoryModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="fullHistoryList" class="p-6">
                <!-- Full history items will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // ==================== State Management ====================
        let currentStep = 1;
        let analysisHistory = JSON.parse(localStorage.getItem('zerosite_history') || '[]');
        let currentAnalysisId = null;
        let map = null;
        let radarChart = null;
        let barChart = null;

        // ==================== Auto-complete ====================
        const sampleAddresses = [
            "ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123",
            "ì„œìš¸ì‹œ ì„œì´ˆêµ¬ ì„œì´ˆë™ 456",
            "ì„œìš¸ì‹œ ì†¡íŒŒêµ¬ ì ì‹¤ë™ 789",
            "ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ìƒì•”ë™ 321",
            "ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì •ìë™ 654"
        ];

        function setupAutocomplete() {
            const input = document.getElementById('address');
            const container = document.getElementById('addressAutocomplete');
            
            input.addEventListener('input', function() {
                closeAllLists();
                if (!this.value) return;
                
                const val = this.value.toLowerCase();
                const matches = sampleAddresses.filter(addr => 
                    addr.toLowerCase().includes(val)
                );
                
                if (matches.length === 0) return;
                
                const listDiv = document.createElement('div');
                listDiv.className = 'autocomplete-items';
                container.appendChild(listDiv);
                
                matches.forEach(addr => {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = addr;
                    item.addEventListener('click', function() {
                        input.value = addr;
                        closeAllLists();
                    });
                    listDiv.appendChild(item);
                });
            });
            
            document.addEventListener('click', function(e) {
                if (e.target !== input) closeAllLists();
            });
        }

        function closeAllLists() {
            const items = document.getElementsByClassName('autocomplete-items');
            Array.from(items).forEach(item => item.remove());
        }

        // ==================== Multi-Step Wizard ====================
        function nextStep() {
            // Validate current step
            if (!validateStep(currentStep)) {
                return;
            }
            
            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}Circle`).classList.add('completed');
            document.getElementById(`step${currentStep}Circle`).classList.remove('active');
            
            // Show next step
            currentStep++;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}Circle`).classList.add('active');
        }

        function prevStep() {
            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}Circle`).classList.remove('active');
            
            // Show previous step
            currentStep--;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}Circle`).classList.remove('completed');
            document.getElementById(`step${currentStep}Circle`).classList.add('active');
        }

        function validateStep(step) {
            const errorContainer = document.getElementById('errorContainer');
            
            if (step === 1) {
                const address = document.getElementById('address').value;
                const landArea = document.getElementById('landArea').value;
                
                if (!address) {
                    showError('í† ì§€ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }
                if (!landArea || landArea < 500) {
                    showError('í† ì§€ ë©´ì ì€ ìµœì†Œ 500ã¡ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return false;
                }
            } else if (step === 2) {
                const zoning = document.getElementById('zoning').value;
                
                if (!zoning) {
                    showError('ìš©ë„ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
            } else if (step === 3) {
                const housingType = document.getElementById('housingType').value;
                
                if (!housingType) {
                    showError('ì£¼íƒ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return false;
                }
            }
            
            return true;
        }

        // ==================== Error Handling ====================
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message rounded-lg p-4 mb-4 flex items-start';
            errorDiv.innerHTML = `
                <svg class="w-6 h-6 text-red-600 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div class="flex-1">
                    <h4 class="font-semibold text-red-800">ì…ë ¥ ì˜¤ë¥˜</h4>
                    <p class="text-sm text-red-700 mt-1">${message}</p>
                </div>
                <button onclick="this.parentElement.remove()" class="text-red-600 hover:text-red-800">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            
            errorContainer.appendChild(errorDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => errorDiv.remove(), 5000);
        }

        // ==================== Analysis ====================
        async function analyzeProject() {
            if (!validateStep(3)) return;
            
            // Show loading state
            document.getElementById('welcomeState').classList.add('hidden');
            document.getElementById('resultsPanel').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            
            // Simulate progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) progress = 95;
                
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressPercent').textContent = `${Math.round(progress)}%`;
            }, 300);
            
            // Simulate API call
            try {
                await new Promise(resolve => setTimeout(resolve, 2500));
                
                // Complete progress
                clearInterval(progressInterval);
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100%';
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Show results
                showResults();
                
                // Save to history
                saveToHistory();
                
                // Move to step 4
                document.getElementById(`step${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}Circle`).classList.add('completed');
                currentStep = 4;
                document.getElementById('step4').classList.add('active');
                document.getElementById('step4Circle').classList.add('active');
                
            } catch (error) {
                showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('welcomeState').classList.remove('hidden');
            }
        }

        function showResults() {
            // Hide loading, show results
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultsPanel').classList.remove('hidden');
            
            // Update summary cards (mock data)
            document.getElementById('feasibilityScore').textContent = '7.2% / 6.8%';
            document.getElementById('maxUnits').textContent = '245';
            document.getElementById('complianceScore').textContent = '92';
            
            // Initialize charts
            initCharts();
            
            // Initialize map
            if (!map) {
                setTimeout(() => initMap(), 100);
            }
            
            // Update detailed analysis
            updateDetailedAnalysis();
        }

        // ==================== Charts ====================
        function initCharts() {
            // Radar Chart
            const radarCtx = document.getElementById('radarChart');
            if (radarChart) radarChart.destroy();
            
            radarChart = new Chart(radarCtx, {
                type: 'radar',
                data: {
                    labels: ['í–‰ë³µì£¼íƒ', 'êµ­ë¯¼ì„ëŒ€', 'ì˜êµ¬ì„ëŒ€', 'í†µí•©ê³µê³µ', 'ì‹ í˜¼í¬ë§'],
                    datasets: [{
                        label: 'ì í•©ë„ ì ìˆ˜',
                        data: [85, 72, 65, 88, 79],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgb(102, 126, 234)',
                        pointBackgroundColor: 'rgb(102, 126, 234)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(102, 126, 234)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Bar Chart
            const barCtx = document.getElementById('barChart');
            if (barChart) barChart.destroy();
            
            barChart = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['IRR', 'ROI', 'NPV', 'LTV', 'íšŒìˆ˜ê¸°ê°„'],
                    datasets: [{
                        label: 'ì¬ë¬´ ì§€í‘œ',
                        data: [7.2, 6.8, 3500, 65, 12],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ==================== Map ====================
        function initMap() {
            if (map) return;
            
            const mapElement = document.getElementById('map');
            map = L.map(mapElement).setView([37.5665, 126.9780], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add marker
            L.marker([37.5665, 126.9780]).addTo(map)
                .bindPopup('<b>ë¶„ì„ ëŒ€ìƒì§€</b><br>ì„œìš¸ì‹œ ê°•ë‚¨êµ¬')
                .openPopup();
        }

        // ==================== Tabs ====================
        function showTab(tabName) {
            // Hide all tabs
            document.getElementById('chartContent').classList.add('hidden');
            document.getElementById('mapContent').classList.add('hidden');
            document.getElementById('reportContent').classList.add('hidden');
            
            // Remove active class from all tab buttons
            document.getElementById('chartTab').className = 'flex-1 px-6 py-4 font-medium text-gray-500 hover:text-purple-600';
            document.getElementById('mapTab').className = 'flex-1 px-6 py-4 font-medium text-gray-500 hover:text-purple-600';
            document.getElementById('reportTab').className = 'flex-1 px-6 py-4 font-medium text-gray-500 hover:text-purple-600';
            
            // Show selected tab
            if (tabName === 'chart') {
                document.getElementById('chartContent').classList.remove('hidden');
                document.getElementById('chartTab').className = 'flex-1 px-6 py-4 font-medium text-purple-600 border-b-2 border-purple-600';
            } else if (tabName === 'map') {
                document.getElementById('mapContent').classList.remove('hidden');
                document.getElementById('mapTab').className = 'flex-1 px-6 py-4 font-medium text-purple-600 border-b-2 border-purple-600';
                if (map) map.invalidateSize();
            } else if (tabName === 'report') {
                document.getElementById('reportContent').classList.remove('hidden');
                document.getElementById('reportTab').className = 'flex-1 px-6 py-4 font-medium text-purple-600 border-b-2 border-purple-600';
                loadPDFViewer();
            }
        }

        function loadPDFViewer() {
            // Mock PDF URL - in production, this would be the actual PDF URL
            const pdfViewer = document.getElementById('pdfViewer');
            pdfViewer.src = 'about:blank';
            
            // Display placeholder
            const placeholderHTML = `
                <div style="padding: 40px; text-align: center; font-family: 'Noto Sans KR', sans-serif;">
                    <h2 style="color: #374151; margin-bottom: 20px;">ğŸ“„ ì‚¬ì—…ì„± ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                    <p style="color: #6b7280; margin-bottom: 30px;">
                        ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ìƒì„±ëœ PDF íŒŒì¼ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                    <div style="background: #f3f4f6; border-radius: 8px; padding: 30px; max-width: 600px; margin: 0 auto;">
                        <h3 style="color: #1f2937; margin-bottom: 15px;">ë¦¬í¬íŠ¸ ë‚´ìš©:</h3>
                        <ul style="text-align: left; color: #4b5563; line-height: 2;">
                            <li>âœ… ì¢…í•© í‰ê°€ ê²°ê³¼</li>
                            <li>ğŸ“Š ê·œëª¨ ë¶„ì„ (ì„¸ëŒ€ìˆ˜, ì¸µìˆ˜, ì£¼ì°¨)</li>
                            <li>ğŸ’° ì¬ë¬´ ë¶„ì„ (IRR, ROI, NPV)</li>
                            <li>âš ï¸ ë¦¬ìŠ¤í¬ ë¶„ì„</li>
                            <li>ğŸ“‹ ê·œì œ ê²€í† </li>
                            <li>ğŸ’¡ ì‚¬ì—… ì œì•ˆ</li>
                        </ul>
                    </div>
                </div>
            `;
            
            pdfViewer.srcdoc = placeholderHTML;
        }

        function downloadReport() {
            alert('PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ì‹¤ì œ ì„œë²„ ì—°ë™ í›„ í™œì„±í™”ë©ë‹ˆë‹¤.');
        }

        // ==================== History ====================
        function saveToHistory() {
            const analysisData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                address: document.getElementById('address').value,
                landArea: document.getElementById('landArea').value,
                housingType: document.getElementById('housingType').value,
                feasibilityScore: '7.2% / 6.8%',
                maxUnits: 245
            };
            
            analysisHistory.unshift(analysisData);
            if (analysisHistory.length > 20) analysisHistory = analysisHistory.slice(0, 20);
            
            localStorage.setItem('zerosite_history', JSON.stringify(analysisHistory));
            updateHistoryList();
        }

        function updateHistoryList() {
            const historyList = document.getElementById('historyList');
            const recentHistory = analysisHistory.slice(0, 5);
            
            if (recentHistory.length === 0) {
                historyList.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">ë¶„ì„ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            historyList.innerHTML = recentHistory.map(item => `
                <div class="history-item rounded-lg" onclick="loadHistoryItem(${item.id})">
                    <div class="text-sm font-medium text-gray-800">${item.address}</div>
                    <div class="text-xs text-gray-500 mt-1">
                        ${new Date(item.timestamp).toLocaleDateString('ko-KR')} Â· ${item.maxUnits}ì„¸ëŒ€
                    </div>
                </div>
            `).join('');
        }

        function loadHistoryItem(id) {
            const item = analysisHistory.find(h => h.id === id);
            if (!item) return;
            
            // Populate form
            document.getElementById('address').value = item.address;
            document.getElementById('landArea').value = item.landArea;
            document.getElementById('housingType').value = item.housingType;
            
            // Show results
            showResults();
        }

        // ==================== History Modal ====================
        document.getElementById('historyBtn').addEventListener('click', () => {
            const modal = document.getElementById('historyModal');
            const fullHistoryList = document.getElementById('fullHistoryList');
            
            if (analysisHistory.length === 0) {
                fullHistoryList.innerHTML = '<p class="text-center text-gray-500 py-8">ë¶„ì„ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                fullHistoryList.innerHTML = analysisHistory.map(item => `
                    <div class="border rounded-lg p-4 mb-3 hover:shadow-md transition cursor-pointer" onclick="loadHistoryItem(${item.id}); closeHistoryModal();">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-gray-800">${item.address}</h4>
                            <span class="text-xs text-gray-500">${new Date(item.timestamp).toLocaleString('ko-KR')}</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-gray-500">ë©´ì :</span>
                                <span class="font-medium ml-1">${Number(item.landArea).toLocaleString()}ã¡</span>
                            </div>
                            <div>
                                <span class="text-gray-500">ìœ í˜•:</span>
                                <span class="font-medium ml-1">${item.housingType}</span>
                            </div>
                            <div>
                                <span class="text-gray-500">ì„¸ëŒ€ìˆ˜:</span>
                                <span class="font-medium ml-1">${item.maxUnits}ì„¸ëŒ€</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.remove('hidden');
        });

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.add('hidden');
        }

        // ==================== Reset ====================
        function resetForm() {
            // Reset form
            document.getElementById('address').value = '';
            document.getElementById('landArea').value = '';
            document.getElementById('landPrice').value = '';
            document.getElementById('zoning').value = '';
            document.getElementById('far').value = '';
            document.getElementById('bcr').value = '';
            document.getElementById('housingType').value = '';
            document.getElementById('floors').value = '';
            document.getElementById('units').value = '';
            
            // Reset steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`step${i}`).classList.remove('active');
                document.getElementById(`step${i}Circle`).classList.remove('completed', 'active');
            }
            
            currentStep = 1;
            document.getElementById('step1').classList.add('active');
            document.getElementById('step1Circle').classList.add('active');
            
            // Hide results
            document.getElementById('resultsPanel').classList.add('hidden');
            document.getElementById('welcomeState').classList.remove('hidden');
            
            // Clear errors
            document.getElementById('errorContainer').innerHTML = '';
        }

        // ==================== Detailed Analysis ====================
        function updateDetailedAnalysis() {
            const detailedAnalysis = document.getElementById('detailedAnalysis');
            detailedAnalysis.innerHTML = `
                <div class="border-l-4 border-green-500 bg-green-50 p-4 rounded">
                    <h4 class="font-semibold text-green-800 mb-2">âœ… ì‚¬ì—…ì„± ìš°ìˆ˜</h4>
                    <p class="text-sm text-green-700">
                        IRR 7.2%, ROI 6.8%ë¡œ LH ìŠ¹ì¸ ê¸°ì¤€(IRR 4%, ROI 5%)ì„ ì´ˆê³¼í•˜ì—¬ 
                        ì¬ë¬´ì  íƒ€ë‹¹ì„±ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤.
                    </p>
                </div>
                
                <div class="border-l-4 border-blue-500 bg-blue-50 p-4 rounded">
                    <h4 class="font-semibold text-blue-800 mb-2">ğŸ“Š ê·œëª¨ ë¶„ì„</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>â€¢ ìµœëŒ€ ì¸µìˆ˜: 15ì¸µ (ì¼ì¡°ê¶Œ ì œì•½)</li>
                        <li>â€¢ ìµœëŒ€ ì„¸ëŒ€ìˆ˜: 245ì„¸ëŒ€</li>
                        <li>â€¢ ì£¼ì°¨ëŒ€ìˆ˜: 196ëŒ€ (0.8ëŒ€/ì„¸ëŒ€)</li>
                        <li>â€¢ ê±´íìœ¨: 58.2% (ë²•ì • 60% ì´í•˜)</li>
                    </ul>
                </div>
                
                <div class="border-l-4 border-purple-500 bg-purple-50 p-4 rounded">
                    <h4 class="font-semibold text-purple-800 mb-2">ğŸ“‹ ê·œì œ ì í•©ì„±</h4>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>â€¢ ìš©ì ë¥ : 248% (ë²•ì • 250% ì´í•˜) âœ“</li>
                        <li>â€¢ ì¼ì¡°ê¶Œ: 4.5ì‹œê°„ í™•ë³´ (ë²•ì • 4ì‹œê°„ ì´ìƒ) âœ“</li>
                        <li>â€¢ ì£¼ì°¨: ê¸°ì¤€ ì¶©ì¡± (0.7ëŒ€/ì„¸ëŒ€ ì´ìƒ) âœ“</li>
                    </ul>
                </div>
                
                <div class="border-l-4 border-orange-500 bg-orange-50 p-4 rounded">
                    <h4 class="font-semibold text-orange-800 mb-2">âš ï¸ ì£¼ìš” ë¦¬ìŠ¤í¬</h4>
                    <ul class="text-sm text-orange-700 space-y-1">
                        <li>â€¢ ê±´ì¶•ë¹„ ìƒìŠ¹ ë¦¬ìŠ¤í¬ (ì¤‘ê°„)</li>
                        <li>â€¢ ì¸í—ˆê°€ ì§€ì—° ë¦¬ìŠ¤í¬ (ë‚®ìŒ)</li>
                        <li>â€¢ ì‹œì¥ ìˆ˜ìš” ë¦¬ìŠ¤í¬ (ë‚®ìŒ)</li>
                    </ul>
                </div>
            `;
        }

        // ==================== Help ====================
        document.getElementById('helpBtn').addEventListener('click', () => {
            alert(`ZeroSite v24 ë„ì›€ë§

ì‚¬ìš© ë°©ë²•:
1. ì¢Œì¸¡ íŒ¨ë„ì—ì„œ í† ì§€ ì •ë³´ ì…ë ¥
2. 3ë‹¨ê³„ ë§ˆë²•ì‚¬ë¡œ ë¶„ì„ ì§„í–‰
3. ìš°ì¸¡ íŒ¨ë„ì—ì„œ ê²°ê³¼ í™•ì¸

ê¸°ëŠ¥:
â€¢ ìë™ì™„ì„±: ì£¼ì†Œ ì…ë ¥ ì‹œ ì¶”ì²œ ì£¼ì†Œ í‘œì‹œ
â€¢ ë¶„ì„ ì´ë ¥: ìµœê·¼ ë¶„ì„ 20ê±´ ìë™ ì €ì¥
â€¢ PDF ë¦¬í¬íŠ¸: ë¶„ì„ ê²°ê³¼ë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ
â€¢ ì‹¤ì‹œê°„ ì°¨íŠ¸: ì í•©ë„ ë° ì¬ë¬´ ì§€í‘œ ì‹œê°í™”

ë¬¸ì˜: support@zerosite.com`);
        });

        // ==================== Initialize ====================
        document.addEventListener('DOMContentLoaded', () => {
            setupAutocomplete();
            updateHistoryList();
        });
    </script>
</body>
</html>
